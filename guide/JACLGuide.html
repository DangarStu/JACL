<html>
<head>
	<title>The JACL Author's Guide</title>
	<link rel=stylesheet type="text/css" href="styles.css">
	<meta HTTP-EQUIV=~Content-Type~ CONTENT=~text/html; charset=UTF-8~>
</head>
<body>



<p>&nbsp;
<p>&nbsp;
<p>&nbsp;
<p>&nbsp;
<p>&nbsp;
<p>&nbsp;
<p>&nbsp;
<p>&nbsp;
<center>
	<a href="index.html"><img border=0 src="front.jpg"></a><br>
	<p><i>Sixth Edition</i>
</center>
	<p style="page-break-before: always">JACL Interpreter v2.7<br>
	<a href="http://code.google.com/p/jacl">http://code.google.com/p/jacl</a><br>
	&nbsp;<br>
	&nbsp;<br>
	<P>JACL Interpreter copyright 1992-2010 Stuart Allen <br>
	Please send any bugs or feature requests to <a href="mailto:stuartallen1972@gmail.com">stuartallen1972@gmail.com</a><br>
	<p>Webserver and preprocessor code copyright 2001-2002 Andreas Matthias.
	<p>Internationalisation by Niels Haedecke, Thomas Schwarz and Eric Forgeot.
	<p>Javascript, CSS and user registration code by Thomas Schwarz.
	<p>Glk libraries by Andrew Plotkin, David Kinder, Tor Andersson and Ben Cressey.
	<p>Special thanks to Robert Osztolykan, Parham Doustdar, Jose Lacal and Eric Forgeot for their testing and editing.
	<p>This program is free software; you can redistribute it and/or modify it under   
the terms of the GNU General Public License as published by the Free Software   
Foundation; either version 2 of the License, or any later version.              
                                                                                
<p>This program is distributed in the hope that it will be useful, but WITHOUT ANY 
WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
PARTICULAR PURPOSE. See the GNU General Public License for more details.        
                                                                                
<p>You should have received a copy of the GNU General Public License along with    
this program; if not, write to the Free Software Foundation, Inc., 675 Mass     
Ave, Cambridge, MA 02139, USA.

</BODY>
</HTML>


<h1 class="centred">Contents</h1>

<ol>

<li><a href="#introduction0">Introduction</a>

<li><a href="#typo0">Typographical Conventions</a>

<li><a href="#installation0">Installation</a>
<ol>
	<li><a href="#installation1">Compilation</a>
	<li><a href="#installation5">Playing the Sample Games</a>
	</ol>

<li><a href="#playing0">Playing Interactive Fiction</a>
<ol>
	<li><a href="#playing1">Moving Around</a>
	<li><a href="#playing2">Manipulating Objects</a>
	<li><a href="#playing3">Interacting with Characters</a>
	<li><a href="#playing4">Meta Commands</a>
</ol>

<li><a href="#tutorial0">Tutorial Game</a>
<ol>
	<li><a href="#tutorial1">Language Syntax</a>
	<li><a href="#tutorial2">Program Structure</a>
	<li><a href="#tutorial3">Getting Started</a>
	<li><a href="#tutorial4">Locations</a>
	<li><a href="#tutorial5">The Player</a>
	<li><a href="#tutorial6">Some Introductory Text</a>
	<li><a href="#tutorial7">Objects</a>
	<li><a href="#tutorial8">Verbs and Functions</a>
	<li><a href="#tutorial9">Overriding Functions</a>
	<li><a href="#tutorial10">Doors</a>
	<li><a href="#tutorial11">Non-player Characters</a>
	<li><a href="#tutorial12">The Passing of Time</a>
	<li><a href="#tutorial13">Winning and Losing the Game</a>
</ol>

<li><a href="#debugging0">Testing, Debugging and Releasing</a>
<ol>
	<li><a href="#debugging1">The WALKTHRU Command</a>
	<li><a href="#debugging2">The DEBUG Command</a>
	<li><a href="#debugging3">The INSPECT Command</a>
	<li><a href="#debugging4">The Verb VALUEOF</a>
	<li><a href="#debugging6">The Verb FETCH</a>
	<li><a href="#debugging8">Releasing Your Game</a>
</ol>

<li><a href="#screendisplay0">Screen Display</a>
<ol>
	<li><a href="#screendisplay1">The WRITE Command</a>
	<ol>
		<li><a href="#screendisplay2">Special Characters</a>
		<li><a href="#screendisplay3">Printing the Value of Variables</a>
		<li><a href="#screendisplay4">Printing the Value of Item Elements</a>
		<li><a href="#screendisplay5">Printing the Names and descriptions of Objects</a>
		<li><a href="#screendisplay6">Sentences Referring to Varying Objects</a>
		<li><a href="#screendisplay7">Custom Macros</a>
		<li><a href="#screendisplay8">Printing the Value of String Constants</a>
	</ol>
	<li><a href="#screendisplay9">The PRINT Command</a>
	<li><a href="#screendisplay10">The LOOK Command</a>
	<li><a href="#screendisplay11">The LOOK Command</a>
	<li><a href="#screendisplay12">The MORE Command</a>
</ol>

<li><a href="#multimedia0">Glk and Multimedia</a>

<ol>
	<li><a href="#multimedia1">Blorb Files and BLC</a></h2>
	<li><a href="#multimedia2">The IMAGE Command</a></h2>
	<li><a href="#multimedia3">The SOUND Command</a></h2>
	<li><a href="#multimedia4">The VOLUME Command</a></h2>
	<li><a href="#multimedia5">The STOP Command</a></h2>
	<li><a href="#multimedia6">The TIMER Command</a></h2>
	<li><a href="#multimedia7">The STYLE Command</a></h2>
	<li><a href="#multimedia8">The Status Window</a></h2>
	<li><a href="#multimedia9">The UPDATESTATUS Command</a></h2>
</ol>

<li><a href="#http0">HTTP and HTML</a>
<ol>
	<li><a href="#http1">Document Structure</a>
	<li><a href="#http2">Linebreaks</a>
	<li><a href="#http3">The Player's User ID</a>
	<li><a href="#http4">The Player's Commands</a>
	<li><a href="#http5">Ajax Requests</a>
	<li><a href="#http6">The BUTTON Command</a>
	<li><a href="#http7">The HYPERLINK Command</a>
	<li><a href="#http8">The CONTROL Command</a>
	<li><a href="#http9">The OPTION Command</a>
	<li><a href="#http10">The IMAGE Command</a>
	<li><a href="#http11">The Media File</a>
</ol>

<li><a href="#webinterface0">GUI Web Interface</a>
<ol>
	<li><a href="#webinterface1">Using the Interface</a>
</ol>

<li><a href="#flowcontrol0">Flow Control</a>

<ol>
	<li><a href="#flowcontrol1">The IF, IFALL, ENDIF and ENDALL Commands</a>
	<li><a href="#flowcontrol2">The IFSTRING Command</a>
	<li><a href="#flowcontrol3">The IFEXECUTE Command</a>
	<li><a href="#flowcontrol4">The ELSE Command</a>
	<li><a href="#flowcontrol5">The LOOP and ENDLOOP Commands</a>
	<li><a href="#flowcontrol6">The SELECT and ENDSELECT Commands</a>
	<li><a href="#flowcontrol7">The REPEAT and UNTIL Commands</a>
	<li><a href="#flowcontrol8">The WHILE and ENDWHILE Commands</a>
	<li><a href="#flowcontrol9">The RETURN Command</a>
</ol>

<li><a href="#set0">Changing Data</a>
<ol>
	<li><a href="#set1">The SET Command</a>
	<li><a href="#set2">Type Casting</a>
	<li><a href="#set3">The SETSTRING and ADDSTRING Commands</a>
	<li><a href="#set4">The PADSTRING Command</a>

</ol>

<li><a href="#movement0">Movement</a>

<ol>
	<li><a href="#movement1">The MOVE Command</a>
	<li><a href="#movement2">The TRAVEL Command</a>
	<li><a href="#movement3">Moving Non-player Characters</a>
	<li><a href="#movement4">The DIR_TO and NPC_TO Commands</a>
</ol>

<li><a href="#special0">Special-Purpose Commands</a>

<ol>
	<li><a href="#special1">The POINTS Command</a>
	<li><a href="#special2">The PROXY Command</a>
	<li><a href="#special3">Trigonometry</a>
	<ol>
		<li><a href="#special4">The POSITION Command</a>
		<li><a href="#special5">The BEARING Command</a>
		<li><a href="#special6">The DISTANCE Command</a>
	</ol>
	<li><a href="#special7">The ASKNUMBER and GETNUMBER Commands</a>
	<li><a href="#special8">The GETSTRING Command</a>
	<li><a href="#special9">The GETYESORNO Command</a>
	<li><a href="#special10">The SAVEGAME and RESTOREGAME Commands</a>
	<li><a href="#special12">The TERMINATE Command</a>
	<li><a href="#special13">The UNDOMOVE Command</a>

</ol>

<li><a href="#attributes0">Attributes</a>

<ol>
	<li><a href="#attributes1">The ENSURE Command</a>
	<li><a href="#attributes2">Object Attributes</a>
	<li><a href="#attributes3">Location Attributes</a>
	<li><a href="#attributes4">User Attributes</a>
</ol>

<li><a href="#functions0">Functions</a>

<ol>
	<li><a href="#functions1">The EXECUTE and CALL Commands</a>

	<ol>
		<li><a href="#functions2">Passing Arguments to a Function</a>
	</ol>

	<li><a href="#functions3">The function-call count</a>
	<li><a href="#functions4">The RETURN Command</a>
	<li><a href="#functions5">Responding to the Player's Moves</a>

	<li><a href="#functions6">Special Functions</a>
	<li><a href="#functions7">Utility Functions</a>

</ol>

<li><a href="#library0">Creating New Verbs</a>
<li><a href="#pointers0">Pointers</a>

<ol>
	<li><a href="#pointers1">Object Pointers</a>
	<li><a href="#pointers2">Location Pointers</a>
</ol>

<li><a href="#resolution0">Object Resolution</a>

<ol>
	<li><a href="#resolution1">Object Naming</a>
	<li><a href="#resolution2">Disambiguation</a>
</ol>

<li><a href="#definitions0">Definitions in Detail</a>

<ol>
	<li><a href="#definitions1">Objects</a>
	<li><a href="#definitions2">Locations</a>
	<li><a href="#definitions3">Integer Variables</a>
	<ol>
		<li><a href="#definitions4">Internal Integer Variables</a>
	</ol>
	<li><a href="#definitions5">String Variables</a>
	<li><a href="#definitions6">Arrays</a>
	<li><a href="#definitions7">Constants</a>
	<li><a href="#definitions8">Synonyms</a>
	<li><a href="#definitions9">Filters</a>
	<li><a href="#definitions10">Grammar Statements</a>
	<li><a href="#definitions11">User Attributes</a>
	<li><a href="#definitions12">Parameters</a>
</ol>

<li><a href="#internals0">Internals</a>

<ol>
	<li><a href="#internals1">Constants and Random</a>
	<li><a href="#internals2">Internal Commands</a>
</ol>

<li><a href="#menu0">The Menu Library</a>

<li><a href="#csv0">CSV Files</a>
<ol>
	<li><a href="#csv1">The ITERATE and ENDITERATE Commands</a>
	<li><a href="#csv2">The UPDATE, ENDUPDATE and INSERT Commands</a>
	<li><a href="#csv3">The APPEND Command</a>
</ol>

<li><a href="#attributesummary0">Appendix A: JACL Attributes</a>
<li><a href="#verbfunctions0">Appendix B: Library Verb Functions</a>
<li><a href="#tutorialsource0">Appendix C: Tutorial Game Source Code</a>
<li><a href="#glossary0">Glossary</a>

</ol>

</body></html>


<h1><a class="title" name="introduction0">Introduction</a></h1>

<p>JACL is a language for writing interactive fiction, also known as text adventure games. It is easy to learn and comes with an extensive library of game verbs that will allow you to create the beginnings of your first game quickly and easily. The <a href="tutorial.html">tutorial chapter</a> of this guide walks you through the creation of a simple, but complete text adventure game and demonstrates all the main principles of the JACL language.

<p>JACL is an interpreted language, so once you have written your games they can be run without modification on any platform that has a JACL interpreter. The JACL interpreter uses the Glk API to talk to its user interface which allows it to be compiled with many different Glk implementations on many different operating systems. Although interactive fiction is primarily a text-based medium, many of these Glk interfaces allow you to also fill your games with pictures and sound.

<p>JACL also has two web-enabled interpreters that are easy to configure and run. If desired, games that do not require a complex graphical interface can be written in such a way that the same game file can be run by both the console-based and web-based interpreters. If desired, however, the web-enabled interpreters can be used to create a variety of turn-based games with interfaces vastly different to interactive fiction. The Blackjack game included with this distribution is one such example.

<p>The latest version of JACL can be found at <a href="http://code.google.com/p/jacl/">http://code.google.com/p/jacl/</a>.

<p>I would also like to take this opportunity to thank some of the people who have contributed to this system:  Robert Osztolykan and Parham Doustdar for their invaluable beta testing, editing and suggestions; Andreas Matthias for contributing the internal web server and preprocessor code; Thomas Schwarz for his Javascript, CSS and user registration code; David Fisher for contributing the route-finding code; Niels Haedecke, Thomas Schwarz and Eric Forgeot for their work on translation and internationalisation; Andrew Plotkin, David Kinder, Tor Andersson and Ben Cressey for their Glk libraries. I would also like to thank Ben Cressey for his assistance in adding Unicode support to JACL.

<p>&nbsp;
<p>&nbsp;
<table width=100%><tr><td align="right">
Stuart Allen<br>
Sydney, Australia<br>
April 2010<br>
<a href="mailto:stuartallen1972@gmail.com">stuartallen1972@gmail.com</a>
</td></tr></table>



<h1><a class="title" name="typo0">Typographical Conventions</a></h1>

<P>The use of <B>bold</B> indicates that this word is used verbatim in the appropriate manner.

<P>The use of <I>italics</I> indicates text that should be substituted with the appropriate value.

<P>The use of <CODE>typewriter</CODE> font indicates code segments, typed commands or transcripts.

<P><U>Underlined</U> text is occasionally used for emphasis.

<P>Text enclosed in square brackets, [such as this], indicates an optional parameter.

<table width="100%">
<tr>
	<td width=80><img src="warning.png" alt="Warning"></td>
	<td>The warning graphic indicates a potential area for error. Special care should be taken when working in these areas.</td>
</tr><tr>
	<td width=80><img src="info.png" alt="Information"></td>
	<td>The information graphic indicates advanced, non-essential information that may confuse the novice author. These may be safely skipped until you have a greater level of experience.</td>
</tr></table>



<h1><a class="title" name="installation0">Installation</a></h1>

<p>The latest version of JACL can be found at <a href="http://code.google.com/p/jacl">http://code.google.com/p/jacl</a>. JACL is available as a zip file for Microsoft Windows and tar file for Unix operating systems. Once you have extracted the appropriate archive you will have a directory called <b>jacl</b> with several subdirectories. You will find the executable files in the <b>bin</b> subdirectory. In the Linux distribution you will find four interpreters: <b>jacl</b> is a console interpreter that uses the GlkTerm library by Andrew Plotkin, <b>garjacl</b> is a graphical interpreter that uses the Gargoyle library by Tor Andersson and Ben Cressey, while <b>cgijacl</b> and <b>fcgijacl</b> are the two web-based interpreters. <b>cgijacl</b> can be run directly from the command line and is used more for development purposes while <b>fcgijacl</b> must be used with a FastCGI-enabled webserver and is used more for production deployments. You will also find the program <b>bjorb</b>, a small utility (based on <b>blc</b> by Ross Raszewski) for creating the Blorb resource files that will contain any images and sounds you wish to use in your games. In the Microsoft Windows distribution you will find a single interpreter called <b>garjacl</b> and the same <b>bjorb</b> utility as in the Linux version. 

<h2><a class="section" name="installation1">Compilation</a></h2>

<p>The <b>src</b> directory contains the C source code to the JACL interpreter. Also included is the source to <b>glkterm</b> a Glk implementation by Andrew Plotkin based on ncursesw, and the <b>bjorb</b> utility .

<center>
<table width=85%><tr>
<th width=20%>&nbsp;Interpreter&nbsp;</th>
<th>&nbsp;Required Libraries&nbsp;</th>
<tr>
<td><b>jacl</b> (Posix)</td>
<td>GlkTerm by Andrew Plotkin (included) and ncursesw.
</td>
</tr><tr>
<td><b>garjacl</b></td>
<td>Gargoyle by Tor Andersson (included as a DLL and .so shared library).</td>
</tr><tr>
<td><b>cgijacl</b></td>
<td>No special libraries are required to compile <b>cgijacl</b>, however a POSIX compliant system is needed.
</tr><tr>
<td><b>fcgijacl</b></td>
<td>FastCGI, available from <a href="http://www.fastcgi.com/index.html">http://www.fastcgi.com/index.html</a>, or as the Debian packages:
<pre>
libfcgi-dev
libfci0c2
</pre>

</table>
</center>

<p>To compile the source for the JACL interpreters and the <b>bjorb</b> under Linux simply change to the <b>src</b> subdirectory and type the following command:

<pre>
make install
</pre>

<p>This will compile all the relevant programs and copy the executable binaries into the <b>bin</b> subdirectory.

<p>All the extra DLLs required for Microsoft Windows are included in the <b>bin</b> directory. In Linux distributions, only the core Gargoyle share library is included. This is file <b>libgarglk.so</b> in the <b>src/Gargoyle</b> directory and should be copied to the directory <b>/usr/local/lib</b>. Other required libraries should be installed using your operating systems packaging system. Below is the output of <b>ldd</b> to showing the complete list of libraries required:

<pre>
libgarglk.so           libjpeg.so.62
linux-gate.so.1        libm.so.6
libc.so.6              ld-linux.so.2
libfreetype.so.6       libz.so.1
libgtk-1.2.so.0        libgdk-1.2.so.0
libXi.so.6             libXext.so.6
libX11.so.6            libglib-1.2.so.0
libpng12.so.0          libSDL_mixer-1.2.so.0
libSDL-1.2.so.0        libgmodule-1.2.so.0
libdl.so.2             libXau.so.6
libxcb-xlib.so.0       libxcb.so.1
libasound.so.2         libdirectfb-1.0.so.0
libfusion-1.0.so.0     libdirect-1.0.so.0
libpthread.so.0        libXdmcp.so.6
</pre> 

<p>In the <b>games</b> directory you will find several JACL games. A JACL game consists of one or more <b>.jacl</b> files and an optional <b>.blorb</b> file that contains multimedia resources used by the game. If a JACL game consists of more than one <b>.jacl</b> file, the other file will be one of the library files from the <b>include</b> directory.

<p>Inside the <b>games</b> directory you will also find a <b>temp</b> directory. This is the directory where the interpreter will create the <b>.j2</b> files. A <b>.j2</b> file is a concatenation of a main game file and all other files included from that file. They are created by the interpreter when the game is first run and are encrypted by default.

<table class="infowarn"><tr>
<td><img src="warning.png" alt="Warning"></td>
<td>Under Unix, the user the JACL interpreter is run as must have write permissions to the <b>temp</b> directory.</td>
</tr></table>

<p>The <b>include</b> directory is found inside the <b>games</b> directory. In the <b>include</b> directory you will find <b>verbs.library</b>, the main interactive fiction library and <b>frame.jacl</b>, a skeleton program used as a starting point when writing a new piece of interactive fiction.

<p>In the <b>guide</b> directory you will find this documentation.

<h2><a class="section" name="installation2">Playing the Sample Games</a></h2>

<p>Once you have compiled versions of the JACL interpreters, try running one of the provided games by changing to the <b>bin</b> directory and typing the command:

<pre>
./garjacl ../games/grail.jacl
</pre>

<p>When you do so, you should see something like the screen below:

<center>&nbsp;<br><img src="grail.png" alt="The Unholy Grail running in the JACL interpreter"><br>&nbsp;<br></center>

<h3><a class="section" name="installation3">cgijacl and fcgijacl</a></h3>

<p>When the <b>cgijacl</b> and <b>fcgijacl</b> interpreters start they will first look for their configuration file in the current directory. If this does not exist they will look for it in the <b>etc</b> directory that is at the same level as the <b>games</b> directory. In other words, from the directory the game file being run is in, the <b>jacl</b> interpreter will look for <b>../etc/cgijacl.conf</b>. If neither of these files is found, the <b>cgijacl</b> or <b>fcgijacl</b> interpreters will also look for the file <b>/etc/cgijacl.conf</b>.

<P>The configuration files for <b>cgijacl</b> and <b>fcgijacl</b> may contain any of the following lines: 

<table width=100%><tr>
<th width=20%>Directive</th>
<th width=40%>Description</th>
<th width=40%>Default</th>
</tr><tr>
<td><b>access_log</b> <i>FileName</i></td>
<td>This indicates the file that should be used to log all moves made while playing. If a directory is specified with the trailing forward slash, the file name <b>access.log</b> is appended to the supplied directory.</td>
<td><b>../log/access.log</b> (from the location of the game file)</td>
</tr><tr>
<td><b>error_log</b> <i>FileName</i></td>
<td>This indicates the file that should be used to log all errors that occur while JACL programs are running. If a directory is specified with the trailing forward slash, the file name <b>error.log</b> is appended to the supplied directory.</td>
<td><b>../log/error.log</b> (from the location of the game file)</td>
</tr><tr>
<td><b>include</b> <i>Directory</i></td>
<td>This indicates the directory to look in to find any file specified in a <b>#include</b> preprocessor directive.</td>
<td>A directory called <b>include</b> beneath the directory the game file is stored in. If an included file is not found in this directory, the directory the game file is stored in is searched.</td>
</tr><tr>
<td><b>temp</b> <i>Directory</i></td>
<td>This indicates the directory to store the processed version of the game file.</td>
<td>A directory called <b>temp</b> beneath the directory the game file is stored in. If this directory does not exist, the <b>.j2</b> file will be created in the same directory as the game file.</td>
</tr></table>

<p style="page-break-before: always">Below is an example <b>cgijacl</b> configuration file:

<pre>
# "cgijacl.conf"
# CGIJACL interpreter configuration file.

access_log     "/usr/local/jacl/log/error.log" 
access_log     "/usr/local/jacl/log/access.log" 
temp           "/usr/local/jacl/games/temp/"
include        "/usr/local/jacl/games/include/"
</pre>

<h2><a class="section" name="installation5">Playing the Sample Games</a></h2>

<p>Once you have compiled the JACL interpreters, try running one of the provided games by changing to the <b>bin</b> directory and typing the command:

<pre>
./cgijacl ../games/blackjacl.jacl
</pre>

<p>This command will start the JACL interpreter on the default port of 4269, resulting in the following output:

<pre>
JACL Interpreter v2.7.0
WebJACL: Registered 8 media.
WebJACL: No port number specified (-p <number>), using default port 4269.
WebJACL server configured on WOPR:4269
</pre>

<p>To play this game, open your favourite web browser and navigate to the URL <b>http://localhost:4269</b>. When you do so, you should see something like the screen below. If not, see the section on <a href="troubleshooting.html">Trouble Shooting</a>.

<center>&nbsp;<br><img src="blackjacl.png"><br>&nbsp;<br></center>

<p>To play this same game from the console, try the following command from the <b>bin</b> directory:

<pre>
./jacl ../games/blackjack.jacl
</pre>

<h2><a class="section" name="installation6">Using JACL with FastCGI and Apache</a></h2>

<p>While the <b>cgijacl</b> interpreter is able to respond to HTTP requests internally, the <b>fcgijacl</b> interpreter is designed to be used with a FastCGI-enabled webserver such as Apache. The <b>cgijacl</b> interpreter is very easy to use and is ideal for developing a new game or allowing a small number of users to play your completed games. The <b>fcgijacl</b> interpreter, when used with a production-quality web server such as Apache, is probably better choice for situations where a high level of traffic is expected.

<p>Before the <b>fcgijacl</b> interpreter can be successfully used with an Apache server, the <b>mod_fastcgi</b> module must the installed and configured. There are many different ways to install both the Apache server and the <b>mod_fastcgi</b> module, all of which are detailed in their respective documentation. <b>mod_fastcgi</b> is available from <a href="http://freshmeat.net/projects/mod_fastcgi/index.html">http://freshmeat.net/projects/mod_fastcgi</a> or as the Debian package: 

<pre>
libapache2-mod-fastcgi 
</pre>

<p>FastCGI is a system for interfacing a web server with an external binary program, in this case the JACL interpreter. With normal CGI, a program is started to handle each individual request. The program executes, produces some output then terminates. Depending on the startup time of the specific program this can be an extemely inefficient process. With FastCGI, programs are run once then wait in a loop, processing requests as they are made. This suits programs such as the JACL interpreter perfectly as it has a fair amount of processing to do when a game is first run, yet very little for an individual move made by a player.

<p>Once <b>mod_fastcgi</b> is installed, Apache requires a file called <b>fastcgi.load</b> in your <b>mods-enabled</b> directory that contains the line:

<pre>
LoadModule fastcgi_module /usr/lib/apache2/modules/mod_fastcgi.so
</pre>

<p>To configure FastCGI, you must edit the file <b>fastcgi.conf</b> in your <b>mods-enabled</b> directory to read:

<pre>
&lt;IfModule mod_fastcgi.c&gt;
  AddHandler fastcgi-script .fcgi

  ScriptAlias /fastcgi-bin/ "/usr/local/fastcgi-bin/"

  &lt;Location /fastcgi-bin&gt;
    SetHandler fastcgi-script
    Options ExecCGI
  &lt;/Location&gt;

  FastCgiIpcDir /var/lib/apache2/fastcgi
&lt;/IfModule&gt;
</pre>

<P>This configuration creates a script alias of <b>/fastcgi-bin</b> that points to the directory <b>/usr/local/fastcgi-bin</b>. This directory must be created so that the user that the Apache server runs as has read and execute premissions to it. A script alias is a way of mapping URLs to directories on your file system. The above script alias says that any resource being accessed using a URL starting with <b>/fastcgi-bin</b> should be looked for in the directory <b>/usr/local/fastcgi-bin</b>.

<p>The location block says that any scripts accessed within the <b>/usr/local/apache/fastcgi-bin</b> directory are to be handled by <b>mod_fastcgi</b> and that the execution of CGI scripts is permitted. As you have probably guessed, this is directory where all your JACL games will be placed. You may alternatively wish to set a script alias like <b>/fastcgi-jacl</b> to point to the directory <b>/usr/local/jacl/games/</b> or wherever your JACL games reside.

<p>The <b>images</b> directory beneath the <b>games</b> directory of your JACL distribution will need to be copied to the Apache document root. The sample games are designed to read the images from <b>/images</b> when played with <b>fcgijacl</b>. It is necessary to load images from somewhere beneath the document root as Apache attempts to run any resource accessed from beneath <b>/fastcgi-bin</b> as a FastCGI script, which the images are not.

<p>Next, the file <b>cgijacl.conf</b> must be moved from <b>jacl/etc</b> to <b>/etc</b>. This file contains several configuration details, the most imortant directive for <b>fcgijacl</b> is <b>temp</b>. This specifies the directory that all persistant data will be written to. By default this is specified in <b>cgijacl.conf</b> as <b>/usr/local/jacl/games/temp</b>. It is important to ensure that the user the Apache server runs as has read and write permissions to whichever directory you specify by using a command such as:

<pre>
chmod 777 /usr/local/jacl/games/temp
</pre>

<p>Regardless of where you locate your JACL games, you will need to edit the first line of each game to point to the <b>fcgijacl</b> interpreter. For example:

<pre>
#!/usr/local/jacl/bin/fcgijacl
</pre>

<p>The below line will appear in the Apache error log if the first line of the game points to the interpreter in the wrong location. The line can be misleading as it is not the file <b>grail.jacl</b> that cannot be found but the interpreter binary it is attempting to run itself using.

<pre>
FastCGI: can't start server "/usr/local/fastcgi-bin/grail.jacl" (pid 2539), exec
le() failed: No such file or directory
</pre>

<p>Once you have finished configuring JACL and Apache, start Apache and open the following URL from your browser: <b>http://localhost/fastcgi-bin/tutorial.jacl</b>. If all has gone well, you should see the title page for this game. If not, try looking in Apache's <b>error_log</b> and <b>/usr/local/jacl/log/error.log</b>. 



<h1><a class="title" name="playing0">Playing Interactive Fiction</a></h1>

<p>Interactive fiction involves the reader in a way that static stories 
do not. Rather than reading sequentially from beginning to end, you 
control the actions of the main character by typing commands in the 
form of simple English sentences. Before setting out on your adventure 
there are a few concepts that must be explained in order for you to 
interact successfully with the virtual world created by the author.

<h2><a class="section" name="playing1">Moving Around</a></h2>

<p>The physical space that you will be exploring is divided up into 
discrete units called locations. Locations may be travelled between 
using the following commands:</p>

<CENTER><TABLE WIDTH=40%>
<TR><TH>Command</TH><TH>Direction</TH></TR>
<TR><TD><b>n</b></TD><TD>North</TD></TR>
<TR><TD><b>s</b></TD><TD>South</TD></TR>
<TR><TD><b>e</b></TD><TD>East</TD></TR>
<TR><TD><b>w</b></TD><TD>West</TD></TR>
<TR><TD><b>ne</b></TD><TD>Northeast</TD></TR>
<TR><TD><b>nw</b></TD><TD>Northwest</TD></TR>
<TR><TD><b>se</b></TD><TD>Southeast</TD></TR>
<TR><TD><b>sw</b></TD><TD>Southwest</TD></TR>
<TR><TD><b>u</b></TD><TD>Up</TD></TR>
<TR><TD><b>d</b></TD><TD>Down</TD></TR>
<TR><TD><b>in</b></TD><TD>In</TD></TR>
<TR><TD><b>out</b></TD><TD>Out</TD></TR>
</TABLE></CENTER>

<p>The description of each location will tell you the directions in which you can travel from it. Be aware, however, that some exits may only be available under certain circumstances such as while a door is open or a bridge lowered.</p>

<h2><a class="section" name="playing2">Manipulating Objects</a></h2>

<p>Within these locations you will find many objects that you can 
interact with. These objects may be referred to by as few 
or as many of their names as is required to uniquely identify it.
For example, if the story informs you that "There is a silver key 
resting here." Then it may be referred to as either <b>silver</b>, <b>key</b> or 
<b>silver key</b>. If your reference is ambiguous, such as using <b>key</b> 
when there is both a silver and a gold key in the current location 
then you will be prompted to be more specific.</p>

<p>The next thing to learn about interactive fiction is the 
way in which you interact with these objects.

<!-- NEW PAGE -->
<p>The basic sentence structures understood by the game are:
<center><table width=50%><tr>
<th>Command Structure</th><th>Example command</th>
</tr><tr>
<TD><i>action</i></TD><TD><b>scream</b></TD>
</TR><TR>
<TD><i>action object</i></TD><TD><b>take book</b></TD>
</TR><TR>
<TD><i>action object preposition object</i></TD><TD><b>unlock door with key</b></TD>
</TR><TR>
</table></center>
<p>An action does not necessarily have to be a single word. For instance, 
"examine rock through magnifying glass", an example of the last 
syntax, may also be expressed as "look at rock through magnifying 
glass". Following is a list of some of the other actions that can be used to interact with the objects you find:

<center><table width=80%><tr>
<TD><b>turn</b></TD><TD><b>read</b></TD><TD><b>pull</b></TD><TD><b>push</b></TD><TD><b>eat</b></TD><TD><b>cut</b></TD>
</TR><TR>
<TD><b>lock</b></TD><TD><b>unlock</b></TD><TD><b>rub</b></TD><TD><b>attack</b></TD><TD><b>taste</b></TD><TD><b>drink</b></TD>
</TR><TR>
<TD><b>break</b></TD><TD><b>smell</b></TD><TD><b>listen</b></TD><TD><b>pour</b></TD><TD><b>move</b></TD><TD><b>light</b></TD>
</TR><TR>
<TD><b>play</b></TD><TD><b>blow</b></TD><TD><b>throw</b></TD><TD><b>wear</b></TD><TD><b>open</b></TD><TD><b>close</b></TD>
</TR><TR>
<TD><b>take</b></TD><TD><b>drop</b></TD><TD><b>insert</b></TD><TD><b>remove</b></TD>
</tr></table></center>

<p>Where an object is expected, the words <b>it</b>, <b>them</b>, <b>him</b> and <b>her</b> can be used to indicate the last appropriate object referred to in one of your commands. With some commands it is possible to supply more than one object. Multiple objects can be specified in a multitude of ways. The words <b>all</b> or <b>everything</b> will tell the interpreter that you wish to perform the action on all the objects in the appropriate scope. For example, with the command <b>drop all</b>, the interpreter will perform the <b>drop</b> action for every object you are currently carrying.

<p>Any object reference can be qualified by using the word <b>from</b>. Although this can be used at any time, it is most useful in conjunction with <b>all</b> to construct commands such as <b>take all from chest</b>. This command will perform the <b>take</b> action for every object that is currrently inside the chest. 

<p>The word <b>except</b> can be used once per list of objects, with any object to the right of the word <b>except</b> being removed from list of objects to the left. An example of this is the command <b>take all from chest except the gem</b>. The important thing to be aware of with the word <b>except</b> is that any objects supplied after the word <b>except</b> are objects the action is not to be performed on. With this in mind you can see how the two commands below have very different results.

<pre>
&gt;take sword and all from chest except gem
&gt;take all from chest except gem and sword
</pre>

<p>With the first command the sword will be taken, with the second command it will not. So in summary, any list of objects may use the word <b>from</b> many times, but <b>except</b> only once at most. Individual objects can be separated by the word <b>and</b> or a comma (<b>,</b>) while the word <b>then</b> or a period (<b>.</b>) is used to separate completely different commands. Below is a legal command that uses all of the forementioned functionality:

<pre>
&gt;take sword, shield, all from chest and all from shelf except gem then go north
</pre>

<p>When playing interactive fiction, it is important to have a general feeling for how much can be achieved with a single command. A task such as defusing a bomb would generally not be performed by typing <B>defuse bomb</B>. The following is a sample transcript to give you a better feel for how a task such as this might be achieved:</p>

<pre>
&gt;examine bomb
The bomb is about a foot square and has a small panel in its upper 
surface. The panel is currently closed.
 
&gt;listen to bomb
The bomb is making an ominous ticking sound.

&gt;open panel
You open the panel to reveal a red wire, a green wire, a blue wire, 
a clock and some dynamite.

&gt;i
You are carrying a bomb manual, an insurance policy and some wire 
cutters.

&gt;read manual
Leafing through the book you come to the page on diffusing. Seems 
straight forward enough, just cut the blue wire then the red one.

&gt;cut blue wire with cutters
Reaching carefully in to the bomb's casing you cut the blue wire. So 
far so good.

&gt;cut red wire with cutters
Holding your breath you snip the red wire.

&gt;listen to bomb
The bomb, thankfully, is now silent.
</pre>

<p>As you can see, each task you wish to achieve must be broken down 
into its component actions.</p>

<h2><a class="section" name="playing3">Interacting with Characters</a></h2>

<p>During the course of the story you may encounter other computer 
controlled characters. These characters may be interacted with using 
the following commands:

<table noboder><tr>
<td>&nbsp;</td><td><b>talk to</b> <i>character</i></td>
</tr><tr>
<td>&nbsp;</td><td><b>give</b> <i>object</i> <b>to</b> <i>character</i></td>
</tr><tr>
<td>&nbsp;</td><td><b>show</b> <i>object</i> <b>to</b> <i>character</i></td>
</tr><tr>
<td>&nbsp;</td><td><b>ask</b> <i>character</i> <b>for</b> <i>object</i></td>
</tr><tr>
<td>&nbsp;</td><td><b>ask</b> <i>character</i> <b>about</b> <i>object</i></td>
</tr><tr>
<td>&nbsp;</td><td><b>tell</b> <i>character</i> <b>about</b> <i>object</i></td>
</tr></table>

<!-- NEW PAGE -->
<h2><a class="section" name="playing4">Meta Commands</a></h2>

<p>There are also some special commands for interacting with the JACL interpreter 
rather than the game world it is currently running:</p>
<p><CENTER><TABLE WIDTH=80%><TR>
<TH width=20%>Command</TH><TH>Action</TH>
</TR><TR>
<TD><b>verbose</b></TD><TD>Always describe locations when visited.</TD>
</TR><TR>
<TD><b>brief</b></TD><TD>Only describe locations when being visited for the first time.</TD>
</TR><TR>
<TD><b>restart</b></TD><TD>Restart the game from the beginning.</TD>
</TR><TR>
<TD><b>script</b></TD><TD>Start recording a complete transcript of your game session.</TD>
</TR><TR>
<TD><b>unscript</b></TD><TD>Stop recording a started transcript.</TD>
</TR><TR>
<TD><b>score</b></TD><TD>Display your current score.</TD>
</TR><TR>
<TD><b>look</b></TD><TD>Display the description for the current location.</TD>
</TR><TR>
<TD><b>save</b></TD><TD>Save the current game state.</TD>
</TR><TR>
<TD><b>restore</b></TD><TD>Restore a saved game state.</TD>
</TR><TR>
<TD><b>i</b></TD><TD>Display a horizontal list of possessions.</TD>
</TR><TR>
<TD><b>inv</b></TD><TD>Display a vertical list of possessions.</TD>
</TR><TR>
<TD><b>oops</b> <i>NewWord</i></TD><TD>Replace the erroneous word in the last command with the supplied new word.</TD>
</TR><TR>
<TD><b>undo</b></TD><TD>Take back the last command issued.</TD>
</TR><TR>
<TD><b>again</b></TD><TD>Repeat the last command issued.</TD>
</TR><TR>
<TD><b>info</b></TD><TD>Display interpreter version information.</TD>
</TR><TR>
<TD><b>about</b></TD><TD>Display game version information.</TD>
</TR></TABLE></CENTER>

<p>You are now ready to embark on your first adventure into the 
world of interactive fiction.
 Remember to make a map as you go and read everything 
carefully as vital clues may be hidden in the descriptions of the 
locations and objects you come across. Examining every object you can 
refer to is a good idea, as is saving your position often. Well, good 
luck, and above all have fun!



<h1><a class="title" name="tutorial0">Tutorial Game</a></h1>

<P>JACL is a language for writing interactive fiction. By providing short definitions for objects and locations you will rapidly build your virtual world. By associating small amounts of simple code with these objects and locations you will bring your world to life. During the course of this tutorial you will see the construction of a small text-only game from beginning to end. The full <a href="tutorialsource.html">source code</a> for this tutorial game is included in Appendix D and in the <b>games</b> subdirectory of your JACL distribution. 

<h2><a class="section" name="tutorial1">Language Syntax</a></h2>

<p>JACL is an interpreted language. This means that the interpreter directly reads your program source code and executes it without the need for it to be compiled first. Each JACL command or definition must be on a line of its own and no single line may not exceed 1024 characters in length. Any single parameter that includes spaces, commas, colons or tabs must be contained within double quotes, as these are all considered to be white space. If a command accepts parameters, each parameter must be separated by white space.

<p>Any text that appears between a hash (<b>#</b>) or a semicolon (<b>;</b>) and the end of the line is considered a comment and has no affect on the program's execution. Comments are useful to explain the purpose of your code to other authors or to refresh your own memory when returning to old code. 

<p>One special use of comments is to tell the command shell the location of the interpreter that can execute your program. The first line of most JACL programs will be something like:

<pre>
#!../bin/jacl
</pre>

<p>If a JACL program has a first line similar to this, when it is executed directly the shell will pass the name of the program as an argument to the interpreter specified after the <b>#!</b>. This means that the following shell command:

<pre>
./grail.jacl
</pre>

<p>becomes the equivalent to the following command:

<pre>
../bin/jacl grail.jacl
</pre>

<p>This line presumes that all games are run from the <b>games</b> directory of your JACL distribution and that you are currently in that directory. To remove this restriction change the first line of your game to indicate the full absolute path to your JACL interpreter of choice. For example:


<pre>
#!/usr/local/bin/garjacl
</pre>

<table class="infowarn"><tr>
<td><img src="warning.png" alt="Warning"></td>
<td>In order for this to work on Microsoft Windows, you must be running a Unix shell under Cygwin. To work under Unix, the JACL program must be set to executable using a command such as:

<pre>
chmod 755 grail.jacl
</pre>

</td>
</tr></table>

<h2><a class="section" name="tutorial2">Program Structure</a></h2>

<P>A JACL program consists of two fundamental components: data and code. Data is provided in the form of definitions, code in the form of functions. There are nine types of definition, their keywords being <B>location</B>, <B>object</B>, <B>synonym</B>, <B>filter</B>, <B>integer</B>, <B>constant</B>, <b>string</b>, <b>attribute</b> and <B>grammar</B>.
A function begins with a left curly brace (<b>{</b>) followed directly by its name, and ends with a right curly brace (<b>}</b>) on a line on its own. Any text that appears on the lines between the two curly braces is considered to be the code body of that function.
Other than comments, the only text that can appear outside a function is one of the nine definitions. While definitions are read once at the start of the game then stored in memory, functions are executed from the game file as required during play. 

<h2><a class="section" name="tutorial3">Getting Started</a></h2>

<p>To begin writing your first adventure game using JACL you will need to copy the file <b>frame.jacl</b> from the directory <b>jacl/games/include</b> to a file called <b>game.jacl</b> in the directory <b>jacl/games</b>. This new file is the one you will edit to create your game.

<p>The file <B>frame.jacl</B> is a skeleton program that provides a good starting point when writing a piece of interactive fiction from scratch. The file <b>verbs.library</b>, is also included from the last line of <b>frame.jacl</b>. While the code in <b>frame.jacl</b> should be modified to suit your game, the code in <b>verbs.library</b> should never be modified. This allows new versions of <b>verbs.library</b> to be installed without adversely affecting your game. <b>verbs.library</b> contains a extensive set of verbs for use by the player during the game.

<P>Now open <B>game.jacl</B>, the beginnings of our tutorial game, with your favourite text editor. The name <B>game.jacl</B> has been chosen for the purpose of this tutorial, your game file can be given any name you like.

<p>At the top of this file you will find four constants. These constants are used to store bibliographical information about your game that can be directly read by cataloguing tools. For this reason the names of these constants, including the case, must be left unchanged which their values changed as appropriate. For information visit <a href="http://babel.ifarchive.org/">The Treaty of Babel</a>.

<h2><a class="section" name="tutorial4">Locations</a></h2>

<P>In text adventure games, a location represents a discrete physical space that the player and other objects can be in, such as a room in a house. Although objects can also be placed inside other objects, the player can only be in a location. We will now begin to define the first location of this tutorial game. To do this, insert the following line of code below the bibliographical constants:

<pre>
location bedroom: master bedroom
</pre>

<P>This line states that we wish to define a <B>location</B> with the label <B>bedroom.</B> This label is the name by which we will refer to this location within our code. For those of you with previous programming experience, you can think of this label much in the same way as a variable name.
Following the location's label is a space-delimited list of names by which the player can refer to this location during game play. All locations must have at least one name, and may have as many as can fit into a single line of code. In this example, the location has two names: <b>master</b> and <b>bedroom</b>. If you do not supply any names, the location's label will become its one and only name.

<P>All the locations and objects you define have associated properties. When you define an object or location it is possible to set the initial value of these properties. For the new location <b>bedroom</b> we are going to set the initial value of two properties: <B>short</B> and <b>west</b>. This is done by adding two more lines to the location definition so it looks like this:

<pre>
location bedroom: master bedroom
  short       a "master bedroom"
  west        bathroom
</pre>

<p><b>short</b> is a two-value property used to supply a short description of the location. This description is used by the library code when referring to the location in a sentence. The first parameter after the keyword <B>short</B> is its indefinite article, the second is its description. The supplied indefinite article is used to prefix the description when the <B>{list}</B> macro is used. This would normally be <B>a</B> or <B>an</B>. 

<p>The <b>{list}</b> macro is used as a parameter of a <b>write</b> command as a way of outputing text that refers to an object. It is normally used when referring to an object or location in a list of several objects or locations. The most common example of this is a list of objects that are inside another object or held by another object, such as a desk drawer or the player's inventory. Below is an example of the <b>{list}</b> macro:

<pre>
write "The house you are in has " bedroom{list} ".^"
</pre>

<p>When executed, this line of code will display:

<pre>
The house you are in has a master bedroom.
</pre>

<p>The <b>write</b> command above uses this macro by specifying the label of the location <b>bedroom</b> followed by <b>{list}</b>, the name of a macro. The other point of note with the above <b>write</b> command is the use of the caret character (<b>^</b>). The caret character is used to indicate where a new line on the screen should be started. The end of a <b>write</b> command does not automatically mean the end of a line of text.

<p>The <b>{list}</b> macro is more commonly used with objects than locations, as only objects can be taken or placed inside other objects. It is more common for locations to be referred to using the <b>{the}</b> macro. This macro displays the object's definite article (the word <b>the</b> by default) followed by the object or locations <b>short</b> description text. For example:

<pre>
write "You are in " bedroom{the} ".^"
</pre>

<p>will display:

<pre>
You are in the master bedroom.
</pre>

<p>&quot;Why not just write <b>You are in the master bedroom</b> directly?&quot; I hear you ask. Given the above two lines of code, you could. The <b>{list}</b> and <b>{the}</b> macros are normally used, however, with an integer variable, not an object label. All objects and locations are assigned a unique number starting at one and numbered sequentially as they appear in your program. Using this numbering system, an integer variable can be used to refer to an object or location. The most common integer variable used as an object pointer is <b>noun1</b>. This variable represents the first object referred to in any given command typed by the player. For example:

<pre>
write "There is nothing special about " noun1{the} ".^"
</pre>

<p>If the player was to type the command <b>examine bedroom</b>, the above code would produce the output:

<pre>
There is nothing special about the master bedroom.
</pre>

<P>There is also one special purpose indefinite article: <B>name</B>. If <B>name</B> is specified as an object's article, the <B>short</B> description text will not be prefixed with anything whether displayed using <B>noun1{the}</B> or <B>noun1{list}</B>. This would normally be used when the description text is a proper noun. For more information on macros, see the section on <a href="#screendisplay5">Printing the Names and Descriptions of Objects</a>. 

<P>The third line of our location definition states that if the player travels <B>west</B> from this location, then they should be moved to a yet-to-be-coded location with the label <B>bathroom</B>. You will learn more about this soon.

<P>The next thing we will do is give the location its long description. This is the text that the player will see when they are in this location. We do this by associating a function called <B>look</b> with the <B>location</B> definition.

<p>A function can be associated with an <B>object</B>, a <B>location</B> or be global. Functions are defined by starting a line with an opening curly brace (<b>{</b>) followed directly by the function's name. Any function whose name does not begin with a plus sign is automatically associated with the last <B>object</B> or <B>location</B> defined above it in the game file. Any function whose name does begin with a plus sign is said to be global. A global function is in no way associated with a particular <B>object</B> or <B>location</B>. A function definition is finished by placing a closing curly brace (<b>}</b>) on a line of its own. More information about functions and how they are associated with items is provided in the chapter on <a href="functions.html">Functions</a>. 

<P>Below is the code for the <B>look</B> function to be added directly beneath the definition for the location <B>bedroom</B>. This function simply outputs plain text and therefore makes use of the <b>print</b> command instead of the <b>write</b> command we used earlier. This command takes no parameters and starts outputing all text from the following line until it reaches a line that has a period (<b>.</b>) as its first non-whitespace character.

<pre>
{look
print:
   You are in your bedroom. There is a
   large, soft bed in the centre of the room
   while a doorway to the west leads into the
   bathroom.^
.
}
</pre>

<p>The colon after the print command is only an optional whitespace character used for presentation purposes. When using the <b>print</b> command, any following line of text that does not end with a caret (<b>^</b>), will have an implicit space added to the end before printing the following line. To prevent this space from being added, finish the line with a backslash (<b>\</b>) character. For more information see the chapter on <a href="screendisplay.html">Screen Display</a>.

<P>As discussed earlier, the definition of the location <B>bedroom</B> refers to a second location called <B>bathroom</B>, located to its west. We will now add this second location to the game. The code for this new location should be placed after the <B>look</B> function that is associated with the bedroom:

<pre>
location bathroom: bathroom
  short        the "bathroom"
  east         bedroom
  out          bedroom

{look
print:
   You are in the bathroom. The only
   exit from here is back east to the bedroom.
.
}

{movement
if compass = east : compass = out
   write "You bang your head as you walk "
   write "through the doorway.^"
   return false
endif
write "The only exit from here is to the "
write "east.^"
}
</pre>

<P>There are two points of note with this new location definition. Firstly, it demonstrates that it is quite valid (and in some cases highly desirable), to have more than one direction lead to the same location. In this case, if the player travels <B>east</B> or <B>out</B> from this location, they will be moved to the location with the label of <B>bedroom</B>. This completes the logical two-way connection of the bedroom to the bathroom, and the bathroom to the bedroom.

<P>Secondly, it has a <B>movement</B> function associated with it. This function is called automatically by the interpreter whenever the player moves, or attempts to move, out of this location. If this function does not exist or returns <B>false</B>, the move will continue as normal. If the function returns <B>true</B>, the move will be prevented from taking place. Any function that reaches its closing brace will terminate as though it had issued a <b>return true</b> command. For move information on movement functions, see the section on <a href="movement.html">Movement</a>. The <B>if</B> statement in the movement function says that if variable <B>compass</B> equals <B>east</B> or <B>out</B>, then the code up until the matching <B>endif</B> command should be executed. The variable <b>compass</b> is set to the direction the player is attempting to move in by the interpreter before the <b>movement</b> function is called. For more information on the <B>if</B> command, see the section on <a href="flowcontrol.html">Flow Control</a>.

<table class="infowarn"><tr>
<td><img src="info.png" alt="Information"></td>
<td><b>east</b> and <b>out</b> are constants predefined in the interpreter to represent static numerical values. All the directions that can be travelled in from a location are stored in a 12 element array. These numerical values correspond to the index of the array element that stores the destination for that direction.</td>
</tr></table>

<h2><a class="section" name="tutorial5">The Player</a></h2>

<P>Now that we have our small, two-location world, we need a player to explore it. There is a definition for an object with the label <B>kryten</B> in <B>frame.jacl</B>. This object has been made with the specific purpose of representing the player and looks as follows:

<pre>
object kryten: myself self me
 short      name "yourself"
 has        ANIMATE; FEMALE
 capacity   42
 parent     ;SPECIFY STARTING LOCATION HERE
 player
</pre>

<table class="infowarn"><tr>
<td><img src="info.png" alt="Information"></td>
<td>The label <B>kryten</B> was chosen for the object representing the player after playing Infocom's Zork I with Frotz's <B>-o</B> option. This shows the object representing the player as having the name <B>cretin</B>. Being both an Infocom fan and a Red Dwarf fan, the choice was obvious.</td>
</tr></table>

<P>The first line of this definition starts with the keyword <B>object</B>. This tells the interpreter that we want to define a new object with the label <B>kryten</B>. The words following this label are a list of names for the object. This, as you will have noticed, is the same format as defining a new location. 

<table class="infowarn"><tr>
<td><img src="info.png" alt="Information"></TD>
<td>In JACL, a colon is treated as white space (as is a comma and tab). I simply use a colon in preference to a space in certain places to make the code more readable.</TD>
</tr></table>

<p>The second line contains a <b>short</b> keyword. This has the same purpose as the <b>short</b> keyword associated with bedroom above. In the case of our object <B>kryten</B>, however, the word <B>name</B> appears as the indefinite article. When using a <b>{list}</b> or <b>{the}</b> macro, anything other than the word <B>name</B> is printed verbatim. When <B>name</B> is specified, the JACL interpreter will not prefix the <B>short</B> description text with anything. For example, when <b>noun1</b> points to the object <b>kryten</b>, the following code:

<pre>
write "You can't take " noun1{the} .^
write "You can't take " noun1{list} .^ 
</pre>

<p>will produce the output:

<pre>
You can't take yourself.
You can't take yourself.
</pre>

<P>The third line of the object definition starts with the keyword <B>has</B> followed by the attribute <B>ANIMATE</B>. Both objects and locations may have as many or as few of the available attributes as required. Attributes are simply boolean flags that can be given to and taken from objects and locations at any stage during the game. They are frequently tested for by code in <b>verbs.library</b>.
For example, the standard function to open an object will first check that it doesn't have the attribute <B>LOCKED</B> before taking away the attribute <B>CLOSED</B>, thus resulting in it becoming open. The attribute <B>ANIMATE</B> is tested for by functions associated with actions such as talking.
If the player attempts to talk to an object that does not have the attribute <B>ANIMATE</B>, they are informed that the action is not logically possible. For a more information, see the chapter on <a href="attributes.html">Attributes</a>.

<P>Following the attribute <B>ANIMATE</B>, you will see a semicolon then the attribute <B>FEMALE</B>. A semicolon (or hash symbol) signifies that all text following it, until the end of the line, is a comment. Comments have no effect on a game, they are only there to serve as notes for the author's benefit. In this case, deleting the semicolon will mean that the extra attribute will no longer be ignored. This will cause the player to be referred to in the feminine by all code in <b>verbs.library</b>.

<P>The fourth line, beginning with the keyword <B>capacity</B>, indicates how many <b>mass</b> units the object can hold. In the case of an object with the attribute <B>ANIMATE</B> (such as this object representing the player), it indicates how much they can carry. In the case of an object with the attribute <B>CONTAINER</B>, it indicates how much can be placed inside it, while in the case of an object with the attribute <B>SURFACE</B>, it indicates how much can be placed on top of it.

<p>The fifth line, beginning with the keyword <b>parent</b>, is followed by the label of another object or location. This indicates where the object is to be when the game starts. In this game, the player is to start in the location <b>bedroom</b>, so we must modify this line to read:

<pre>
parent    bedroom
</pre>

<p>If an object doesn't have a <b>parent</b> property explicitly defined it will start the game with its <b>parent</b> property set to the nearest location defined above it in the game file.

<P>The final line has the keyword <b>player</b>. This keyword tells the interpreter to set the interger variable <b>player</b> to point to the object <b>kryten</b> before the game begins. Only one object should have the keyword <b>player</b> defined, although the object pointer <b>player</b> can be changed to point to another object at any stage during the game if desired.

<P>The properties that are associated with an <B>object</B> definition may be placed in any order. There are other properties that can be associated with an object that we have not set here, as the defaults used when they are absent are valid for our purposes. All of the possible properties are discussed in the chapter <a href="definitions.html">Definitions in Detail</a>.

<h2><a class="section" name="tutorial6">Some Introductory Text</a></h2>

<p>When a game is started or restarted, the function <b>+intro</b> is executed. The main purpose of this function is to display the game's title, the author's name and some text introducing the game. Any other commands required to set the initial state of the game-world can also be placed in <b>+intro</b>. Below is the <b>+intro</b> function for the tutorial game. This is simply the <b>+intro</b> function already present in your skeleton game file with an extra <b>print</b> block added after the title and the author of the game are written to the screen:

<pre>
{+intro
style bold
write "^^" game_title
style normal
write " by " game_author "^^^"

print:
   Your alarm rings and you climb out
   of bed. Monday morning again so soon. Oh well,
   at least your house doesn't have a front door
   so you have a good excuse for not going to
   work.^^
.

if here hasnt OUTDOORS
   move north_wall to here
   move south_wall to here
   move east_wall to here
   move west_wall to here
endall

move ground to here

look
}
</pre>

<p>This function begins by using the <b>style</b> command to set the font to <b>bold</b> and then printing the value of the string constant <b>game_title</b>. This will be whatever string you set it to at the top of your game file. Next the font style is set back to <b>normal</b> and the value of the string constant <b>game_author</b> is output. The author's name is followed by three newline character to insert two blank lines. For more information on these commands see the chapter on <a href="screendisplay.html">Screen Display</a>.

<p>After the title header, a game-specific print block outputs the introductory text for this game. This is the text that should set the scene for the player and introduce them to the game character they are playing.

<p>The next block of code moves all the wall objects to the current location if the current location doesn't have the attribute <b>OUTDOORS</b>. These objects are defined in the file <b>frame.jacl</b> and should be moved to the current location each time the player moves to a location that doesn't have the attribute <b>OUTDOORS</b>. This is done using a similar block of code placed in the global function <b>+movement</b>. When the function <b>+intro</b> is executed, the current location will always be the starting location. For this reason, the <b>if</b> statement is not strictly necessary, but it is a good safeguard none the less. 

<p>The final line of the function contains a <b>look</b> command. This command prints the description of the current location and objects that are in this location.

<p>Below is the default content of the function <b>+movement</b> that is executed each time the player attempts to move out of the current location:

<pre>
{+movement
ifall destination != nowhere : destination hasnt OUTDOORS
   move north_wall to destination
   move south_wall to destination
   move east_wall to destination
   move west_wall to destination
endif
return false
}
</pre>

<h2><a class="section" name="tutorial7">Objects</a></h2>

<P>You can now try playing the beginnings of this game by first typing the command from within the <b>games</b> subdirectory: 

<pre>
../bin/garjacl game.jacl
</pre> 

<p>When you do so, you should see something like the screen below:

<center>&nbsp;<br><img src="tutorial.png" alt="The tutorial game running in the JACL interpreter"><br>&nbsp;<br></center>

<p>Once playing, the following commands should give you the responses shown:

<pre>
&gt;w
You are in the bathroom. The only exit from 
here is back east into the bedroom.

&gt;i
You are empty-handed.

&gt;smell
Nothing strikes you as out of the ordinary.

&gt;listen
You don't hear anything out of the ordinary.

&gt;sit
You plonk yourself down for a moments rest.

&gt;examine north wall
There is nothing special about the north wall.
</pre>

<P>As you can see, at this stage there is very little for the player to interact with in this game. Therefore, the next thing we will do is add another object: a small wooden box. We add the small wooden box by inserting the following object definition after the bathroom's <B>look</B> function:

<pre>
object box: small wooden box
 has        CLOSABLE CONTAINER CLOSED
 short      a "small wooden box"
 long       "There is a small wooden box here."
 mass       25
 capacity   20
</pre>

<P>The first line says that we are defining an <B>object</B> and that it should have the label <B>box</B>. It then goes on to say that it can be referred to by the player with any combination of the names <B>small</B>, <B>wooden</B> and <B>box</B>.

<P>The second line states that it should have the attributes <B>CLOSABLE, CONTAINER </B>and<B> CLOSED</B>. These attributes tell the appropriate verbs in the library that this object may be opened and closed, have things placed inside it and that it should be closed when the game begins.

<P>The third line, as with the <B>short</B> statement for the object <b>kryten</b>, indicates the text to appear when either the object's <B>{list}</B> or <B>{the} </B>macro is used. In this case, however, rather than <B>name</B>, the article is set to <B>a</B>. Therefore, when <B>noun1</B> is set to <B>box</B>:

<pre>
write noun1{list}
</pre>

<P>will display "a small wooden box", while

<pre>
write noun1{the}
</pre>

<P>will display "the small wooden box".

<P>The fourth line, beginning with the keyword <B>long</B>, details the text to be displayed when this object is in the current location. If an object has a <B>mass</B> of <B>scenery</B>, the <B>long</B> text will not be displayed. This is because a <B>mass</B> of <B>scenery</B> indicates that the object cannot be taken and should therefore be described in its parent location's <B>look</B> function instead, if at all.

<table class="infowarn"><tr>
<td><img src="info.png" alt="Information"></td>
<td>Internally, <b>scenery</b> is a constant with a value of 100 while <b>heavy</b> has a value of 99. An object that has its <b>mass</b> set to <b>heavy</b> will have its <b>long</b> text displayed when the object is in the current location, but can't be taken by the player. It is good to keep this in mind when choosing a <b>mass</b> value for each object.</td>
</tr></table>

<P>The fifth line sets this object to have a <b>mass</b> of 25. When the player takes an object, the value of the object's <b>mass</b> property is subtracted from the player's <b>capacity</b> property. This indicates that the player's <B>capacity</B> property must currently be 25 or greater for him or her to be able to take the box. Any other container object the player attempts to put the box in or on must also have a <B>capacity</B> property that is currently 25 or greater. 

<P>The final line, a <B>capacity</B> property, indicates how many <b>mass</b> units the box can hold. In this case it is set to 20. This means that other objects may be placed inside this object (due to it having the <B>CONTAINER</B> attribute) until the total of their <B>mass</B> properties equals 20.

<P>As this new object has no <b>parent</b> property, it will start the game in the bathroom. This is because the bathroom is the nearest location defined above it in the game file. Any objects with no <b>parent</b> property will begin in the nearest location above it regardless of the number of object or function definitions inbetween.

<P>Before we play the game again, we will add a second object by putting the following code beneath the definition for the box.

<pre>
object note: orange note
 short    an "orange note"
 long     "An orange note rests on the ground."
 parent   box
 mass     5
</pre>

<P>As you can see, the note's <B>parent</B> property is followed by the label of the box object. This indicates that the note is to start the game inside the box. If this <B>parent</B> property where to be omitted, the note would begin in the bathroom along with the box, as this is the last location defined above it in the game file.

<P>If the box object had the attribute <B>SURFACE</B> rather than <B>CONTAINER</B>, the note would start the game on top of it. If the box object had the attribute <B>ANIMATE</B>, the note would start the game being carried by it.

<h2><a class="section" name="tutorial8">Verbs and Functions</a></h2>

<P>Now if you restart the game, you can walk west into the bathroom and find the small wooden box. You can take it, open it, look in it, close it, and apply a whole range of other standard verbs present in <B>verbs.library</B> to it. When it is open, you will also be able to take the orange note out of it.

<P>To explain a little bit about how verbs work, lets take a closer look at the verb <B>read</B>. The <B>grammar</B> definition and the global function for the verb <b>read</b> can be found in <B>verbs.library</B> and are reproduced here:

<pre>
grammar read *present &gt;read

{+read
if +important&lt;noun1 = true
   return true
endif
if +darkness = true
   return true
endif
write "There is nothing on " noun1{the} " to read.^"
}
</pre>

<P>This <B>grammar</B> definition states that if the player types a command of the format "<B>read</B> <I>ObjectThatIsPresent</I>" during the game, then certain functions with the base name <B>read</B> should be executed.

<P>When the player makes a move, the JACL interpreter will set the integer variables <B>noun1</B> and <B>noun2</B> to point to the objects referred to in the command. They will be set based on the order the objects appear in the move. For example, if the player types the command <B>give sword to troll </B>the <B>+give_to</B> function would be called with <B>noun1</B> being set to the sword and <B>noun2</B> being set to the troll. 

<P>Returning to our read example, upon identifying the player's command as matching this <b>grammar</b> definition, the JACL interpreter will first attempt to execute a function called <B>read</B> that is associated with the object that the player is attempting to read. If this does not exist, it will try to execute the same function name only prefixed with a plus sign. This is a global function and can be thought of as the default action that occurs for that verb if no object-specific one is provided.

<P>Since we have not associated a <B>read</B> function with our <B>note</B> object, when the player attempts to read it the global function <B>+read</B> will be executed. If you try this you will see that the default action for the read verb is very simple, but appropriate for most objects. The default function <B>+read</B> is not an appropriate, however, for our note object. We will therefore replace it by adding a function called <B>read</B> that is associated with the object <B>note</B>. This function is even simpler:

<pre>
{read
write "Welcome to Jamaica and have a nice day.^"
}
</pre>

<P>We associate this function with the note object by typing it directly after the note object's definition. For clarity, you can of course leave a blank line or two in between the note definition and read function. This local <B>read</B> function will now be executed in place of <B>+read </B>whenever the player types the command <B>read note</B>, provided the note is visible to the player.

<table class="infowarn"><tr>
<td><img src="info.png" alt="Information"></td>
<td>The <B>read</B> function above should really be given two names. This is done by placing the second name after the first, such as <B>{read : examine</B>. This means that both reading and examining the note will lead to the same code being executed. Any function may have as many names as can fit in a single line of JACL code.</td>
</tr></table>

<h2><a class="section" name="tutorial9">Overriding Functions</a></h2>

<P>Compared to <B>+read</B>, the <B>+close</B> function is quite long. Although the default <B>+close</B> function is perfectly suitable for our needs, we will use it to demonstrate overriding the default outcome of a function. The <b>+close</b> function is reproduced here:

<pre>
{+close
if +important&lt;noun1 = true
   return true
endif
if +darkness = true
   return true
endif
if +reach&lt;noun1 = true
   return true
endif
if noun1 hasnt CLOSABLE
  write "You can't close " noun1{the} .^
  set time = false
  return
endif
if noun1 has CLOSED
  write  noun1{The} noun1{is} " already closed.^"
  set time = false
  return
endif
override
write "You close " noun1{the} .^
ensure noun1 has CLOSED
}
</pre>

<P>During the course of the <B>+close</B> function, several tests are performed to determine the appropriate outcome. At the point in the function where it is decided that the command should be successful there is an <B>override</B> command. This command tells the JACL interpreter to look for a function called <B>close_override</B> that is associated with the object that the player is attempting to close. If this exists it will be executed in place of anything beyond the <B>override</B> command. If this does not exist, then execution of the <B>+close</B> function continues as normal from the line following the <B>override</B> command.

<P>The reason for the <B>override</B> command is that a <B>close</B> function that is associated with any object will get called straight away, completely replacing all the code in the default function <B>+close</B>. This means that any test, such as whether the object is already closed, will have to be repeated manually in the new, local function. This is not so much of a problem with a simple verb like <B>read</B>, as no tests are performed, but with some other verbs this can be a considerable amount of code. The <B>override</B> command therefore provides an opportunity to override only the outcome, not the entire function.

<P>To demonstrate, we will override the normal outcome of closing the box. This is done by associating the following function with the object <B>box</B>:

<pre>
{close_override
write &quot;The lid creaks as you push it closed.^&quot;
ensure box has CLOSED
}
</pre>

<P>When the box is closed by the player, all the tests before the <B>override</B> command in the <B>+close</B> function will be executed. If all the tests pass, the code in <B>close_override</B> will be executed in place of any code after the <b>override</b> command. 

<table class="infowarn"><tr>
<td><img src="warning.png" alt="Warning"></td>
<td>It is important to be careful that you use an override function (or perform the tests manually) whenever a verb has several possible outcomes. If the above function was to be called <B>close</B>, as opposed to <B>close_override</B>, then the box could be closed over and over again - clearly a bug.</td>
</tr></table>

<h2><a class="section" name="tutorial10">Doors</a></h2>

<P>We will now add a third and final location. This location will be a living room and will be placed south of the bedroom. We are also going to place a door between the bedroom and living room. Doors are common in interactive fiction, implemented using a regular object, and yet in some ways odd and out of the ordinary. The thing that makes a doors different to most of the other objects in your game is that they live between two locations, rather than inside one, and need to be accessible from both locations. 

<p>Before we move onto the door itself, add the following location definition beneath the <B>close_override</B> function that is associated with the box:

<pre>
location living_room: living room
  short        the &quot;living room&quot;
  north        nowhere

{look
if here has VISITED
   print:
      You have returned to the living
      room.^
   .
else
   print:
      You are in the living room. There
      is a small television perched on a low-lying
      table in front of a sofa.^
   .
endif
}
</pre>

<P>The <B>look</B> function associated with the living room is slightly more complex than those associated with the other locations. After the player enters a location for the first time, it is automatically given the attribute <B>VISITED</B> by the JACL interpreter. This latest <B>look</B> function tests the current location for this attribute and displays a shorter, more appropriate description if it has it. Feel free at this stage to go back and add this test to the <B>look</B> functions for the bedroom and bathroom. The <b>north</b> direction is specified as leading to <b>nowhere</b> as the game will start with the door closed. As <b>nowhere</b> is the default for an unspecified direction, we could have simply omitted it. I prefer to specify <b>nowhere</b> for directions that only <i>currently</i> lead nowhere, but will change during the course of the game.

<P>As you may have guessed, I would also add this line to the bedroom giving the complete definition of:

<pre>
location bedroom: master bedroom
  west        bathroom
  south       nowhere
</pre>

<p>As you will see later, we will make the door accessible from two locations by moving it around, so it does not really matter when you define its object. As the player begins the game in the bedroom, and this is where they will first encounter the door, beneath the bedroom definition is as good a place as any for the door's definition:

<pre>
object door : bedroom door
 short      the "bedroom door"
 has        CLOSABLE CLOSED

{open_override
set bedroom(south) = living_room
set living_room(north) = bedroom
return false
}

{close_override
set bedroom(south) = nowhere
set living_room(north) = nowhere
return false
}
</pre>

<p>The above code defines an object for the door that has the attributes <b>CLOSABLE</b> and <b>CLOSED</b>. These attributes allow the verbs in the library to manipulate the door appropriately. Like the box, the outcome of the <b>close</b> verb is overriden, as is the outcome of the <b>open</b> verb. Unlike the box, the override functions for the door both end with a <b>return false</b> command. 

<p>As discussed above, when the interpreter encounters the <b>override</b> command in the global function <b>+close</b>, it will look for the function <b>close_override</b> that is associated with the object being closed. If this function does not exist, or returns <b>false</b>, execution will continue from the first line after the <b>override</b> command. As we have defined an associated <b>close_override</b> function, it will be executed at this point. It is possible, however, for the override function to issue a <b>return false</b> after a test has determined that the default outcome is sufficient in a particular instance. If this happens, the <b>close_override</b> function simply provides some code to execute <i>in addition</i> to the default outcome. In other words, the default outcome will occur as if the override function did not exist at all if the override function returns <b>false</b>.

<p>Now it is time to move the door between the bedroom and living room so that it is accessible from both locations. As with most programming challenges, there are many ways the desired effect could be achieved. One option is to create two doors, one in the bedroom and one in the living room, then keeping these two doors synchronised. In this case we are going to add two <b>eachturn</b> functions: one associated with the bedroom and one with the living room. These two functions move the door to the current location and each have a single line of identical code:

<pre>
{eachturn
move door to here
}
</pre>

<p>It is possible to give a function more than one name by supplying a list of names separated by white space. This is a very common technique for making several possible moves by the player cause the same outcome. For example, in <i>The Unholy Grail</i>, the message for examining the rod for opening and closing the blinds is exactly the same as the one for attemting to take it:

<pre>
{examine : take
print:
   The plastic rod is attached to the blinds and
   can be turned in order to open and close them.^
.
}
</pre>

<p>Internally, when a function is associated with an object, the function's name is stored as the supplied name followed by an underscore, then the label of the object it is associated with. This means that the above function would have two full internal names being <b>examine_rod</b> and <b>take_rod</b>. As the two <b>eachturn</b> functions in this tutorial game have identical content it would be good to use a similar technique to avoid the duplication. The difference between the <b>eachturn</b> functions and the <b>examine</b> and <b>take</b> functions is that with the <b>eachturn</b> functions, it is the same action for two different objects (in this case, locations) rather than two different actions for the same object. It is possible to overcome this problem by prefixing one of the function's names with an asterisk (<b>*</b>), and then supplying a full internal name manually. The asterisk will not become part of the full internal name (unlike the plus sign at the start of a global function), it simply tells the interpreter that you are going to handle the association manually and that it should not automatically add the label of the object above it in the source file as a suffix.

<p>Using this technique we are able to write a single <b>eachturn</b> function and associate it with both the bedroom and the living room by adding the following code somewhere below the definition for the living room:

<pre>
{eachturn : *eachturn_bedroom
move door to here
}
</pre>

<p>This will create a function that has two names. The full internal version of these two names will be <b>eachturn_living_room</b> and <b>eachturn_bedroom</b>. The first association is done automatically while the second is done manually by using the asterisk prefix. Don't worry if this doesn't make complete sense to you right now, it is not an essential technique for writing JACL games, particularly with functions as short as this <b>eachturn</b> function. More information on creating a function name using the asterisk prefix can be found in the chapter on <a href="#functions0">Functions</a>.

<p>Regardless of whether you use this technique, or associate an identical <b>eachturn</b> function with the bedroom and the living room in the usual manner, you will now have a functioning door. The door is handled correctly by the library verbs <b>open</b> and <b>close</b> due to having the <b>CLOSABLE</b> attribute and it is always accessible from the bedroom <i>and</i> living room thanks to the <b>eachturn</b> functions. Finally, the extra code supplied in the <b>open_override</b> and <b>close_override</b> functions create and destroy the extra links between the bedroom and living room as appropriate.

<table class="infowarn"><tr>
<td><img src="info.png" alt="Information"></td>
<td>It is also possible to have moved the door from location to location using <b>movement</b> functions that are associated with bedroom and living room. These functions would need to test which way the player is travelling, and move the door to that location if it is into the bedroom or living room. Although this requires slightly more complicated code, it is more efficient as the move is only done once when required, not every turn that the player then spends in that location. With a small game like this, however, simplicity is of greater concern than performance.</td>
</tr></table>

<!-- NEW PAGE -->
<h2><a class="section" name="tutorial11">Non-player Characters</a></h2>

<P>Most games will include at least one character other than the player, and this small tutorial game is no exception. The character we will add is the player's son who will be sitting in the living room watching television. Fortunately for us, simulating the responsiveness of a teenager watching television is not hard.

<P>We will begin by adding the following two object definitions and their associated <B>examine</B> functions beneath the definition for the living room: 

<pre>
attribute EXAMINED

object television: television tv tele
 short    a &quot;television&quot;
 mass     scenery

{examine
if self has EXAMINED
   write "It's Rick who is the TV addict, not you.^"
   return
endif
write "There is currently a cartoon showing on the "
write "television.^"
ensure self has EXAMINED
}

object rick: son boy teenager rick
 has     ANIMATE
 short   name &quot;Rick&quot;
 long    &quot;Rick is here, watching television.&quot;
 mass    heavy

{examine
if @ = 1
   print:
      Rick is staring blankly at the television screen.^
   .
else
   print:
      Rick is still gazing into the television's screen.^
   .
endif
}
</pre>

<p>Before the object definitions is the definition of a user attribute called <b>EXAMINED</b>. Up to 32 user attributes can be defined, and like the system attributes <b>CLOSABLE</b> and <b>CLOSED</b>, they don't have a value, they are simply flags that an object either has or hasn't. The <b>examine</b> function for the television makes use of this attribute to test if the television has already been examined before. Unlike defining a constant as a synonym for one of an object's integer properties (see the section on The Passing of Time below), user attributes are not synonyms for system attributes, they are an entirely separate set of 32 attributes.

<p>The <b>examine</b> function for Rick achieves a similar result using an entirely different mechanism. When the JACL interpreter executes a function it automatically creates and increments a counter that records how many times that function has been called. This counter is referred to in code as an at sign (<b>@</b>) followed by the name of the function. For example, the number of times the function called when examining Rick has been called can be checked from any other code by examining the contents of the container <b>@examine_rick</b>. When an at sign is referred to on its own, such as in the example above, it is taken to refer to the call count of function that is currently running.

<P>To make both Rick and the television respond to the player's commands, we will be required to associate more functions with each of them. This process of creating objects and associating functions with them is the essence of writing text adventure games using JACL. 

<P>The first action we will cater for is talking to Rick. The <B>grammar</B> statement that matches the command <B>talk to rick</B> calls the function <B>talk_to</B>. Therefore, in order to give a custom response to this command, we must associate a <B>talk_to</B> function with the object <B>rick</B>. This function should look as follows:

<pre>
{talk_to
print:
   ~Uh, yeah, I'll do it in a minute,~
   Rick mumbles with out looking up. You have
   quite a strong suspicion that he didn't
   really hear a word you said.^
.
}
</pre>

<P>The above <b>talk_to</b> function is associated with Rick in the same way that the <b>read</b> function was associated with the note earlier. For a complete list of all the grammar statements defined in the library and the names of the functions they call, see <a href="verbfunctions.html">APPENDIX B: Library Verb Functions</a>.

<table class="infowarn"><tr>
<td><img src="warning.png" alt="Warning"></td>
<td>As double quotes are used to enclose any command parameter that contains spaces, attempting to print a double quote directly to the screen will not give the desired results. Wherever you want to print a double quote put a tilde character (<b>~</b>) and the interpreter will print a double quote in its place.</td>
</tr></table>

<p>To code a response to the player asking Rick about something in particular, you need to associate a function that has a compound name with the object <b>rick</b>. The <b>grammar</b> definition for the command <b>ask</b> <i>noun1</i> <b>about</b> <i>noun2</i> calls the function <b>ask_about</b>, so this is the beginning of the function name. You specify which object is being asked about by appending an underscore and then the label of the object to the function name. For example, the following function (when associated with the object <b>rick</b>) will be called if the player types the command <b>ask rick about note</b>:

<pre>
object rick: son boy teenager rick
 ...

{ask_about_note
print:
   ~I don't know nothing about no note,~ Rick says 
   looking at your blankly.^
.
}
</pre>

<p>This gives a custom response when the player asks Rick about the note, but what if we want to give the same custom response no matter what object Rick is asked about? The hard way would be to associate a function for each and every object that prints your required response. The easy way is to write a <B>+default_ask_about</B> function and test whether the person being asked is Rick. Any <b>+default</b> function can be thought of as a replacement for the code that comes after the <b>override</b> command. If you search through the <b>verbs.library</b> for <b>override</b> commands you will see that they occur at the point in a verb's global function where it has been decided that the verb should be successful. This allows a <b>+default</b> function to override the default outcome of a verb without needing to repeat all the preliminary checks. The global <B>default</B> function for any given action is called when an <B>override</B> command is reached and a specific override function for the object or objects in question does not exist. The order that functions are called in and the precedence they have over each other is fully detailed in the chapter on <a href="functions.html">Functions</a>.

<p>This is <b>+default</b> function is a global function (as indicated by the leading plus sign), so it doesn't matter where you put it in the code. Here is the code to create a default response for whenever Rick is asked about an object:

<pre>
{+default_ask_about
if noun1 = rick
   print:
      Rick blinks several times then
      pokes out his bottom lip. This, you have
      figured out over the years, translates to,
      ~Not a clue.~^
   .
   return
endif
return false
}
</pre>

<table class="infowarn"><tr>
<td><img src="info.png" alt="Information"></td>
<td>If both this function and the specific <b>ask_about_note</b> function exist, the <b>ask_about_note</b> function will be executed if player types <b>ask rick about note</b> in preference over this function. </td>
</tr></table>

<P>The first thing this function does is test the current value of <B>noun1</B>. As disscussed above, <b>noun1</b> and <b>noun2</b> are object pointers that point to the first and second objects referred to in the player's move. If this is currently set to <B>rick</B>, our new default message will be displayed. If <b>noun1</b> is not set to <B>rick</B>, a <B>return false</B> command is executed. This command causes the interpreter to do whatever it would have normally done had this function not existed at all. In this case, the result would be to perform the original default action specified in the library. 

<h2><a class="section" name="tutorial12">The Passing of Time</a></h2>

<P>In many games actions will occur based on the passing of time rather than the direct actions of the player. If the player was to do nothing other than type <B>wait</B>, people would still come and go, the song playing on a nearby radio would change and the sun would set. All these events would be coded for within an <B>eachturn</B> function. There can be an <B>eachturn</B> function associated with each location and a single global one. 

<p>The variable <b>time</b> is automatically set to <b>true</b> before the player types each of their moves. If the player's move is not possible, this variable should be set to <B>false</B>. If, when the command has been fully processed, <B>time</B> is still set to <B>true</B>, the appropriate <B>eachturn</B> functions are executed. The first function executed, if it exists, is the <B>eachturn</B> function that is associated with the location the player is currently in. When this has finished, the global function <B>+eachturn</B> is executed. Once <B>+eachturn</B> has finished executing, the processing of the player's command is complete.

<P>To demonstrate, we will make Rick take a sip from his drink every five turns, regardless of what the player does. As this would happen regardless of whether the player is in the room or not, we will put the code to handle this in the global <b>eachturn</b> function:

<pre>
constant turns_since_last_sip      5

{+eachturn
set rick(turns_since_last_sip) + 1
if rick(turns_since_last_sip) = 5
   if here = living_room
      write "Rick takes a sip from his drink.^"
   endif
   set rick(turns_since_last_sip) = 0
endif
}  
</pre>

<P>Each object has sixteen integer properties that can be set and tested. The properties <b>parent</b>, <b>capacity</b> and <b>mass</b> are three of these integer properties that you have already seen. For a complete listing, see the chapter <a href="#definitions0">Definitions in Detail</a>. These sixteen properties are stored in an array, with <b>parent</b>, <b>capacity</b> and <b>mass</b> being the first three integers, stored in the order starting at index 0. This means that the following code will print the number 25 twice:

<pre>
object cube : timber cube
 short	a "timber cube"
 mass		25

{+some_function
...
write cube(mass) ^
write cube(2) ^
...
}
</pre>
 
<p>As the <b>parent</b> property is an integer property, only the index of the parent object is stored. When objects are defined in your game, there are given a sequential integer index starting with 1. As objects and location are both stored internally as objects, this numbering system makes no distinction between the two. This means that if a location representing a forest is the first object or location defined in the game, setting any other objects <b>parent</b> property to 1 will place it in the forest. Although potentially dangerous if you rearrange your game code, this also allows you to test if the player is in a certain section of your game world by testing if the value of <b>here</b> (an internally defined synonym for <b>player(parent)</b>) is within a certain range of values.

<p>The <B>status</B> property of an object is set and tested in the same way as the <B>parent</B> property. The <B>status</B> property, however, has no pre-determined use so we are free to use it as our counter. In order to make our code more readable and self-commenting, before the <b>+eachturn</b> definition, is a constant definition with the name <b>turns_since_last_sip</b> with a value of 5. The <b>status</b> property is the sixth integer property and therefore has an index of 5. By creating this constant we are able to use an object's <b>status</b> property through a more appropriate synonym. The code in the <B>+eachturn</B> function increments this property by one after each successful move made. When it equals 5 a message is displayed (if the player is in the living room) and it is set back to zero. The process will then loop over and over again.

<h2><a class="section" name="tutorial13">Winning and Losing the Game</a></h2>

<P>Our mini game is not much good unless it can be won. For this to happen, the player must have a goal and be awarded points for each obstacle they overcome along the way. The goal for this game is going to be to find the television guide and give it to Rick. To make this game a fiendishly-clever all-time classic we are going to hide the guide under the bed. 

<P>Before we do this, however, we are going to introduce an element of danger by adding some code to cater for switching the television off. We already have an object for the television, so all we need to do now is associate a <B>turn_off</B> function with it. This should look like the following:

<pre>
{turn_off
print:
   As you reach over and switch off the
   television, you get quite a shock to see Rick
   rapidly growing a coat of hair and foaming at
   the mouth. The shock of this is only surpassed 
   by that of him sinking his newly
   acquired fangs into your throat.^^
.
execute "+game_over"
}
</pre>

<P>Okay, so killing the player without any real warning is grossly unfair, but is serves as a demonstration of how to handle the player dying. The last line of the above function is an <b>execute</b> command that calls another function with the name <b>+game_over</b>. This function is included in the file <b>verbs.library</b> and looks like this:

<pre>
{+game_over
write "^"
execute "+score"
loop
   if noun3(parent) = player
      set noun3(parent) = limbo
   endif
endloop
set player(parent) = prologue
write "^"
execute "+look_around"
}
</pre>

<p>This function uses two other <b>execute</b> commands to call two other functions: one to display the player's score and another that displays the contents of the location <b>prologue</b>. 

<P>Before we move on to winning the game, it is worth mentioning that the default response for turning an object on is to say that this cannot be done. In the case of the television, it would be important to add a <B>turn_on</B> function stating that the television is already on.

<P>Now, on to the television guide. To implement this puzzle we are going to need two more objects: the guide itself and the bed to hide it under. Begin by defining an object for the bed somewhere beneath the definition for the bedroom (but before that for the bathroom). Beneath that, add a definition for the television guide. The television guide must have its parent property set to <B>limbo</B> until the player has discovered it. The location <B>limbo</B> is defined in the library and is used exclusively for situations such as this where we need somewhere to temporarily store objects that the player should not have access to. Finally, we must associate a <B>look_under</B> function with the bed that moves the guide to the bedroom and awards the appropriate points. Here is the complete code for all of this:

<pre>
object bed: bed
 short       a "bed"
 mass        scenery

{look_under
if guide(parent) = limbo
   print:
      Hidden under the bed you
      find this week's television guide.^
   .
   set guide(parent) = here
   points 50
   return
endif
write "You don't find anything else.^"
}

object guide: television tv tele guide
 short     a "television guide"
 long      "The television guide is here."
 parent    limbo
 mass      5

{examine : read : look_in
write "It contains a listing of this "
write "week's programmes.^"
}
</pre>

<table class="infowarn"><tr>
<td><img src="warning.png" alt="Warning"></td>
<td>It is important with objects that share names, such as the television and the television guide to be aware of which object has the most names. If only shared names are used, the object with the lowest number of names will be selected. For more information, see the chapter on <a href="resolution.html">Object Resolution</a>.</td>
</tr></table>

<P>Now, when the player looks under the bed, the guide will be moved from its initial location, <B>limbo</B>, to the bedroom. Once this has been done, the player will be able to take it. The <B>points</B> command will increase the player's score by 50%. The <B>if</B> statement in this function ensures that this can only be done once.

<P>We will now associate a <B>give_to_rick</B> function with the guide. This will be the winning move and should look like this:

<pre>
{give_to_rick
print:
   ~Cool!~ Rick exclaims as he
   snatches the guide from your hands.^^
   Satisfied that you have achieved
   at least one thing today, you decide to
   go back to bed.^
.
points 50
execute +game_over
}
</pre>

<P>And so the game is won. The extra 50 points give the player a total of 100, and the function <b>+game_over</b> is executed.

<P>In order to make this tutorial game more complete, other moves the player is likely to try would need to have custom responses added by associating the appropriate functions with the appropriate objects. The more obvious of these include: showing the guide to Rick, telling Rick about the guide and sleeping on the bed. In fact, the more moves you can give custom responses to, the more depth and character the game will have. Also, anything prominent that is mentioned in a location's description, such as the table and sofa in the living room, should also be defined as objects. This enables the player to refer to them, even if they aren't important to solving the game.

<p>If you have an object that logically needs to be in your game as a part of the scenery, but don't want players to waste their time on it as it has no real purpose, you can give it the attribute <b>NOT_IMPORTANT</b>. This attribute causes all the verbs in the library to give a special response that tells the player there is no need to worry about interacting with this object. By giving a minimal implementation of objects this way, you avoid the player receiving a &quot;You can't see any such thing.&quot; message, without the object being perceived as a red herring. For example, this could be used with the sofa in living room using the following minimal code:

<pre>
object sofa : sofa
   short    a "sofa"
   has      NOT_IMPORTANT		
</pre>

<p>No anytime the player attempts to refer to the sofa they will receive the message:

<pre>
The sofa is not important, you don't need to worry about that.
</pre> 

<p>Although not a large or complex game, this tutorial game does demonstrate most of the elements of JACL that you will need to create a more complete piece of interactive fiction. The rest of this guide contains a complete reference description of every feature of the JACL language and interpreters. It is recommended that you at least skim through these chapters in order to gain an awareness of the features at your disposal.



<h1><a class="title" name="debugging0">Testing, Debugging and Releasing</a></h1>

<p>After you have finished writing your game it is important to test it thoroughly before it is released. In a game of any real size, many bugs exist and will only be discovered through extensive beta testing. This chapter covers some tools and techniques for debugging a piece of interactive fiction written using JACL. 
<p>The most immediate indication you will get of a problem with your game is an error message while trying to load the game. Errors with the definition of data (such as objects and variables) that are detected while loading your game will specify the line number the error occurred on. The line numbers specified are those from the <b>.j2</b> file created in the <b>temp</b> directory. If the only files you include in your game (using the <b>#include</b> directive) are at the very end, the line numbers specified in the error messages will be equivalent to the lines in your original <b>.jacl</b> source file. If you include files at various points before the end of your game, the line numbers specified will not be equivalent. In order to investigate the offending line of code in this situation you will need to look directly at the processed <b>.j2</b> file.

<h2><a class="section" name="debugging1">The WALKTHRU Command</a></h2>

<p>The <b>walkthru</b> command allows you to specify the name of a text file that contains a list of moves to process as though they were typed by the player. The text file must contain one command per line and may contain as many commands as you would like. The default name for a walkthru file is <i>GameName</i><b>.walkthru</b>. It is common for this default file to issue all the commands required to get from the beginning of the game to end. This can vary from the most direct path using the minimum commands to the most thorough path visiting every part of the game along the way. Other shorter walkthru files may also be created that take the player from one specific point in the game to another.

<p>Walkthru files have two advantages over saved game files. The first is that as soon as you add or remove an object or variable to a game, saved game files made using a previous version of the game can no longer be loaded. This means that without the use of a walkthru file, play testing the end of the game would involve tediously playing the beginning of the game over and over again as it grows. The second advantage is that a walkthru file shows all the output from every command rather than just instantly teleporting you to a future (or past) point in the game. This makes walkthru files useful for regression testing. By running through a walkthru file after changing some code in your game, you are able to test that everything that previously works still works as expected by quickly scanning the transcript. 

<p>When a walkthru script is running, no <b>[MORE]</b> prompts will be displayed, including those explicitly displayed by a <b>more</b> command. Below is a sample of a walkthru file, being the top ten lines from <b>grail.walkthru</b>:

<pre>
w
n
turn off lights
close blinds
examine screen
s
s
take gps
n
w
</pre>

<p>As you can see, <b>walkthru</b> files are of a simple format that can be created with any text editor.

<h2><a class="section" name="debugging2">Transcripts</a></h2>

<p>The JACL interpreter provides a mechanism for recording a transcript of a game while it is being played. Recording is started by using the <b>script</b> command then entering a filename to save the transcript to.

<p>As well as being interesting records to keep of your playing, transcripts are an enormously useful way of receiving feedback from people who beta test your games. While recording a transcript it is possible to insert a comment by typing an asterisk as the first character at the command prompt then following it with the comment you would like to add. For example, the in-game command:

<pre>
&gt;*It is possible to open the door even when it is locked.
</pre>

will appear in the currently active transcript with only the following response:

<pre>
Comment ignored.
</pre>

<p>You stop a transcript from being recorded by using the command <b>unscript</b>.

<h1><a class="section" name="debugging3">The Debug Library</a></h1>

<p>The library <b>debug.library</b> contains a set of JACL verbs that are useful for testing your game during development. This library should be included using the <b>#debug</b> directive so that it is not included in the release version of your game (see below).

<h2><a class="section" name="debugging3">The INSPECT Command</a></h2>

<p>The <b>inspect</b> command displays the label, attribute and element values of the object passed as a parameter. Two special verbs in <b>debug.library</b> allows an object to be inspected while playing a game, these are <b>inspect</b> and <b>inspectobj</b>. Below is some sample output of the <b>inspect</b> verb from <i>The Unholy Grail</i>:

<pre>
&gt;inspect drawer
label: compartment
has object attributes: CLOSED CLOSABLE CONTAINER 
has user attributes: 
parent: device (112)
capacity: 6
mass: 100
bearing: 0
velocity: 0
next: 0
previous: 0
child: 0
index: 0
status: 0
counter: 0
points: 0
class: 0
x: 0
y: 0
</pre>

<p>The above output is a dump of the current values of all of the object's properties, including attributes. The object chosen by the <b>inspect</b> verb is determined using the standard rules for object resolution based on the names provided. In this case, the single name <b>drawer</b> has uniquely identified an object with the label <b>compartment</b>.

<p>It is also possible to use the command <b>inspectobj</b> to give the same details as above for whichever object an expression resolves to. For example, the follow two commands will show the detail of the player's current location:

<pre>
&gt;inspectobj player(parent)
&gt;inspectobj here
</pre>

<h2><a class="section" name="debugging4">The Verb VALUEOF</a></h2>

<p>The <b>valueof</b> verb is a way of displaying the current integer value of any resolveable container. This includes an object label, an object element and an integer variable or constant. Below is an example of the <b>valueof</b> command being used while playing The Unholy Grail:

<pre>
&gt;valueof report(parent)
report(parent) = 44
</pre>


<h2><a class="section" name="debugging5">The Verb FETCH</a></h2>

<p>Where the verb <b>inspect</b> is a way of accessing the JACL command <b>inspect</b> during game play, <b>fetch</b> is simply a convenience verb to move an object to the current location and remove the attribute <b>OUT_OF_REACH</b> from that object should it have it. The verb is handy when you need to test a puzzle that involves the use or one or move objects that are time consuming to obtain manually. 

<p>For thorough testing it is preferable to use the <b>walkthru</b> verb to test all the steps normally taken to obtain the object or objects, but <b>fetch</b> can still be of use when testing small parts of your game in isolation.

<h1><a class="section" name="debugging8">Releasing Your Game</a></h1>

<p>Once you have completed your game and all known bugs are fixed you will want to release it to the public to be played. Although it is possible to simply distribute the <b>.jacl</b> file you have been working on (presuming only standard JACL libraries are used), it is often preferable to distribute the <b>.j2</b> file. This file is created in the <b>temp</b> subdirectory when the game is run. This file can be thought of a statically-linked version of your game, with all <b>#included</b> files appended to the game file. In addition to appending all the required library files, unnecessary whitespace is removed from the beginning of each line to reduce file size and improve run-time performance.

<p>Although a <b>.j2</b> file is created each time your game is run, it is possible to use the <b>-release</b> argument when running jacl to produce a file more suitable for distribution. The argument will cause the <b>.j2</b> to be encrypted (mildly), and to only contain files included with the <b>#include</b> directive, not the <b>#debug</b> directive.

<p>If you wish to create a <b>.j2</b> file that does not include the <b>#debug</b> files, but is not encrypted, you can supply the arguments <b>-release -noencrypt</b>.



<h1><a class="title" name="screendisplay0">Screen Display</a></h1>

<p>Interactive fiction is primarily a text-based medium and this chapter discusses all the features of JACL that relate to the output of text. Depending on the Glk library used, JACL interpreters may also provide the ability to add graphics and sound to your games. The use of these features is covered in the following chapter, <a href="multimedia.html">Glk and Multimedia</a>.

<h2><a class="section" name="screendisplay1">The WRITE Command</a></h2>

<P>The <B>write</B> command is the most flexible method of outputting text. It takes one or more parameters, each separated by a whitespace, and prints the result to the screen. A parameter can either be plain text, a string or integer variable, a string or integer constant or an object macro.

<P>For example, the following command:

<pre>
write Hello, world!
</pre>

<P>contains two separate parameters, the string <B>Hello</B> and the string <B>world!</B> (the comma after <b>hello</b> is considered to be white space.) When executed it will produce the following output:

<pre>
Helloworld!
</pre>

<P>This is obviously not the desired result. The correct way to print this familiar greeting is:

<pre>
write "Hello, world!"
</pre>

<P>The reason for this demonstration of how <U>not</U> to print text is that it demonstrates how the <B>write</B> command operates. Each of the parameters supplied to the <b>write</b> command is printed directly after the one before it. In the second example a single parameter containing both a space and comma is printed.

<table class="infowarn">
<tr>
<td><img src="warning.png" alt="Warning"></td>
<td>As with all other JACL commands, any single parameter that contains spaces must be enclosed in quotes. Failing to do this is a common cause of error.</td>
</tr></table>

<!-- NEW PAGE -->
<h3><a class="section" name="screendisplay2">Special Characters</a></h3>

<P>When printing text, the <B>write</B> command recognises the following special characters:

<center>
<table width=80%>
<tr>
<th>Character</th>
<th>Output</th>
</tr><tr>
<td><b>^</b></td>
<td>A caret will be translated into a newline.</td>
</tr><tr>
<td><b>~</b></td>
<td>A tilde will be translated into a double quote.</td>
</tr></table>
</center>

<p>To print the first two special characters (<b>^</b> and <b>~</b>) literally, the words <b>caret</b> and <b>tilde</b> should be used as parameters of a <b>write</b> command. 

<P>Below is an example of the use of the above special characters:

<pre>
write "~Hello,~ said the boy.^"
write "~Hello,~ said the girl in reply.^"
</pre>

<P>Each of these <B>write</B> commands prints a single parameter enclosed in quotes and together will display:

<pre>
"Hello," said the boy.

"Hello," said the girl in reply.
</pre>

<h3><a class="section" name="screendisplay3">Printing the Value of Variables</a></h3>

<P>If the value of a variable is to be printed, as opposed to verbatim text, the name of the variable must be entered as a separate parameter that is not enclosed in double quotes. For example, consider the following line from the <B>+score</B> function of the standard library, a <b>write</b> command with five parameters:

<pre>
write "Your score is " score "% in " total_moves " moves.^"
</pre>

<P>The output of this five parameter command will vary depending on the current value of the two variables being printed. Typed as the very first command of the game it would display:

<pre>
Your score is 0% in 0 moves.
</pre>

<h3><a class="section" name="screendisplay4">Printing the Value of Item Elements</a></h3>

<P>The current value of object and location elements may also be printed using a <B>write</B> command. This is done by enclosing the name of the element in brackets directly after the object or location label. For example:

<pre>
write "The dial is set to " dial(status) "Mhz.^"
</pre>

<P>The elements of each object and location are stored in a sixteen element array (0-15). A number between 0 and 15 can be used between the brackets as an index to the object element rather than it's name. For a mapping of default element names to index numbers, see the chapter <a href="definitions.html">Definitions in Detail</a>. Constants can also be defined as a way of renaming any given element to a name that more clearly indicates its purpose. For example:

<pre>
constant fuel_left	2

{+show_status
set submarine(fuel_left) = 42
write "FUEL: " submarine(fuel_left) ^
}
</pre>

<p>This code defines <b>fuel_left</b> as the constant 2, then sets the second element of the object <b>submarine</b> to equal 42. Finally, it uses a <b>write</b> statement to output the current value of <b>submarine(2)</b> by using the constant <b>fuel_left</b> to improve the readability of the code. This results in the following output:

<pre>
FUEL: 42
</pre>

<h3><a class="section" name="screendisplay5">Printing the Names and Descriptions of Objects</a></h3>

<P>As you can see in the file <B>verbs.library</B>, it is a common need to print the short description of the object or objects that the player referred to in his or her last move. This is done using the integer variables <b>noun1</b> and <b>noun2</b>. When used as parameters of a <B>write</B> command, these variables may be followed by either a <b>{the}</b> or a <b>{list}</b> macro to display the object's short description. Given the following object:

<pre>
object wooden_box : small wooden box
  has          CONTAINER CLOSED CLOSABLE
  short        a "small wooden box"
</pre>

<p>if the player refers to this box as the first object in their command, then the <b>write</b> command:

<pre>
write noun1{list}
</pre>

<P>would display, "a small wooden box", while

<pre>
write noun1{the}
</pre>

<P>would display, "the small wooden box".

<P>If you require the output to be capitalised when using these macros, use <B>{The}</B> or <b>{List}</b> instead. For example, with <B>noun1</B> still set to the box object:

<pre>
write noun1{The} " is no good to eat.^"
</pre>

<P>will display, &quot;The small wooden box is no good to eat.&quot;

<h3><a class="section" name="screendisplay6">Sentences Referring to Varying Objects</a></h3>

<P>There are several other macros that may be used with the <B>write</B> command to assist in constructing sentences that refer to different objects at different times. They are designed to simplify the process of displaying the correct text for objects based on whether they have the attributes <B>PLURAL</B>, <b>ANIMATE</b> or <b>FEMALE</b>. They are:

<center>
<table width=80%>
<tr>
	<th width=40%>Macro</Th>
	<th>Output</Th>
</tr>
<tr>
	<td><i>object_label</i><b>{long}</b></td>
	<td>Prints the objects <b>long</b> description.</td>
</tr>
<tr>
	<td><i>object_label</i><b>{that}</b></td>
	<td>Prints either the word <b>them</b> if the object has the attribute <b>PLURAL</b>, <b>him</b> if the object has the attribute <b>ANIMATE</b>, <b>her</b> if the object has the attributes <b>ANIMATE</B> and <b>FEMALE</b>, or the word <B>that</B> if the object doesn't have any of these attributes.</td>
</tr>
<tr>
	<td><i>object_label</i><b>{it}</b></td>
	<td>Prints either the word <b>they</b> if the object has the attribute <b>PLURAL</b>, <b>he</b> if the object has the attribute <b>ANIMATE</b>, <b>she</b> if the object has the attributes <b>ANIMATE</B> and <b>FEMALE</b>, or the word <B>it</B> if the object doesn't have any of these attributes.</td>
</tr>
<tr>
	<td><i>object_label</i><b>{does}</b></td>
	<td>Prints the word <b>do</b> if the object has the attribute <b>PLURAL</B>, or the word <B>does</B> if the object doesn't have the attribute <B>PLURAL</B>.</td>
</tr>
<tr>
	<td><i>object_label</I><B>{doesnt}</B></TD>
	<td>Prints the word <B>don't</B> if the object has the attribute <B>PLURAL,</B> or the word <B>doesn't</B> if the object doesn't have the attribute <B>PLURAL</B>.</TD>
</tr>
<tr>
	<td><i>object_label</I><B>{is}</B></TD>
	<td>Prints the word <B>are</B> if the object has the attribute <B>PLURAL</B>, or the word <B>is</B> if the object doesn't have the attribute <B>PLURAL</B>.</TD>
</tr>
<tr>
	<td><i>object_label</I><B>{isnt}</B></TD>
	<td>Prints the word <B>aren't</B> if the object has the attribute <B>PLURAL</B>, or the word <B>isn't</B> if the object doesn't have the attribute <B>PLURAL</B>.</TD>
</tr>
<tr>
	<td><i>object_label</I><B>{s}</B></TD>
	<td>Prints the letter <B>s</B> if the object hasn't got the attribute <B>PLURAL</B>, or nothing if the object does have the attribute <B>PLURAL</B>.</TD>
</tr>
<tr>
<td><i>object_label</I><B>{sub}</B></TD>
<td>Prints the word <b>you</b> if the object is the current player, <b>he</b> if the object has the attribute <b>ANIMATE</b>, <b>she</b> if the object has both the <b>ANIMATE</b> and the <b>FEMALE</b> attribute, <b>it</b> if the object has neither the <b>ANIMATE</b> nor the <b>FEMALE</b> attribute or the word <b>they</b> if the object being refered to has the attribute <b>PLURAL</b>.</td>
</tr><tr>
<td><i>object_label</I><B>{obj}</B></TD>
<td>Prints the word <b>yourself</b> if the object is the current player, <b>him</b> if the object has the attribute <b>ANIMATE</b>, <b>her</b> if the object has both the <b>ANIMATE</b> and the <b>FEMALE</b> attribute, <b>it</b> if the object has neither the <b>ANIMATE</b> nor the <b>FEMALE</b> attribute or the word <b>them</b> if the object being refered to has the attribute <b>PLURAL</b>.</td>
</table>
</center>

<h3><a class="section" name="screendisplay7">Custom Macros</a></h3>

<p>It is also possible to define your own custom macros by creating a function with the name <b>+macro_</b> followed by the name of the macro. This is primarily of use when writing a JACL game or library using a language other than English. The object the macro is being applied to will be passed to the function as an argument. The output of the macro is specified by setting the value of the string variable <b>return_value</b>. For example:

<pre>
{some_function
write noun1{The} " " noun1{is} " verrouill" noun1{es} ".^"
}

{+macro_es
if arg[0] has FEMALE
   if arg[0] has PLURAL
      setstring return_value "es"
   else
      setstring return_value "e"
   endif
else
   if arg[0] has PLURAL
      setstring return_value "s"
   else
      setstring return_value ""
   endif
endif
}
</pre>

<p>As you can see, the macro is used using the name <b>{es}</b> while the function is defined using the full name of <b>+macro_es</b>. The text to be returned by the macro is placed in the string variable <b>return_value</b> which is created internally by the interpreter.

<h3><a class="section" name="screendisplay8">Printing the Value of Strings</a></h3>

<P>If the value of a string is to be printed, as opposed to verbatim text, the name of the string variable or string constant must be entered as a separate parameter that is not enclosed in quotes. For example:

<pre>
constant game_title  "Tutorial Game"
constant game_author "I. F. Author" 

{+intro
write "Welcome to " game_title " by " game_author ".^"
}
</pre>

<P>The output of the <b>+intro</b> function will be:

<pre>
Welcome to Tutorial Game by I. F. Author.
</pre>

<h2><a class="section" name="screendisplay9">The PRINT Command</a></h2>

<P>The <B>print</B> command is the primary way to output plain text. Unlike the <b>write</b> command, the values of variables, macros or string constants cannot be displayed. In fact the only thing that can be displayed by a <b>print</b> command is plain literal text. A <b>print</b> command has no parameters. On executing a <b>print</b> command the interpreter will begin printing all the text from the following line onwards until it encounters a line with a period (<b>.</b>) as the first non-whitespace character.  The lines of text will be displayed verbatim with the following considerations:

<ol>
	<li>if a line does not end with a caret (<b>^</b>), an implicit space will be printed after the line and the following line of text will continue straight after it, following the usual word wrapping rules;

	<li>if a line ends with a backslash (<b>\</b>) or a caret (<b>^</b>), no implicit space will be added to the line; 
	
	<li>a vertical bar will be translated into a space to allow formatting such as paragraph indenting to be done.
</ol>

<p style="page-break-before: always">Below is an example of the <b>print</b> command in action (note that the colon after the word <b>print</b> is optional whitespace):

<pre>
{+intro
clear
print:
   This text will be printed to the screen and
   word wrapped in the appropriate places.
   The backslash at the end of this line will prev\
   ent an implicit space being printed as will
   the caret at the end of this line.^
   ||These two vertical bars will allow this line
   to be indented two spaces.^
.
}

</pre>
<h2><a class="section" name="screendisplay10">The LOOK Command</a></h2>

<P>The <b>look</b> command will print the long description of the current location and any visible objects that are in the current location. A <b>look</b> command is executed implicitly by the JACL interpreter whenever a description of the player's current location is required. This is at times such as when then player moves into a location for the first time or restores a saved game.

<table class="infowarn">
<tr>
<td><img src="info.png" alt="Information"></td>
<td>If the player has set the game to verbose mode (<b>DISPLAY_MODE</b> = 1), locations will not be given the attribute <b>VISITED</b>.</td>
</tr></table>

<p>The very first thing the <B>look</B> command will do is remove the attribute <b>VISITED</b> from the current location. It will then execute the global function <B>+before_look</B>. If this function exists, and returns <b>true</b>, nothing more is done. If it does not exist, or returns <b>false</b>, the function <b>+title</b> will be executed. This function is an opportunity to print extra information that is potentially relevant to all locations. For example, the <b>+title</b> function in <b>frame.jacl</b> tests if the player is currently sitting down and displays the text "(sitting)". It is also common to add the following line to the top of <b>+title</b> to give each location description a title:

<pre>
write here{The} ^
</pre>

<p> Next the <B>look</B> function associated with the current location is executed. After this has finished, the interpreter will display the text supplied by the <B>long</B> property for each object that is in the current location and doesn't have a <B>mass</B> of <B>scenery</B>.

<p>If the <b>long</b> property of an object is set to <b>function</b>, that function will be executed. This is useful for descriptions that are either too long to fit in a single line of code or change during the course of the game. If the <b>long</b> property is not set to <b>function</b>, the property text is displayed verbatim. 

<P>The final step in the process is that the global function <B>+after_look </B>is executed.

<P>It is a convention to have a <B>look</B> command at the end of the <B>+intro </B>function so the player can see where they are and what objects are nearby when the game begins.

<h2><a class="section" name="screendisplay11">The MORE Command</a></h2>

<p>The <b>more</b> command will print a message and then wait for the player to press a key before continuing. The message to print is passed as the only parameter of a <b>more</b> command. If no message is provided, the message <b>[MORE]</b> is used as a default. Below is an example of using the <b>more</b> command with a custom message:

<pre>
<b>more</b> &quot;Hit any key to continue&quot;
</pre>



<h1><a class="title" name="multimedia0">Glk and Multimedia</a></h1>

<p>Glk is a portable application programming interface (API) for applications, like JACL, with a predominantly text-based user interface. By communicating with this API, JACL is able to work with a variety of user interfaces implemented by third parties for a variety of platforms. The Glk specification was written by Andrew Plotkin, and many thanks to him for having done so. Of equal importance are the various implementations of the Glk specification. 

<p>So what does all this mean? The Glk specification defines a set of multimedia functionality that the native console version of JACL does not provide. Currently JACL can be compiled using WindowsGlk by David Kinder and Gargoyle by Tor Andersson. Many thanks to both these gentlemen for writing their libraries and assisting in the porting of JACL to use them. The commands detailed below are available for use by a JACL interpreter that is compiled with either WindowsGlk or Gargoyle. In the standard Unix distribution, the JACL interpreter is also compiled with GlkTerm. GlkTerm is a Glk library written by Andrew Plotkin using ncurses. GlkTerm does not support graphics or sound. The multimedia commands detailed in this chapter will be ignored without error by interpreters that do not support multimedia.

<p>If you would like to have your game behave differently is certain Glk features are supported by the interpreter, you can test whether the integer constants <b>graphics_supported</b>, <b>sound_supported</b> and <b>timer_supported</b> are set to <b>true</b> or <b>false</b>.

<p>Graphics, sounds and timers can also be turned off from within your game by setting the integer variables <b>graphics_enabled</b>, <b>sound_enabled</b> and <b>timer_enabled</b> to <b>false</b>.

<p>Some of the text for this chapter has been cheerfully stolen from the Glk specification. The full Glk Specification can be read at <a href="http://www.eblong.com/zarf/glk/">http://www.eblong.com/zarf/glk/</a>.

<h2><a class="section" name="multimedia1">Blorb Files and the bjorb Utility</a></h2>

<p>All sound and image files are made available to a Glk interpreter by placing them in a Blorb file with the same base name as the game. For example, the game <b>grail.jacl</b> will look in the file <b>grail.blorb</b> for any sounds or images required.

<p>Blorb is a second specification written by Andrew Plotkin specification for a common format for storing resources associated with interactive fiction games. There are many tools available for creating Blorb files. A program called <b>bjorb</b> is included in the JACL package that is a slightly modified version of the utility <b>blc</b>. <b>blc</b> is part of the iBlorb suite developed by Ross Raszewski. Many thanks to Ross for both his original development effort and the permission to include this program in the JACL package. Information about iBlorb can be found at <a href="http://www.trenchcoatsoft.com/projects.html">http://www.trenchcoatsoft.com/projects.html</a>. The full Blorb Specification can be read at <a href="http://www.eblong.com/zarf/blorb/">http://www.eblong.com/zarf/blorb/</a>.

<p>The utility <b>bjorb</b> creates a blorb file with the help of a <b>.blc</b> control file. This control file is a plain text file that specifies the sounds and images to include in the blorb file. Each line in a <b>.blc</b> control file describes one chunk of the Blorb file, and has the following format:

<pre>
<i>Use IndexNumber Type File</i>
</pre>

<p><i>Use</i> is the usage of the resource and can either be <b>Pict</b> or <b>Snd</b>.

<p><i>IndexNumber</i> is the number you will use to refer to this resource in your program.

<p><i>Type</i> is the resource type. This can be either JPEG, PNG, FORM (Aiff), OGGV or MOD.

<p><i>File</i> is the name of the file to be included as this resource.

<p>Below is an example <b>.blc</b> file called <b>example.blc</b>:

<pre>
Pict 1 PNG /images/title.png
Snd 3 MOD /music/theme.mod
Snd 4 OGGV /sounds/explosion.ogg
Pict 2 JPEG /images/car.jpg
</pre>

<p>To create a Blorb file from this <b>.blc</b> file, use the <b>bjorb</b> utility in the following manner:

<pre>
bjorb example.blc example.blorb
</pre>

<p>This command will create the Blorb file <b>example.blorb</b> that will be automatically read by the game <b>example.jacl</b>. When the <b>bjorb</b> utility runs, it will output some JACL code that will create a constant for each image or sound. If you find these convenient you can cut and paste this code into your game. <p>For example, when reading this <b>.blc</b> file:

<pre>
Pict 1 PNG images/blackjack.png
Pict 2 PNG images/chip25.png
Pict 3 PNG images/chip50.png
Pict 4 PNG images/chip100.png
Pict 5 PNG images/club.png
Pict 6 PNG images/diamond.png
Pict 7 PNG images/spade.png
Pict 8 PNG images/heart.png
</pre>

<p><b>bjorb</b> will produce the following output:

<pre>
bjorb 1.0 (Apr 30 2008) by Stuart Allen, based on
Blorb Packager Version .5b by L. Ross Raszewski

# CONSTANTS FOR RESOURCES IN BLORB FILE
constant IMAGE_blackjack 1
constant IMAGE_chip25 2
constant IMAGE_chip50 3
constant IMAGE_chip100 4
constant IMAGE_club 5
constant IMAGE_diamond 6
constant IMAGE_spade 7
constant IMAGE_heart 8
</pre>

<p>If you pass only a single command-line argument to <b>bjorb</b>, that argument will be used as the base name for both the <b>.blc</b> control file and the <b>.blorb</b> output file. As an example, the following two commands are equivalent:

<pre>
bjorb example

bjorb example.blc example.blorb
</pre>

<h2><a class="section" name="multimedia2">The IMAGE Command</a></h2>

<p>The <b>image</b> command is used to display one of the images stored in the game's blorb file. The image to display is specified using its index in the blorb file. The index can be supplied either as a literal integer or any JACL container that resolves to an integer. The index of the image can optionally be followed by an alignment. The possible alignments are:

<table>
<tr><th width=15%>Alignment</th><th>Description</th></tr>
<tr><td><b>up</b></td><td>The image appears at the current point in the text, sticking up. That is, the bottom edge of the image is aligned with the baseline of the line of text.</td></tr>
<tr><td><b>down</b></td><td>The image appears at the current point, and the top edge is aligned with the top of the line of text.</td></tr>
<tr><td><b>centre</b></td><td>The image appears at the current point, and it is centered between the top and baseline of the line of text. If the image is taller than the line of text, it will stick up and down equally.</td></tr>
<tr><td><b>left</b></td><td>The image appears in the left margin. Subsequent text will be displayed to the right of the image, and will flow around it -- that is, it will be left-indented for as many lines as it takes to pass the image.</td></tr>
<tr><td><b>right</b></td><td>The image appears in the right margin, and subsequent text will flow around it on the left.</td></tr>
</table>

<p>&nbsp;

<p>The two "margin" alignments require some care. To allow proper positioning, images using <b>left</b> and <b>right</b> must be placed at the beginning of a line. That is, you may only call <b>image</b> (with these two alignments) if you have just printed a newline, or if the screen is entirely empty. If you margin-align an image in a line where text has already be printed, no image will appear at all.

<p>The following code demonstrates the <b>image</b> command:

<pre>
constant IMAGE_house 4

{+display_image
# DISPLAY IMAGE 4 WITH THE TOP OF IMAGE LEVEL WITH TOP OF THE TEXT
image IMAGE_house

# DISPLAY IMAGE 6 WITH THE BOTTOM OF IMAGE LEVEL WITH TOP OF THE TEXT
image 6 up
}
</pre>

<h2><a class="section" name="multimedia3">The SOUND Command</a></h2>

<p>The <b>sound</b> command is used to play one of the sounds stored in the game's blorb file. The sound to play is specified using its index in the blorb file. The index can be supplied either as a literal integer or any JACL container that resolves to an integer. 

<p>The index of the sound can optionally be followed by a channel to play the sound on. There are eight available channels numbered zero to eight (0 -8). If no channel is specified, channel 0 is used as the default.

<p>If a channel is specified, it can be followed by the number of times to repeat the sound. If <b>-1</b> is specified as the number of times to repeat the sound, the sound will keep playing until it is manually stopped using the <b>stop</b> command. If no number of times to repeat the sound is specified it is played once.

<p>The following code demonstrates the <b>sound</b> command:

<pre>
constant SOUND_rain    6
constant SOUND_thunder 7
integer  AUDIO_CHANNEL 2

{+play_sound
# PLAY SOUND 7 ON CHANNEL 0 ONCE ONLY
sound SOUND_thunder

# PLAY SOUND 6 ON CHANNEL 2 ONCE ONLY
sound SOUND_rain AUDIO_CHANNEL

# PLAY SOUND 6 ON CHANNEL 3 FOUR TIMES
sound 6 3 4

# PLAY SOUND 6 ON CHANNEL 3 INDEFINITELY
sound SOUND_rain 3 -1 
}
</pre>

<h2><a class="section" name="multimedia4">The VOLUME Command</a></h2>

<p>The <b>volume</b> command is used to set the volume of a sound channel. The volume is specified as an integer between 0 and 100. A second, optional parameter can be used with the <b>volume</b> command specifying which sound channel to set the volume for. If this parameter is omitted the volume is set for channel 0.

<p>The following code demonstrates the <b>volume</b> command:

<pre>
{+set_volume
# SET CHANNEL 0 TO FULL VOLUME
volume 100

# SET CHANNEL 2 TO HALF VOLUME
volume 50 2
}
</pre>

<h2><a class="section" name="multimedia5">The STOP Command</a></h2>

<p>The <b>stop</b> command simply stops the sound being played on the specified sound channel. The channel to stop is specified as an integer between 0 and 3. If no channel is specified channel 0 is stopped by default.

<p>The following code demonstrates the <b>stop</b> command:

<pre>
{+stop_sound
# STOP THE SOUND PLAYING ON CHANNEL 0
stop

# STOP THE SOUND PLAYING ON CHANNEL 2
stop 2
}
</pre>

<h2><a class="section" name="multimedia6">The TIMER Command</a></h2>

<p>The <b>timer</b> command tells the interpreter to call the function <b>+timer</b> every so many milliseconds, regardless of whether the player types a command or not. The number of milliseconds to wait between each function call is specified as the <b>timer</b> command's only parameter. If you specify a time of <b>0</b> to a <b>timer</b> command, the timer will be turned off. 

<table class="infowarn"><tr>
<td><img src="warning.png" alt="Warning"></td>
<td>It is important to be aware that not all interpreters will support the <b>timer</b> command, so no processing essential to the game should be performed within the <b>+timer</b> function. Periodically playing sound effects that are not essential to the game is an example of valid use of this functionality.</td>
</tr></table>

<p>Below is an example of the <b>timer</b> command being used:

<pre>
{+intro
...
# SET THE TIMER TO EVERY TEN SECONDS
timer 10000
...
}

{+timer
if here has OUTDOORS
   # PLAY THE THUNDER SOUND ON CHANNEL 3 SO
   # IT DOESN'T INTERFERE WITH OTHER SOUNDS
   play SOUND_thunder 3
endif
}
</pre>

<h2><a class="section" name="multimedia7">The STYLE Command</a></h2>

<p>The <b>style</b> command is used to output either ANSI terminal codes or set Glk styles depending on the interpreter being used. The <b>style</b> command accepts a single string containing the name of the style to set. Here is an example of using the <b>style</b> command to output some bold text:

<pre>
style bold
write "This is bold.^"
style normal
</pre>

<p>Below is a table showing styles available in JACL and the Glk styles they map to:

<center>
<table width=80%>
<tr>
	<th>JACL Style</th>
	<th>Glk Style</Th>
</tr>
<tr>
	<td>bold</td>
	<td>style_Emphasized</td>
</tr>
<tr>
	<td>note</td>
	<td>style_Note</td>
</tr>
<tr>
	<td>input</td>
	<td>style_Input</td>
</tr>
<tr>
	<td>header</td>
	<td>style_Header</td>
</tr>
<tr>
	<td>subheader</td>
	<td>style_Subheader</td>
</tr>
<tr>
	<td>reverse</td>
	<td>style_Note</td>
</tr>
<tr>
	<td>pre</td>
	<td>style_Preformatted</td>
</tr>
<tr>
	<td>normal</td>
	<td>style_Normal</td>
</tr>
</table>
</center>

<h2><a class="section" name="multimedia8">The Status Window</a></h2>

<p>The status window at the top of the screen is implemented as a Glk window, and is therefore covered here. It is possible to have no status window at all, use the built-in, default status window or design a custom one yourself. The vertical height of the status window in rows is defined by using the constant <b>status_window</b>. If the constant <b>status_window</b> is set to <b>0</b>, no status window will be created. For example, to create a status window that is three rows tall, define the following constant:

<pre>
constant status_window 3
</pre>

<p>The status window is always created using a fixed-width font and its current dimensions can be read at any time using the values of <b>status_width</b> and <b>status_height</b>. Although <b>status_height</b> will most often be equal to <b>status_window</b> (unless <b>status_window</b> exceeded the available space), <b>status_width</b> will change as the player's resizes the game window.

<p>If a status window is created, the interpreter will attempt to call the global function <b>+update_status_window</b>. If this function exists, it will be executed and must contain code to draw the contents of the status window. If this function doesn't exist, the interpreter will use internal code to generate a standard interactive fiction status line. This consists of a single line with the name of the current location against the left side and the number of moves and current score against the right. 

<p>If the function <b>+update_status_window</b> does exist, the current Glk stream is set to that window before it is called so all <b>write</b> or <b>print</b> commands will output to it. The window is also first cleared of all previous contents and the cursor is positioned in the top left corner.

<p>The location at which to start printing text within the status window is changed using the <b>cursor</b> command. The <b>cursor</b> command is passed two integer parameters, the row and column to move the cursor to. Counting starts in the top left corner at 0, 0. For example, to move the cursor to the far right hand column of the second row, use the command:

<pre>
cursor status_width 1
</pre>

<p>Often when positioning text it is important to know the length of the string you are going to print. This is determined using the <b>length</b> command. The <b>length</b> command requires two parameters: the container to hold the length of the string and the string itself. For example, the following command determines the length of the string constant <b>game_title</b> and stores the result in the variable <b>index</b>:

<pre>
length index game_title
</pre>

<p>Putting this all together, it is possible to display the title of the game centred in a single-line status window using the following code:

<pre>
constant game_title "The Unholy Grail"

constant status_window 1

integer index
integer offset

{+update_status_window
set offset = status_width
length index game_title
set offset - index
set offset / 2
cursor offset 0
write game_title
}
</pre>

<p>Status windows are often displayed using reverse text to make it clearly stand out from the main window. This is achieved using the following command:

<pre>
style reverse
</pre>

<p>This command, however, will only reverse the text output, not the whole window. In order to achieve the effect of an entirely reversed window, blank spaces will need to be printed wherever there isn't any other text. The easiest way to do this is to print entire rows of blank spaces then move the cursor back to print over the top. The <b>padstring</b> command exists to help with this process. The <b>padstring</b> command takes three parameters. The label of the string to fill, the text to fill the string with and an integer specifying the number of times to copy the text into the string. To print a blank line in the status window, the text that will by copied is a single space in quotes (&quot; &quot;) and it will be copied <b>status_width</b> times. The code below is an expanded version of the above function that prints the title of the game centred in an inverse status window:

<pre>
constant game_title "The Lovely Test Game"
string status_text 

integer index
integer offset

constant status_window 1

{+update_status_window
style reverse
padstring status_text " " status_width
write status_text
set offset = status_width
length index game_title
set offset - index
set offset / 2
cursor offset 0
write game_title
}
</pre>

<p>As a final example of a <b>+update_status_window</b> function, below is the JACL code to replicate the internal status line produced if no custom function is provided:

<pre>
string status_text

integer index

constant status_window 1

{+update_status_window 
style reverse
padstring status_text " " status_width
write status_text
cursor 1 0
write here{The}
setstring status_text "Score: " score " Moves: " total_moves
set offset = status_width
length index status_text
set offset - index
set offset - 1
cursor offset 0
write status_text
}
</pre>

<h2><a class="section" name="multimedia9">The UPDATESTATUS Command</a></h2>

<p>The interpreter will call the <b>+update_status_window</b> function after each of the player's moves and when the game window is resized. If you require the status window to be updated at other times such as in a loop or from the <b>+timer</b> function, use the <b>updatestatus</b> command. The <b>updatestatus</b> command takes no parameters. It sets the current output stream to the status window and clears the status window before calling the function <b>+update_status_window</b>. When <b>+update_status_window</b> has finished executing the current output stream is set back to the main window.

<table class="infowarn"><tr>
<td><img src="warning.png" alt="Warning"></td>
<td>It is not possible to call the <b>+update_status_window</b> directly. It will be called by the interpreter automatically after each of the player's moves or when the window is resized. If you do require the window to be updated at other times use the <b>updatestatus</b> command. If you call <b>+update_status_window</b> directly the current output stream will not be set to the correct window.</td>
</tr></table>



<h1><a class="title" name="http0">HTTP and HTML</a></h1>

<p>This chapter covers the aspects of HTML and HTTP that relate to writing games for use with the <b>cgijacl</b> interpreters, including the JACL commands that assist with the output of HTML. If you are not familiar with HTML, it is highly recommended that you read at least a basic tutorial before starting to write your first web-based game.  

<table class="infowarn"><tr>
<td><img src="warning.png"></td>
<td>The <b>jacl</b> interpreter will consider all the HTML-specific commands as errors so it is important to either test the value of constant <b>interpreter</b> (either <b>GLK</b> or <b>CGI</b>) to be sure the game is being played with a web version of JACL or use these commands from a function like <b>+header</b> or <b>+footer</b> that is only executed by the <b>cgijacl</b> interpreter.</td>
</tr></table>

<h2><a class="section" name="http1">Document Structure</a></h2>

<p>A complete HTML page must be returned by your game in response to each of the player's moves. To assist with this, if you do not define your own custom header and footer functions (<b>+header</b> and <b>+footer</b>), the <b>cgijacl</b> interpreter will insert template headers and footers to mimick a standard interactive fiction interface. If a <b>+header</b> function is supplied, it is the very first thing to be executed. The default header looks like this:

<pre> 
&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd"&gt; 
 
&lt;html&gt;&lt;head&gt; 
   &lt;title&gt;game_title&lt;/title&gt; 
   &lt;script language="JavaScript"&gt; 
   &lt;!--
   function userCommand() {
      var xhReq = createXMLHttpRequest();
      if(xhReq == null) { return true; }
      var user_id = document.JACLGameForm.user_id.value;
      var command = document.JACLGameForm.command.value;
      xhReq.open("GET", "?user_id="+user_id+"&amp;command="+command+"&amp;ajax=true", false);
      xhReq.send(null);
      var serverResponse = xhReq.responseText;
      var maintext = document.getElementById("maintext");
      maintext.innerHTML += "&lt;br&gt;&lt;b&gt;&gt;" + command + "&lt;/b&gt;&lt;br&gt;" + serverResponse;
      maintext.scrollTop = maintext.scrollHeight;
      document.JACLGameForm.command.value = "";
      return false; }
    function putFocus(formInst, elementInst) {
      if (document.forms.length &gt; 0) {
          document.forms[formInst].elements[elementInst].focus(); }}
    function createXMLHttpRequest() {
       try { return new XMLHttpRequest(); } catch(e) {}
       try { return new ActiveXObject("Msxml2.XMLHTTP"); } catch (e) {}
       return null; }
    --&gt;
    &lt;/script&gt; 
    &lt;style&gt; &lt;!--
       #footer { 
           position:absolute;
           bottom:0;
           left:0;
           right:0;
           display:block;
           font-family: Verdana, Arial, Sanserif;
           padding-top: 10px;
           padding-bottom: 10px;
           padding-left: 20px;
           background: #dddddd; }
       #main {
           position:absolute;
           margin-left:10;
           margin-right:10;
           left:0;
           top:0px;
           right:0;
           overflow:auto; }
       div.maintext {
            font-family: Verdana, Arial, Sanserif;
            padding-top: 20px;
            padding-bottom: 20px;
            padding-left: 50px;
            padding-right: 50px;
            font-size: 12px;
            overflow: auto; }
    --&gt; &lt;/style&gt; 
    &lt;/head&gt;&lt;body onLoad="putFocus(0, 0);"&gt; 
    &lt;div id="main"&gt; 
    &lt;div id="maintext" class="maintext"&gt; 
</pre>

<p>This header sets the DOCTYPE for the returned HTML document, sets the title of the browser window to the name of the game, provides some Javascript functions to set the input focus to the command prompt and make the Ajax call to the server when a command is entered. It also outputs the CSS styles required and opens a DIV for the game's output to appear in.

<p>The body of the <b>maintext</b> DIV is then produced by your game.

<table class="infowarn"><tr>
<td><img src="warning.png"></td>
<td>If you do provide your own custom <b>+header</b> function, be aware that you can't display values that are modified by the player's command. This is because a full page is generated in order, top to bottom. For example, if the header was to display the title of the current location, when the player moved the header would be displayed and would show the current location. The movement command would then be processed to move the player and then the footer displayed. As you can see, this would result in the header showing the location the player was in <i>before</i> the command took place. The footer does not have this limitation.</td>
</tr></table>

<p>The function <b>+footer</b> is the very last function to be executed after a player's move has been processed. If one is not supplied the following default output is inserted by the interpreter:

<pre>
   &lt;/div&gt; 
   &lt;div id="footer" class="footer"&gt; 
      &lt;p&gt;&lt;b&gt;&gt;&lt;/b&gt; &lt;input type=text style='border-style:none;' size=60 name="command"&gt;&lt;/center&gt; 
      &lt;input type=hidden name="user_id" value="xxxxxx-xxx"&gt; 
   &lt;/div&gt; 
   &lt;/form&gt;
   &lt;/body&gt;
&lt;/html&gt; 
</pre>

<p>There are two significant aspects to this footer. The first is that it contains the input field where the player will type their commands. This input field must have the name <b>command</b> as this is where the interpreter will looks for the player's command when the form is submitted. The second is the hidden input that contains the <b>user_id</b> for the player. 

<table class="infowarn"><tr>
<td><img src="info.png"></td>
<td>An alternative to using the header and footer built into interpreter or coding your own from scratch is to use the <a href="#webinterface0">webinterface.library</a>.</td>
</tr></table>

<h2><a class="section" name="http2">Linebreaks</a></h2>

<p>In order to avoid the need to fill a standard interactive fiction game or the standard library with HTML tags the caret newline character (<b>^</b>) is output by the <b>cgijacl</b> interpreters as <b>&lt;br&gt;</b> followed by a newline. This behaviour can be turned off by setting the JACL variable <b>linebreaks</b> to <b>false</b>. This is usually desireable in section such as the header and footer where code is only executed by the web-based interpreters and can therefore contain any amount of custom HTML you require.

<h2><a class="section" name="http3">The Player's User ID</a></h2>

<p>HTTP is a stateless protocol. This means that each request received by the web server is completely independent of any that came before it. The <b>cgijacl</b> interpreters, however, need to know which player each request has come from, and more specificly, what state the game world was in at the end of their previous move. For this reason, a unique user ID must be sent with each of the player's commands. Failure to do so at any time will result in the game restarting from the beginning and a new user ID being assigned automatically.

<p>To propogate the player's user ID, it must be passed as the HTML parameter <b>user_id</b>. This is done by including it as a hidden field in any forms, or as a URL parameter in any hyperlinks. The token <b>$user_id</b> maybe be used in any <b>write</b> statement to output the automatically generated ID. Below are two examples of its use:

<pre>
write "&lt;a href=~" $url "?user_id=" $user_id 
write "&amp;command=look~&gt;Look&lt;/a&gt;"
    
write "&lt;input type=~hidden~ name=~user_id~ "
write "value=~" $user_id "~&gt;"
</pre>

<p>In the first set of <b>write</b> statements, the token <b>$user_id</b> is added directly to the end of the URL being linked to as the value of the HTTP parameter <b>user_id</b>. Also used is the token <b>$url</b>. This token displays the URL of the game, such as <b>/fastcgi-bin/game.jacl</b>.

<table class="infowarn"><tr>
<td><img src="info.png"></td>
<td>When playing games with the <b>cgijacl</b> interpreter, there is no URL to the game. It is wise, however, to always construct links using the <b>$url</b> token so your game will also work when played with the <b>fcgijacl</b> interpreter.</td>
</tr></table>

<p>The second set of <b>write</b> statements output a hidden form field. This field should be used as part of an HTML form when the player issues their commands by submitting this form.

<p>When using an HTML form, there are two simpler methods of including the player's user ID. The first is the command <b>hidden</b>. This command outputs a line exactly like the <b>input</b> tag above. Below is an example of its use:

<pre>
write "&lt;form&gt;"
write "&lt;input type=~text~ name=~command~&gt;"
hidden ;adds the player's user ID as a hidden form field.
write "&lt;/form&gt;"
</pre>

<p>As you can see, there is nothing difficult about using the <b>hidden</b> command. The second related command is <b>prompt</b>. This command outputs a text input box and the player's user ID. Using <b>prompt</b>, the above code snipet would look like this:

<pre>
write "&lt;form&gt;"
prompt ;adds a text field with the name 'command' and
       ;the player's user ID as a hidden field.
write "&lt;/form&gt;"
</pre>

<p>As you can see, there is even less to using the <b>prompt</b> command.

<table class="infowarn"><tr>
<td><img src="info.png"></td>
<td>If you are running a game using the <b>fcgijacl</b> interpreter under a full webserver, the value of the environment variable <b>REMOTE_USER</b> will be used if present instead of creating a randomly generated user ID. This allows a JACL game to be protected by the webserver and the player to receive the same user ID each time they log in and play.</td>
</tr></table>

<h2><a class="section" name="http4">The Player's Commands</a></h2>

<p>The player's commands are passed to the interpreter via three parameters: <b>verb</b>, <b>noun</b> and <b>command</b>. If the parameters <b>verb</b> and <b>noun</b> are passed, <b>noun</b> is concatenated on the end of <b>verb</b> and the result is processed as a single command. This is useful when writing point-and-click adventures that use a combination of list boxes and submit buttons to form verb-noun commands. If the parameter <b>command</b> is passed, it is processed as a complete command. This is useful for traditional text-based adventures.

<p>It is also possible to use both methods of passing the player's moves. When a request is received, the interpreter will first test the value of <b>verb</b>. If this is empty, the value of <b>command</b> is used as the player's move. If <b>verb</b> does contain a value, the value of <b>noun</b> will be concatenated to it, and the move will be processed, ignoring any value that <b>command</b> may or may not have.

<h2><a class="section" name="http5">Ajax Requests</a></h2>

<p>Using standard Javascript techniques (see the default header or <b>webinterface.library</b> for an example), it is possible to request the JACL interpreter to process a command without refreshing the whole browser window. Once the command has been processed Javascript must be used once again to manually insert any output returned into the appropriate HTML element. When performing these types of requests, there are two special URL parameters to be aware of.

<p>The first is the <b>ajax</b> parameter. If this parameter has the value <b>true</b> the header and footer functions will not be called, leaving the interpreter to return only the output produced directly by the command being processed. 

<p>The second is the <b>function</b> parameter. This parameter allows the game author to specify a function to execute as opposed to the usual process of interpreting a command entered by the player. The value of the <b>function</b> parameter is the name of the function to execute. For security purposes, the acceptable values for this parameter are resistricted to a set number of functions: <b>+timer</b>, <b>+ajax</b> and <b>eachturn</b>. The first two options simply call the function of the same name and return any output. The third will call both the global function <b>+eachturn</b> and the eachturn function that is associated with the current location.

<table class="infowarn"><tr>
<td><img src="info.png"></td>
<td>The <b>+ajax</b> function serves no predetermined purpose, it is simply a function that can be called by the game author to handle any special-case situations that arise.</td>
</tr></table>
<h2><a class="section" name="http6">The BUTTON Command</a></h2>

<p>The <b>button</b> command is used to create a button that will submit an HTML form. It must be followed by a single parameter that indicates what command this button should issue. Behind the scenes this command creates an <b>input</b> tag of the type <b>submit</b> and sets the value of the HTML parameter <b>verb</b> to the specified command. Below is an example of its use:

<pre>
button Look
button "Read Map"
</pre>

<p>The command specified for each button will appear as text on the button. If a command contains any spaces, the command must be enclosed in double quotes as usual.

<p>It is possible to use a second HTML control, such as a list box, in conjunction with a submit button to create verb-noun commands. See the <b>control</b> command below for more information.
 
<h2><a class="section" name="http7">The HYPERLINK Command</a></h2>

<p>The command <b>hyperlink</b> is a simple method of creating a hyperlink that issues a command for the player. It can accept either two or three parameters.
The first is the visible text to be displayed. The second parameter is the command to be issued when the link is clicked. The third, optional, parameter is the name of a CSS class that should be applied to the link. Below are some sample hyperlinks:

<pre>
hyperlink East east 
hyperlink "Take All" "take+all" small
hyperlink "Where am I?" look big
</pre>

<p>With the third hyperlink, the text <b>Where am I?</b> will appear on the screen with all the styles specified the CSS class <b>big</b> applied. When clicked, it will pass the value <b>look</b> to a parameter named <b>command</b>. This, in effect, issues a <b>look</b> command on the player's behalf.

<table class="infowarn"><tr>
<td><img src="warning.png"></td>
<td>When using the <b>hyperlink</b> command, any spaces in the third parameter (the command to be executed), must be replaced with plus signs. This is due to the fact that the command is pasted as part of the URL sent to the web browser, and spaces are not valid in a URL.</td>
</tr></table>

<p>When manually creating special-purpose hyperlinks, the <b>{+name}</b> macro is very useful. For more information, see the chapter on <a href="screendisplay.html">Screen Display</a>.

<h2><a class="section" name="http8">The CONTROL Command</a></h2>

<p>The <b>control</b> command is also used to create a hyperlink. With the <b>control</b> command, however, the first parameter is the name of an image to display instead of some plain text. As the <b>control</b> command displays an image, no third parameter indicating a CSS style is allowed. Below is an example of a <b>control</b> command:

<pre>
control "/images/look.png" look 
</pre>

<p>This command will create a hyperlink that issues the command <b>look</b>. The hyperlink will appear on the screen as the image <b>look.png</b>.

<h2><a class="section" name="http9">The OPTION Command</a></h2>

<p>The <b>option</b> command is used to include an object as a part of a <b>&lt;select&gt;</b> list box. A list box allows the user to select one of the objects from the list then submit the form. The selected object is then sent to the server in the form of a name and value pair. This is most useful when the <b>select</b> tag used to create the list box sets the object selected to the parameter <b>noun</b> as the <b>cgijacl</b> interpreters will automatically look for this parameter when constructing a move to process. By default, the <b>option</b> command will set the value returned to all of the specified object's names. The object for each option is specified by following the <b>option</b> command with an object label or pointer. The visible text for the option is the object's short description. For example:

<pre>
&lt;form&gt;
   write "&lt;select name=~noun~&gt;"
   loop
      if noun3 is *present
         option noun3
      endif
   endloop
   write "&lt;/select&gt;"

   button Look
   button Use
   button Take
   button Drop		
&lt;/form&gt;
</pre>

<p>The above code creates a list box with a parameter name of <b>noun</b> and adds an entry for each object that is in the player's current location. If an object is selected before the form is submitted by clicking one of the four buttons, the parameter <b>noun</b> will have its value set to all the names of the object the player selected and the parameter <b>verb</b> will have its value set to the text on the button that was clicked. These two parameter would then be concatenated (verb + noun) and processed by the interpreter as the player's move.

<p>It is also possible to specify that an <b>option</b> command should pass the object's index as opposed to its names. This is done by following the object pointer or label with the word <b>index</b>. This is only of use if a <b>parameter</b> statement has been defined to accept the parameter name specified in the <b>select</b> tag. Below is an example of this:

<pre>
parameter destination SOME_VARIABLE

&lt;form&gt;
   write "&lt;select name=~destination~&gt;"
   loop
      if noun3 is *present
         option noun3 index
      endif
   endloop
   write "&lt;/select&gt;"
   hidden
   button Jump
&lt;/form&gt;
</pre>

<p>When this form is submitted, the <b>cgijacl</b> interpreter will look for the parameter <b>destination</b>, as it has been defined using a <b>parameter</b> statement. This parameter will contain the internal number of the object that was selected and this number will be copied into the location specified by the <b>parameter</b> statement. In this case, a variable called <b>SOME_VARIABLE</b>. For more information see the section on <a href="#definitions10">parameters</a>.

<h2><a class="section" name="http10">The IMAGE Command</a></h2>

<p>The <b>image</b> command is used to display an image &mdash; no surprise there. It requires three parameters using the following syntax:
	
<pre>
image <i>URL</i> <i>Alignment</i> <i>AlternateText</i>
</pre>

<p>For example:

<pre>
image "/images/view.jpg" left "[View from the balcony]"
</pre>

<p>This command displays the image <b>/images/view.jpg</b> aligned to the left. If the picture is not found, or is displayed in a text-only browser such as Lynx, the text <b>[View from the balcony]</b> will be displayed instead. This is also the text that will be displayed by most graphical browsers when the cursor is held over the image.

<h2><a class="section" name="http11">The Media File</a></h2>

<p>When played with the <b>cgijacl</b> interpreter, each game will require a corresponding <b>.media</b> file in order to serve multi-media content such as images. This file must have the same name as the game, with a <b>.media</b> suffix in place of the <b>.jacl</b> suffix. For example, the game <b>grail.jacl</b> has a matching media file called <b>grail.media</b>. As this game only has one image, its media file only has one line:

<pre>
/grail.jpg image/jpeg images/grail.jpg
</pre>

<p>Each line of a media file has three columns separated by white space. The first column is the URL of the file as specified in the HTML of your game. The second column is the file's MIME type. The third column is the name of file on the local system to send when this file is requested. Files not beginning with a forward slash are relative to the directory containing the gamefile.

<p>If <b>awk</b> is installed on your system, the media file can be automatically generated from the <b>.jacl</b> game file using the <b>build-media-file</b> script in the <b>bin</b> directory of the JACL distribution. This script accepts the name of the game file as its only parameter and sends its output to standard out. It also asumes that all files live in an <b>images</b> directory beneath the directory containing the game file. <b>build-media-file</b> is used with a command like:

<pre>
 build-media-file grail.jacl > grail.media
</pre>

<p>JACL games played using the <b>fcgijacl</b> interpreter and a full webserver do not require a <b>.media</b> file. The path to the image specified in the HTML of your game will be looked for in the document root of your webserver.



<h1><a class="title" name="webinterface0">GUI Web Interface</a></h1>

<p>A set of library files are included with JACL to assist in the creation of a more visually pleasing and flexible web interface for your games. These libraries display an interface that operates in one of three modes. The first is the Ajax mode which is functionally equivalent to the default header and footer with the addition of control over colours and images and hyperlinked exits. The second is the Standard mode which does not use Ajax for the command submission and includes a compass rose in the footer. The third is the GUI mode which displays two list boxes, one for the objects being carried and one for the objects in the current location; a compass rose for moving around; and a set of action buttons that represent some of the common verbs. When this interface is used, a text command is constructed and processed by the interpreter as normal. The player is given the choice of swapping between these three modes.

<p>Below is a screen shot of the web interface running in GUI mode:
<center>&nbsp;<br><img src="webinterface.png" alt="The Down Dragon running with the web interface"><br>&nbsp;<br></center>

<table class="infowarn"><tr>
<td><img src="warning.png"></td>
<td>If you wish your game to be playable using this point-and-click interface you must be careful to design it to be solveable using only the verbs available.</td>
</tr></table>

<h2><a class="section" name="webinterface1">Using the Interface</a></h2>

<p>To use this web interface you first need to include the appropriate library at the bottom of your game file with the line:

<pre>
#include "webinterface.library"
</pre>

<p>Once this library is included, certain string constants must be defined to provide information that is specific to your game. Here are the values from The Down Dragon, as show in the screenshot above:

<pre>
constant title_image "/images/dragon.png"
constant footer_image "none"
constant header_colour "#42596d"
constant linkbar_colour "#3f3527"
constant maintext_colour "#dddddd"
</pre>

<p>The value for <b>title_image</b> specifies which image to display in the top title bar. This image must be 85 pixels high and may be of any width. As browsers can be resized by the player, best results are achieved by having the right-hand edge of the image blend well with the background colour specified in <b>header_colour</b>. Note that this is also the colour used for the footer of the page. If <b>image_title</b> is set to <b>none</b>, the value of <b>game_title</b> is displayed instead.

<p>Like the header it is also possible to choose an image to be displayed in the footer of the page. This image is displayed in the background behind the user interface itself. This image is set to repeat both horizontally and vertically.

<p>The value for <b>main_text</b> configures the background colour of the main window that contains the game's text output.

<p>Colours can be specified in any format acceptable to the HTML specification. For example, it is also valid to supply a plain text colour such as <b>blue</b>. The colours above are specified as hexadecimal RGB values to provided more fine-grained control over the exact shade of the colour.


<h1><a class="title" name="flowcontrol0">Flow Control</a></h1>

<h2><a class="section" name="flowcontrol1">The IF, IFALL and ENDIF Commands</a></h2>

<P>An <b>if</b> command tests whether an expression is true or false for the purpose of selectively executing code. If the expression is true, execution will continue from the next line. If the expression is false, execution will continue from the line after the matching <b>endif</b> or <b>else</b> command. If no <b>endif</b> command is found by the end of the function, the function will terminate normally with an implicit <b>return true</b>. An <b>if</b> command must be of the format:

<pre>
<b>if</b> <i>LeftValue test RightValue</i> [<i>LeftValue Test RightValue</i>]...
</pre>

<P>In an <b>if</b> command, each set of three parameters (two values and a test), is called an expression. Each expression is evaluated to equal either true or false. If more than one expression is supplied, the entire statement is considered be true if any one of the expressions is true &mdash; a logical <b>OR</b>. The <b>ifall</b> command has the same format as an <b>if</b> command except the entire statement is only considered to be true if all of the expressions are true &mdash; a logical <b>AND</b>.

<P>The following table lists the possible tests that can be used with an <b>if</b> or <b>ifall</b> command when the left and right values are both either an integer, an integer constant, an object or the word <b>random</b>. For more information on constants and <b>random</b> see the chapter on <a href="internals.html">Internals</a>.

<table class="infowarn">
<tr><td><img src="info.png" alt="Information"></td>
<td>Each object defined is assigned a unique number when the game is loaded. In a <B>set</B>, <B>if</B> or <b>ifall</b> command, an object's label is substituted for this number. Objects are numbered in the order they appear in the game file starting at one.</td>
</tr></table>

<center>
<table width=80%>
<TR><th>Test</th>
<th>Description</th>
</TR>
<TR><td><B>=</B> or <b>==</b></TD>
<td>This tests if the left value is equal to the right value.</TD>
</TR>
<TR><td><B>&gt;</B></TD>
<td>This tests if the left value is greater than the right value.</TD>
</TR>
<TR><td>
<B>&lt;</B></TD>
<td>This tests if the left value is less than the right value.</TD>
</TR>
<TR><td><B>&gt;=</b> or <b>=&gt;</B></TD>
<td>This tests if the left value is equal to or greater than the right value.</TD>
</TR>
<TR><td><B>&lt;=</b> or <b>=&lt;</B></TD>
<td>This tests if the left value is equal to or less than the right value.</TD>
</TR>
<TR><td><B>!=</b> or <b>&lt;&gt;</B></TD>
<td>This tests if the left value is not equal to the right value.</TD>
</tr></table>
</center>

<P>The following are the possible tests that can be used with an <B>if</B> command when the left and right values are both set to an object:  

<center>
<table width=80%>
<TR>
<th>Test</th>
<th>Description</th>
</TR><TR>
<td><B>grandof</B></TD>
<td>This tests if the left object is the grand parent of the right object.</TD>
</TR><TR>
<td><B>!grandof</B></TD>
<td>This tests if the left object is not the grand parent of the right object.</TD>
</tr></table>
</center>

<P>When an object is placed inside another object, which is then placed inside yet another object, the last object is said to be the grand parent of the first. This is the case no matter how many intermediate objects there are.

<P>The following are the possible tests that can be used with an <B>if</B> command when the left value is a location and the right value is an object:</p>

<center>
<table width=80%>
<TR>
<th>Test</th>
<th>Description</th>
</TR><TR>
<td><B>locationof</B></TD>
<td>This tests if the left value is the location of the right object.</TD>
</TR><TR>
<td><B>!locationof</B></TD>
<td>This tests if the left value is not the location of the right object.</TD>
</tr></table>
</center>

<p>The difference between <b>grandof</b> and <b>locationof</b> is that, for example, if a key is put on a keyring, which is put in a box, which is put into a bag, and the bag is in a room called "beach", '<b>locationof key</b>' would refer to the beach, but '<b>grandof key</b>' would refer to the bag.</p>

<P>The following are the possible tests that can be used with an <B>if</B> command when the left value is an object and the right value is an attribute. For more information see the chapter on <a href="attributes.html">Attributes</a>.

<center>
<table width=80%>
<tr>
<th>Test</th>
<th>Description</th>
</TR><TR>
<td><b>has</b></td>
<td>This tests if the object has the specified attribute set</TD>
</TR><TR>
<td><B>hasnt</B></TD>
<td>This tests if the object hasn't the specified attribute set</TD>
</tr></table>
</center>

<P>The following are the possible tests that can be used with an <B>if</B> command when the left value is an object and the right value is one of the words <B>*here</B>, <B>*held</B>, <B>*present </B>or <B>*anywhere</B>. These words have the same meanings when used in an <b>if</b> statement as in a <B>grammar</B> statement. For more information see the section on <a href="#definitions11">Grammar Statements</a>.

<center>
<table width=80%>
<TR>
<th>Test</th>
<th>Description</th>
</TR><TR>
<td><B>is</B></TD>
<td>This tests if the object is in the specified scope.</TD>
</TR><TR>
<td><B>isnt</B></TD>
<td>This tests if the object isnt in the specified scope.</TD>
</tr></table>
</center>

<P>To help clarify, here are some examples of the various types of <b>if</b> commands:

<pre>
if beach locationof bucket
if sand grandof bucket
if TOTAL_MOVES &gt;= 42
if glove has WORN
if guard isnt *present : id_card has WORN
if noun1 = sword : noun1 = knife
if sword(parent) = field
</pre>

<P>It is possible to nest <B>if</B> statements. Nesting involves placing a second <B>if</B> command before the matching <B>endif</B> command of a first. The end result of this is that the code between the second <B>if</B> command and its matching <B>endif</B> command will only be executed if both statements are true &mdash; a logical <b>AND</b>.

<h2><a class="section" name="flowcontrol2">The IFSTRING Command</a></h2>

<p>An <b>ifstring</b> command is used to compare two strings of text. If the string of text is to contain any spaces, it must be enclosed in double quotes. An <b>ifstring</b> command must use the following format:

<pre>
<b>ifstring text</b> <i>test String</i> [<b>text</b> <i>Test String</i>]...
</pre>

<p>Below is a list of the possible tests:

<center>
<table width=80%>
<tr>
<th width=40%>Test</th>
<th>Description</th>
</tr>
<tr>
<td><b>==</b> or <b>=</b></td>
<td>This tests if the first string equals the second string</TD>
</tr><tr>
<td><b>!=</b> or <b>&lt;&gt;</b></td>
<td>This tests if the first string doesn't equal the second string</td>
</tr><tr>
<td><b>contains</b></td>
<td>This tests if the first string contains the second string</td>
</tr><tr>
<td><b>!contains</b></td>
<td>This tests if the first string doesn't contain the second string</td>
</tr>
<tr>
<td><b>==C</b> or <b>=C</b></td>
<td>This tests if the first string equals the second string including case</TD>
</tr><tr>
<td><b>!=C</b> or <b>&lt;&gt;C</b></td>
<td>This tests if the first string doesn't equal the second string including case</td>
</tr><tr>
<td><b>containsC</b></td>
<td>This tests if the first string contains the second string including case</td>
</tr><tr>
<td><b>!containsC</b></td>
<td>This tests if the first string doesn't contain the second string including case</td>
</tr>
</table>
</center>

<p>Below are some examples of the <b>ifstring</b> command being used.

<pre>
ifstring string_arg[0] contains "help"
ifstring command[0] == "take"
</pre>

<h2><a class="section" name="flowcontrol3">The IFEXECUTE Command</a></h2>

<p>The <b>ifexecute</b> command works in a similar manner to the <b>call</b> command (see the chapter on <a href="functions.html">Functions</a> of more information.) If the function specified after the <b>ifexecute</b> command exists and does not return <b>false</b>, executing will continue from the line after the <b>ifexecute</b> command. If the function being called does not exist or returns <b>false</b> executing will continue from after the matching <b>endif</b> or <b>else</b> command. 

<p>This command is normally only used by library code to test if the game author has provided some specific associated function and to perform some sort of default action if not. For example:

<pre>
ifexecute "here.look"
   # ASSOCIATED FUNCTION PROVIDED, DO NOTHING
else
   # NO ASSOCIATED FUNCTION, PERFORM DEFAULT
   execute "+look"
endif
</pre>

<p>If the <b>ifexecute</b> command is true, in other words, a <b>look</b> function associated with the player's current location exists and does not return <b>false</b>, the block of code below it will be executed. As the associated <b>look</b> function has already performed any required action, this block contains only a comment. If this function did not exist or returned <b>false</b> the function <b>+look</b> would be executed.

<h2><a class="section" name="flowcontrol4">The ELSE Command</a></h2>

<p>The code following an <b>else</b> command is executed only if the matching <b>if</b> command was false. If the matching <b>if</b> command was true, execution will continue from the line after the matching <B>endif</B> command. For example:

<pre>
if mulder has DEAD
   write "Clamminess on your lips.^"
else
   write "He looks quite surprised to say the least.^"
endif
</pre>

<P>Nested <B>if</B> commands may also make use of the <B>else</B> command. This is demonstrated in the following section of code taken from the <B>+take_all</B> function: 

<pre>
loop
   if noun3 childof noun1 
      if noun3(mass) &lt; heavy
         if noun3 hasnt LIQUID
            if noun3(mass) &lt;= player(info)
               if TURN_WORKED = true
                  set TOTAL_MOVES + 1
                  execute "+eachturn"
               endif
               execute "+take_routine"
               set INDEX + 1
            else
               write "You are carrying too much to take "
               write noun3{the} .^
               set INDEX + 1
            endif
         else
            write noun3{The} " run" noun3{s} " through "
            write "your fingers.^"
            set INDEX + 1
         endif
      endif
   endif
endloop
</pre>

<p>In the above code, the block of code after the first <b>else</b> command is executed if the matching <b>if</b> command above it:

<pre>
if noun3(mass) &lt;= player(info)
</pre>

<p>is false. This line of code will not get executed, however, if the line:

<pre>
if noun3 hasnt LIQUID
</pre>

<p>is false as execution will have already jumped to after the second <b>else</b> command.

<h2><a class="section" name="flowcontrol5">The LOOP and ENDLOOP Commands</a></h2>

<p>The <B>loop</B> command is used to iterate through all the objects (and locations) defined in the game. The <b>loop</b> command takes a single argument being the integer variable to use as a pointer to the current object during iteration. If a <b>loop</b> command is executed with no parameters, <B>noun3</B> is used as the default variable. When the <b>loop</b> command is executed, iteration starts with the variable being set to 1 (the first object or location in the game file). When the matching <B>endloop</B> command is executed the variable is incremented to point to the next object or location and execution continues from the first line after the original <B>loop</B> command. The loop will end when the <b>endloop</b> command is executed with the iteration variable already pointing to the last object or location. When the loop ends, execution continues from the first line after the <b>endloop</b> command. For example, the following code will output the short description of each object and location as a list:

<pre>
{+print_objects
loop 
   write noun3{List} ^
endloop
}
</pre>

<p>As another example, this function will output all the children of the object passed as an argument to it, using the variable <b>POINTER</b> as the iteration variable:

<pre>
integer POINTER

{+print_children
write "Children of " arg[0]{the} ":^"
loop POINTER
  if POINTER(parent) = arg[0]
     write "  " POINTER{the} ^
  endif
endloop
}
</pre>

<p>It is not legal to nest loops unless the inner loop is within a function that is called from within the outer loop. To return out of a loop early you can either return from the currently executing function or set the iteration variable to point to the last object or location manually. For example, to return out of a loop after the fifth object, use the constant <b>objects</b> like this:

<pre>
loop
 write noun3{The} ^
 if noun3 = 5
    # SET THE CONTAINER noun3 TO POINT TO THE
    # LAST OBJECT OR LOCATION SO THAT THE
    # LOOP WILL STOP ITERATING
    set noun3 = objects
 endif
endloop
</pre>

<p>The index of the last object or location (which is also the number of object and locations in the game) is stored in the constant <b>objects</b>.

<h2><a class="section" name="flowcontrol6">The SELECT and ENDSELECT Commands</a></h2>

<p>The <b>select</b> command is similar to the <b>loop</b> command except that it only iterates over a subset of game's objects. This subset is defined by passing a parameter to the <b>select</b> command. This parameter can be one of the following three things:

<ol>
	<li>an object that all the selected objects must be a direct child of
	<li>an attribute that all the selected objects must have, or
	<li>a scope that all the selected objects must be in
</ol>

<p>It is possible to prefix any of the above three criterion with a shriek (<b>!</b>) to indicate that the objects to be selected should <i>not</i> meet the specified criterion. 

<p>Although the <b>loop</b> command can be used to produce any list of objects that the <b>select</b> command can, the <b>select</b> command is significantly faster as the bulk of the filtering is done by compiled code. Even if the selected objects are filtered with further <b>if</b> statements as in a regular loop, the number of objects returned by the <b>select</b> command is usually a significantly smaller number than the total number of objects in the game, so the remaining processing is relatively quick. Below is an example of the loop above using the <b>select</b> command:

<pre>
integer POINTER

{+print_children
write "Children of " arg[0]{the} ":^"
select arg[0] POINTER
  write "  " POINTER{the} ^
endselect
}
</pre>

<p>If the desired set of objects cannot be expressed with a single criterion, further <b>if</b> statements are placed within the loop such as this code from <b>verbs.library</b>:

<pre>
{+contains_liquid?
# CHECK IF THE SPECIFIED OBJECT CONTAINS ANY LIQUIDS
select LIQUID CHILD
   if CHILD(parent) = arg[0]
      return true
   endif
endselect
return false
}
</pre>

<p>Like the <b>loop</b> command, if a container is not specified (<b>CHILD</b> in the example above), <b>noun3</b> is used by default.

<table class="infowarn"><tr>
<td><img src="warning.png" alt="Warning"></td>
<td>
Becareful not to use the default iteration container <b>noun3</b> more than once when using nested <b>select</b> loops. As it is a global variable the loops will intefere with each other if it is shared. 
<td>
</td></tr></table>

The following scopes can be used with the <b>select</b> command:

<center>
<table width=60%>
<tr><th>Scope</th>
<th>Description</th>
</tr><tr>
<td><b>*held</b></td><td>All objects held by the player.</td>
</tr><tr>
<td><b>*here</b></td><td>All objects in the current location.</td>
</tr><tr>
<td><b>*present</b></td><td>All objects either in the current location or currently held.</td>
</tr><tr>
<td><b>*anywhere</b></td><td>All objects in the game (use <b>loop</b> command instead).</td>
</tr></table></center>

<table class="infowarn">
<tr><td><img src="info.png" alt="Information"></td>
<td>As only a single parameter can be used with a <b>select</b> command it is more efficient to use the criterion that selects the smallest set of the object when <b>if</b> statements are required to filter the list further. For example, if you wanted a list of all the objects that are being carried by the player that don't have a <b>mass</b> of <b>scenery</b>, the it would be more efficient to use the <b>select</b> command to find the objects that are children of the player and then <b>if</b> statements to check their mass. This is because there will generally be fewer objects in the game that are currently being carried by the player than objects with a <b>mass</b> that isn't set to <b>scenery</b>. If the <b>select</b> command has been used to find all the objects that aren't scenery, the <b>if</b> statement to check if each object is also carried by the player would need to be executed many more times.
</td></tr></table>
<h2><a class="section" name="flowcontrol7">The REPEAT and UNTIL Commands</a></h2>

<P>A <B>repeat</B>... <B>until</B> loop allows you to repeat a section of code until a specified condition is true. The expression or expressions to be tested should follow the <B>until</B> statement, using the same syntax as an <B>if </B>statement. 

<P>The following is an example of a <B>repeat</B>... <B>until</B> loop:

<pre>
set INDEX = 10
repeat
  write "DON'T PANIC! "
  set INDEX - 1
until INDEX = 0
</pre>

<table class="infowarn"><tr>
<td><img src="warning.png" alt="Warning"></td>
<td>
<B>loop</B>...<B>endloop</B> loops and <B>repeat</B>...<B>until</B> loops cannot be nested within a single function. It is legal, however, to place a second loop within a function that is called from within the first loop. For example:

<pre>
{+print_objects
set INDEX = 10
loop noun3
  write noun3{the} ^
  execute "+print_children"
endloop
}

{+print_children
loop noun4
  if noun3 grandof noun4
     write "   " noun4{the} ^
  endif
endloop
}
</pre>

<p>Note that it is legal, however, to nest a <b>repeat</b> loop inside an object <b>loop</b> or vice versa.

</td>
</tr></table>

<h2><a class="section" name="flowcontrol8">The WHILE and ENDWHILE Commands</a></h2>

<p>As a <b>repeat</b> loop will always happen at least once, if there is any chance that a loop should happen zero times, a <b>while</b> loop must be used. A <b>while</b> loop performs its test first, then executes the code following the expression if it evaluates to <b>true</b>. On reaching an <b>endwhile</b> command it will return to the matching <b>while</b> command and re-evaluate the expression. When the expression eventually evaluates to <b>false</b>, execution will continue from the line after the <b>endwhile</b> command. For example, the following function will output the value of the passed arguments:

<pre>
{+arg_values
set INDEX = 0
while INDEX != @arg
  write "Argument" INDEX " = " arg[INDEX] ".^"
  set INDEX + 1
endwhile
}
</pre>

<h2><a class="section" name="flowcontrol9">The RETURN Command</a></h2>

<P><b>return</B> or <B>return true</B><br>
The command <B>return</B> will stop execution of the current function and return to the next line after the corresponding <B>execute</B> command in the calling function. If the function containing the <b>return</b> command  was called internally by the JACL interpreter, processing will continue, eventually returning to the command prompt for the player's next move.

<p><b>return false</b><br> 
The command <B>return false</B> will stop execution of the current function just like a <b>return</b> command. When it returns, the JACL interpreter will behave as though the function it returned from did not exist, and was therefore not executed at all. This will, in the case of calls originating from <B>grammar</B> statements, cause the default action to occur.

<P>The following is a demonstration of the use of <B>return false</B>:

<pre>
object bond: james bond

{ask_about_bomb
if bomb(parent) = limbo
   return false ;The function +ask_about will now be
               ; executed as though this function did
               ; not exist.
endif
write "~I'm glad you asked...~^"
}
</pre>

<p>This is a common technique in JACL games. Once the player has typed a command that refers to an object, the interpreter will attempt to execute the appropriate function that is associated with that object. For example, if the player was to type <b>ask bond about the bomb</b>, the interpreter would attempt to execute the function <b>ask_about_bomb</b> that is associated with the object <b>bond</b> (the function above). If this function does not exist, the function <b>+ask_about</b> will be called instead. When a <b>return false</b> command executed, the interpreter will behave as though the local function containing the <b>return false</b> does not exist. In essence, this allows a function to override the default result of a verb under some conditions and accept it under others.



<h1><a class="title" name="set0">Changing Data</a></h1>

<p>It is often desireable to change the value of data that is defined when the game is first loaded. This is achieved using the <b>set</b> command for integers, objects and locations (see Typecasting below), and the <b>setstring</b> command for text.

<h2><a class="section" name="set1">The SET Command</a></h2>

<P>Any <B>set</B> command must be of the following format:

<pre>
<B>set</B> <I>container operator value</I> [ <i>operator value</i>...]
</pre>

<P>The <B>set</B> command enables you to modify the current value of the specified container. A container is either an object element (see the chapter <a href="definitions.html">Definitions in Detail</a> for more information), a variable or an item pointer such as <B>noun1</B> or <B>here</B>. The <i>value</i> can be an integer, integer constant or any other container whose value you wish to copy.

<P>The following is a list of operators that can be used with the <B>set</B> command:

<center>
<table width=80%>
<TR>
<th>Operator</th>
<th>Description</th>
</TR>
<TR><td><B>=</B></TD>
<td>
Set the value of the specified container to the specified value.</TD>
</TR>
<TR><td><B>+</B></TD>
<td>Add the specified value to the current value of the specified container.</TD>
</TR>
<TR><td>
<B>-</B></TD>
<td>Subtract the specified value from the current value of the specified container.</TD>
</TR>
<TR><td>
<B>/</B></TD>
<td>Divide the current value of the specified container by the specified value.</TD>
</TR>
<TR><td><B>*</B></TD>
<td>Multiply the current value of the specified container by the specified value.</TD>
</TR>
<TR><td><B>%</B></TD>
<td>The modulo operator calculates the remainder value of the specified container when divided by the specified value.</TD>
</TR>
</TABLE>
</center>

The following example demonstrates how to add 7 and 8 then divide the result by 5:

<pre>
integer TEMP

{+maths
set TEMP = 7 + 8 / 5
}
</pre>

<p>This line of code can be read as a container to apply the operations to followed by groups of two parameters: an operator and a value. In this case the three operations are:

<ol>
	<li>make TEMP equal to 7
	<li>add 8 to TEMP
	<li>divided TEMP by 5
</ol>

<table class="infowarn">
<TR><td>
<img src="warning.png" alt="Warning"></TD>
<td>Although all JACL commands require whitespace between each parameter, it is especially easy to forget the space between the container and the operator or the operator and the value. It is, of course, valid to have a command such as:

<pre>
set BANK_BALANCE = -42
</pre>
</td>
</tr></table>

<table class="infowarn">
<TR><td>
<img src="info.png" alt="Information"></TD>
<td><p>The <b>set</b> command also has the ability to use the current value of a string as the name of the container or value being referred to. For example, if an integer variable called <b>counter</b> was defined, its value could be set to 1 using the following code: 

<pre>
integer counter 0

{+modify
setstring indirection "counter"
set indirection = 1 
}
</pre>
<p>This technique can be particularly useful when the need arises to pass a reference to an array as a function argument.
</td>
</tr></table>

<h2><a class="section" name="set2">Type Casting</a></h2>

<P>The JACL language allows the definition of complex types such as objects and locations at load time, but once the game is running, the only types that can be modified are integers and strings. When objects and locations are created they are assigned an integer value. The first object or location defined is given the number one, the remainder are numbered sequentially in the order they appear in the source file. For the purposes of numbering there is no distinction between objects and locations. Because of this, it is possible to use an integer variable wherever an object label is expected. For example:

<pre>
integer VARIABLE

{+code
set VARIABLE = small_frog
set noun4 = VARIABLE
set noun4 + 1 ; NOTE: noun4 will now equal the item defined
              ; directly after small_frog in the game file.
set lantern(status) = noun1(parent)
set max_rand = objects
set sword(parent) = random
}
</pre>

<p>This code sets an integer variable to the index of the object <b>small_frog</b>. It then sets the internal object pointer (another integer variable) <b>noun4</b> to that value. This pointer is then incremented to point to the object or location that is definied directly after the <b>small_frog</b>. After that, the current parent of the object pointed to by <b>noun1</b> is stored in the <b>status</b> element of the object <b>lantern</b>. Finally, <b>max_rand</b> is set to the constant <b>objects</b> (the number of objects and locations in the game), and the parent of the object <b>sword</b> is randomly set to one of the object or locations from in the game.

<p>As you can see, all these variables, object elements, object labels, object pointers and constants simply resolve into integers and can be used interchangeably.

<table class="infowarn">
<tr>
<td><img src="warning.png" alt="Warning"></td>
<td>The only real potential danger in the above examples it that of setting one of the object pointers to a value less than one, or greater than the internal number of the last object. The index of the last object or location (which is also the number of object and locations in the game) is stored in the constant <b>objects</b>.</td>
</tr></table>

<h2><a class="section" name="set3">The SETSTRING and ADDSTRING Commands</a></h2>

<p>The <b>setstring</b> command is in many ways similar to the <b>write</b> command. Where a <b>write</b> command can take a list of parameters and will output the result to the screen, the <b>setstring</b> command can take an identical list of parameters and store the result in a <b>string</b>. The first parameter of a <b>setstring</b> command is a <b>string</b> to store the resulting output in. All other parameters constitute the text to be stored. Any previous contents in a string are overwritten by a <b>setstring</b> command. Below is an example of the <b>setstring</b> command in action:

<pre>
string buffer "empty"

{+some_function
setstring buffer "You are currently in " here{the} " on turn " total_moves ".^"
}
</pre>

<p>The <b>addstring</b> command works in a similar way except it does not erase the current contents of the string being written to. 

<h2><a class="section" name="set4">The PADSTRING Command</a></h2>

<p>The <b>padstring</b> command takes three parameters. The label of the string to fill, the text to fill the string with and an integer specifying the number of times to copy the text into the string. This command primarily exists to assist with presentation within the status window. For example, to print a blank line in the status window, the text that will by copied is a single space in quotes (&quot; &quot;) and it will be copied <b>status_width</b> times. The code below demonstrates creating a string called <b>status_text</b> that contains enough spaces to fill a line in the status window: 

<pre>
string status_text

{+update_status_window
padstring status_text " " status_width
}
</pre>



<h1><a class="title" name="movement0">Movement</a></h1>

<h2><a class="section" name="movement1">The MOVE Command</a></h2>

<P>The <b>move</b> command is used to transport an object within your game world and uses the format:

<pre>
<b>move</b> <i>object</i> <b>to</b> <i>destination</i>
</pre>

<P>The <I>object</I> can be any object label, object pointer or the integer index of an object, while the <I>destination</I> can be any item label, item pointer or the integer index of an item. In essence, the <b>move</b> command will set the parent element of the <I>object</I> to be equal to the <I>destination</I>. In addition to this, it performs several functions relating to the <b>mass</b> of the object that is being moved. For example, the command:

<pre>
move note to box
</pre>

<P>will, in addition to moving the note to be a child of the box, automatically increase the <b>capacity</b> property of the object (if any) that the note was in before the <b>move</b> command, and decrease the <b>capacity</b> property of the box. This reflects the decreased burden on note's previous parent and an increase in the box's contents in accordance with the note's <b>mass</b>. The following code is equivalent to the above <b>move</b> command:

<pre>
set noun4 = note(parent)
set note(parent) = box
set noun4(capacity) + note(mass)
set box(capacity) - note(mass)
</pre>

<P>As you can see, the <b>move</b> command is by far the easier option.

<table class="infowarn"><tr>
<td valign="top"><img src="warning.png" alt="Warning"></td>
<td>If the <b>capacity</b> property of the <I>destination</I> object ends up a negative number, the <b>move</b> command will still successfully complete. It is therefore wise to test for this before issuing a <b>move</b> command. Below is an example of this from the library function <b>+insert_in</b>:

<pre>
if noun2(capacity) &lt; noun1(mass)
   write &quot;There is not enough room in " noun2{the} 
   write " for " noun1{the} .^
   set TIME = false
   return
endif
</pre>

</td>
</tr></table>

<h2><a class="section" name="movement2">The TRAVEL Command</a></h2>

<P>A <b>travel</b> command must be of the format:

<pre>
<b>travel</b> <i>direction</i>
</pre>

<p>The <b>travel</b> command is used to move the player from one location to another. It simulates the player moving in the specified direction under their own steam. The player can also be moved to a different location by directly setting their <b>parent</b> to equal the new location. This, however, does not in perform any tests as to whether this movement is physically possible.
The <b>travel</b> command is normally only ever used by the direction verbs in the library. One of the directions <b>north</b>, <b>south</b>, <b>east</b>, <b>west</b>, <b>up</b>, <b>down</b>, <b>in</b>, <b>out</b>, <b>northeast</b>, <b>northwest</b>, <b>southeast</b> or <b>southwest</b> must be specified as its single parameter.

<P>Before the move actually occurs, two functions are executed. If either of these functions exists, and does not return <b>false</b>, the move will be prevented from occurring. The first of these functions is the <b>movement</b> function associated with the location the player is attempting to move out of. The second, executed if this first function does not exist or issues a <b>return false</b> command, is the global function <b>+movement</b>. Before either of these functions are called the integer variable <b>compass</b> is set to the direction the player is travelling in and the integer variable <b>destination</b> is set to the location the player is travelling into.

<p>For example, if the player was in a location called <b>hut</b> and typed the command <b>go north</b>, the integer variable <b>destination</b> would be set to the location they are attempting to move into, say <b>clearing</b>, and the integer variable <b>compass</b> would be set to the direction he or she is attempting to move in, in this case <b>north</b>. Both of these variables would be set before the function <b>movement</b> that is associated with the location <b>hut</b> is called.

<P>Two common uses of the movement function associated with a particular location are to replace the standard, &quot;You can't go that way,&quot; message or to add some text describing the journey from one location to another. For example:

<pre>
location hut : hut
   short       the &quot;hut&quot;
   north       clearing
  
{movement
if COMPASS != north
   print:
      The only exit from here is the front door
      to the north.^"
   .
   return true
endif
print:
   You step out into the sun light, taking a
   moment for your eyes to adjust.^
.
return false
}
</pre>

<p>Firstly, this function checks if the player is attempting to go in a direction other than this location's only exit. If this is the case, an appropriate message is displayed and a <b>return true</b> command is executed. It is this <b>return</b> command that prevents the normal message from being displayed. If the player is attempting to travel north, a short description of the journey is displayed and a <b>return false</b> is executed. It is this <b>return false</b> command that tells the interpreter that the move should continue as normal.

<p>Another common use of an associated <b>movement</b> function is to simply remind the player of the available exits when they attempt to travel in an invalid direction. For example:

<pre>
{movement
if destination = nowhere
   print:
      The only exit from here is to the south.^
   .
   return true
endif
return false
}
</pre>

<p>This function would display the message &quot;The only exit from here is to the south.&quot; whenever the player attempt to travel in a direction that is currently set to <b>nowhere</b>.

<h2><a class="section" name="movement3">Moving Non-player Characters</a></h2>

<P>The file <B>utils.library</B> contains several functions to help simulate the natural movement of objects, such as a non-player character walking around. In addition to moving the object, these functions will display the appropriate message required to announce the movement to the player.

<p>The function called from your game to initiate the movement is <B>+push_object</B>. This function is passed two arguments: the object to be moved and the direction to move the object in. The direction passed is one of the following integer constants:

<P><center>
<table cellpadding=3 width=50%><tr>
<th>Constant name</th>
<th>Integer value</th>
</tr><tr>
<td>north</TD>
<td>0</TD>
</tr><tr>
<td>south</TD>
<td>1</TD>
</tr><tr>
<td>east</TD>
<td>2</TD>
</tr><tr>
<td>west</TD>
<td>3</TD>
</tr><tr>
<td>northeast</TD>
<td>4</TD>
</tr><tr>
<td>northwest</TD>
<td>5</TD>
</tr><tr>
<td>southeast</TD>
<td>6</TD>
</tr><tr>
<td>southwest</TD>
<td>7</td>
</tr><tr>
<td>up</TD>
<td>8</TD>
</tr><tr>
<td>down</TD>
<td>9</TD>
</tr><tr>
<td>in</TD>
<td>10</TD>
</tr><tr>
<td>out</TD>
<td>11</TD>
</tr></table>
</center>

<P>Below is an example of the procedure for making an object move from one location to another:

<pre>
execute +push_object&lt;security_guard&lt;north
</pre>

<p>A message will be displayed to the player informing him or her of the object's movement if the player is in either the location the object is moving out of or the location the object is moving in to. If the location the player is in has the attribute <b>DARKNESS</b>, the message &quot;You hear footsteps nearby.&quot; is displayed.

<h2><a class="section" name="movement4">The DIR_TO and NPC_TO Commands</a></h2>

<p>The <b>dir_to</b> and <b>npc_to</b> commands calculate the first direction to move in when travelling from one location to another. The <b>dir_to</b> command will calculate a route that only passes through locations that have the attribute <b>KNOWN</b>, while the <b>npc_to</b> command will use all locations.

<p>Both commands use the following syntax:

<pre>
dir_to <i>&lt;Container&gt; &lt;From Location&gt; &lt;To Location&gt;</i>
</pre>

<p>When this command runs, it will store the value of the first direction to move in inside the specified container. This container can be an integer variable or an object element. The value stored is one of the direction constants from the table above.

<p>For example, given the map below, the command:
<pre>
dir_to INDEX clearing ledge
</pre>

<p>would put the value <b>north</b> (0), into the variable INDEX as this is the first direction that must be travelled in from the location <b>clearing</b> to get to the location <b>ledge</b>.

<p>
<center>
    <img align="center" src="map.png" alt="A map showing the connection between the locations clearing and ledge.">
</center>


<p>If the <b>dir_to</b> command is unable to calculate a route between the two locations, -1 will be placed into the container.

<table class="infowarn"><tr>
<td valign="top"><img src="warning.png" alt="Warning"></td>
<td>The <b>dir_to</b> command is not able to determine if an exit is only temporarily blocked. If an exit is set to <b>nowhere</b> due to a door being closed between the two locations specified, -1 will be returned. If you wish to avoid this limitation you will need to temporarily open all doors that can be opened by the player, calculate the route and then return them to their initial state.
</td></tr></table>



<h1><a class="title" name="special0">Special-Purpose Commands</a></h1>

<h2><a class="section" name="special1">The POINTS Command</a></h2> 

<P>The <b>points</b> command is used to award points to the player and must be followed by a single integer indicating the number of points to be awarded. The awarded points will be added to the integer variable <b>score</b>. Below are two examples of the <b>points</b> command being used:

<pre>
points 10
points gold(points)
</pre>

<P>When the <b>points</b> command is used the following message will be displayed to the player:

<pre>
[YOUR SCORE JUST WENT UP BY <i>n</i> POINTS]
</pre>

<h2><a class="section" name="special2">The PROXY Command</a></h2> 

<P>The <b>proxy</b> command is used to issue an in-game move as though it was typed by the player and must be of the following syntax:

<pre>
<b>proxy</b> <I>Move</I>
</pre>

<p>The specified <I>Move</I> may consist of multiple parameters, built up from plain text, variables, constants or macros. When the move is issued by the <b>proxy</b> command, all the normal testing will take place and all usual messages will be displayed. The most common use for the <b>proxy</b> command is to translate one command into another similar command. For example, sometimes two different commands can be mapped to the same function:

<pre>
grammar put *held in *here     &gt;insert
grammar insert *held in *here  &gt;insert
</pre>

<P>With the above two <b>grammar</b> statements only the verb is different so mapping them to the same function is possible. In some situations, however, this is not possible as the nouns appear in a different order. Below is an example of how the <b>proxy</b> command can save the day:

<pre>
grammar look at *here through *held &gt;look_at_through

{+look_at_through

;main function code tied to this syntax

}

grammar look through *held at *here &gt;look_through_at

{+look_through_at
proxy "look at " noun2{names} " through " noun1{names} ; This will cause
                                                       ; the alternate
                                                       ; syntax to be used
}
</pre>

<p>When the second syntax is used by the player, the only action is to execute a a <b>proxy</b> command. This issues a command on the player's behalf that matches the first syntax, therefore arriving at the main function with <b>noun1</b> and <b>noun2</b> pointing to the correct objects.

<p>The macro <b>{names}</b> is almost exclusively used with the <b>proxy</b> command and outputs all of the names of the object separated by spaces. For example, the following code will issue the command "set safe dial to 42":

<pre>
object dial : safe dial
 short		the "safe dial"

{set
execute +build_command&lt;this&lt;42
}

{+issue_set
proxy "set " arg[0]{names} " to " arg[1]
}
</pre>

<table class="infowarn"><tr>
<td><img src="warning.png" alt="Warning"></td>
<td>Don't forget to put spaces before and after any macros or variables used in a <b>proxy</b> command.</td>
</tr></table>

<h2><a class="section" name="special3">Trigonometry</a></h2> 

<p>JACL provides a set of trigonometric commands to help model a two dimensional space. Each object in JACL has the integer elements <b>x</b>, <b>y</b>, <b>bearing</b> and <b>velocity</b>. The values of these elements are read and updated by the following three commands.

<h2><a class="section" name="special4">The POSITION Command</a></h2> 

<p>The <b>position</b> command is used to change an object's <b>x</b> and <b>y</b> elements to simulate it moving on a two-dimensional grid. The movement that occurs depends on the current values for the object's <b>bearing</b> and <b>velocity</b>. A <b>position</b> command is simply followed by the label of the object to be moved:

<pre>
set ship_object(bearing) = 180
set ship_object(velocity) = 100
set ship_object(x) = 500
set ship_object(y) = 500

position ship_object
</pre>

<p>The above code will set <b>ship_object(x)</b> to equal 500 and <b>ship_object(y)</b> to equal 400.

<h2><a class="section" name="special5">The BEARING Command</a></h2> 

<p>The <b>bearing</b> command is used to calculate the angle from one object to another based on their current <b>x</b> and <b>y</b> values. A <b>bearing</b> command is followed by a variable to store the calculated angle in, the object to measure the angle from, then the object to measure the angle to. For example:

<pre>
bearing INDEX lighthouse ship
write "Bearing from " lighthouse{the} " to " 
write ship{the} ": " INDEX " degrees.^"
</pre>

<p>The above code calculates the bearing from the object <b>lighthouse</b> to the object <b>ship</b> in degrees (0 - 359), and stores the result in the variable <b>INDEX</b>. This calculation is based on the current values of <b>lighthouse(x)</b> and <b>lighthouse(y)</b> relative to the current values of <b>ship(x)</b> and <b>ship(y)</b>. 

<h2><a class="section" name="special6">The DISTANCE Command</a></h2> 

<p>The <b>distance</b> command is used to calculate the distance between two objects based on their current <b>x</b> and <b>y</b> values. A <b>distance</b> command works in the same manner as a <b>bearing</b> command:

<pre>
distance INDEX lighthouse ship
write "Distance from " lighthouse{the} " to " 
write ship{the} ": " INDEX ^
</pre>

<p>The above code calculates the distance between the object <b>lighthouse</b> and the object <b>ship</b> and stores the result in the variable <b>INDEX</b>. This calculation is based on the current values of <b>lighthouse(x)</b> and <b>lighthouse(y)</b> relative to the current values of <b>ship(x)</b> and <b>ship(y)</b>. 

<h2><a class="section" name="special7">The ASKNUMBER AND GETNUMBER Commands</a></h2> 
<p>The commands <b>asknumber</b> and <b>getnumber</b> prompt the player to input a number between a particular range and wait for a response. The only difference between the two commands is that <b>getnumber</b> will continue to ask the player for a valid response, only returning when a number between the upper and lower limit is entered. Both of these commands use the following syntax:
<pre>
<b>asknumber</b> <i>StorageVariable LowerLimit UpperLimit</i>
</pre>

<p><i>StorageVariable</i> is the integer variable used to store the number entered by the player. <i>LowerLimit</i> and <i>UpperLimit</i> indicate the inclusive range of numbers that are acceptable. For example, below is some code that prompts the player to enter a number between 1 and 5 (inclusive), and stores the answer in a variable called <b>RESPONSE</b>:

<pre>
integer RESPONSE
integer UPPER       5

{+ask_player
...
asknumber RESPONSE 1 UPPER
write &quot;You typed &quot; RESPONSE .^
}
</pre>

<p>When using the <b>asknumber</b> command, if the player enters an invalid response, <b>-1</b> will be placed in the storage variable and the next line of code will be executed.

<h2><a class="section" name="special8">The GETSTRING Command</a></h2> 

<p>The command <b>getstring</b> will prompt the player to enter an arbitrary string of text. The only parameter of a <b>getstring</b> is the name of the string variable to store the player's response. Below is an example of the use of the <b>getstring</b> command:

<pre>
string players_name

{+intro
write "What is your name? "
getstring players_name
write "Hello " players_name "!^"
}
</pre>

<h2><a class="section" name="special9">The GETYESORNO Command</a></h2> 

<p>The command <b>getyesorno</b> will prompt the player to enter <b>yes</b> or <b>no</b>. It will repeatedly prompt the player to enter a valid response until they do so. The only parameter of a <b>getyesorno</b> command is the integer variable used to store the player's response. If the player types <b>yes</b> (or <b>y</b>), the variable will contain the number 1. If the player types <b>no</b> (or <b>n</b>), the variable will contain the number 0. Below is an example of the <b>getyesorno</b> command in action:

<pre>
constant hints		5

{+ask_player
write &quot;Would you like hints?^&quot;
getyesorno player(hints)
if player(hints) =  1
   write &quot;You typed yes.^&quot;
else
   write &quot;You typed no.^&quot;
endif
}
</pre>

<h2><a class="section" name="special10">The SAVEGAME and RESTOREGAME Commands</a></h2> 

<p>These commands can be used to access the internal functionality to save and restore the current game state. Both of these commands require a container to be passed as a parameter. This container is used to store the return code of the command. If the save or restore operation fails, an appropriate error message will be displayed and the supplied container will be set to <b>false</b>. If the save or restore operation is successful, the supplied container will be set to <b>true</b> and no message will be displayed. Both commands accept an optional second parameter that is a string to use as the filename. If this parameter is not supplied the Glk library will prompt the player to select a file. A common use of these commands is to define the functions <b>+save_game</b> and <b>+restore_game</b> to override the internal implementation of this functionality. For example:

<pre>
variable ANSWER
variable RETURN_CODE

{+restore_game
write &quot;Are you sure you wish to restore a saved game?^&quot;
getyesorno ANSWER
if ANSWER = 0
   write &quot;Returning to game.^&quot;
   return
endif
restoregame RETURN_CODE
if RETURN_CODE = true
   print:
      &quot;You cast the spell of time travel and return to the past...^&quot;
   .
endif
}
</pre>

<p>The ability to supply a filename can be used to either allow the player to supply the filename directly after the save command, or implement a system of auto-saving every tenth move such as this:

<pre>
{+eachturn
set save_timer = total_moves
set save_timer % 10
if save_timer = 0
   set save_count + 1
   setstring filename "autosave"
   addstring filename save_count
   addstring filename ".sav"
   savegame RETURN_CODE filename
endif
</pre>

<h2><a class="section" name="special12">The TERMINATE Command</a></h2> 

<p>The <b>terminate</b> command will directly initiate the termination of the JACL interpreter.

<h2><a class="section" name="special13">The UNDOMOVE Command</a></h2> 

<p>The <b>undomove</b> command will take the game back to the state it was in prior to the player's last command.



<h1><a class="title" name="attributesttributes0">Attributes</a></h1>

<P>Attributes are a set of qualities that an item either <B>has</B> or <B>hasnt</B>. An item can have none of the possible attributes, all of the possible attributes, or any combination in between. Initial attributes are given to an object in its definition using the keyword <B>has</B> (see the chapter <a href="definitions.html">Definitions in Detail</a>), while they are given and taken away during the course of the game using the <B>ensure</B> command. Many of the attributes do not have any pre-determined purpose and may be used by the author at will. The best way to determine the full effect of any given attribute is to search for it in the <B>verbs.library</B> file.


<h2><a class="section" name="attributes1">The ENSURE Command</a></h2>

<P>The <b>ensure</b> command is used to change which attributes an item has and uses the following syntax:

<pre>
<B>ensure</B> <I>Item</I> <B>has</B>/<B>hasnt</B> <I>Attribute</I>
</pre>

<P>There is nothing really tricky about the <B>ensure</B> command. You are either giving an item an attribute with a command like:

<pre>
ensure dungeon has DARK
</pre>

<P>or taking an attribute away from an item with a command like:

<pre>
ensure lantern hasnt LUMINOUS
</pre>

<h2><a class="section" name="attributes2">Object Attributes</a></h2>

<P>Below is a list of the attributes that can be given to an object, and some brief notes on each. 

<table width=100%><tr>
<th width=20%>Attribute</th>
<th>Description</th>
</tr><tr>
<td><B>CLOSED</b></td>
<td>If an object has the attribute <B>CLOSED</B>, its contents will not be accessible to the player.</TD>
</TR>
<TR><td><B>LOCKED</B></TD>
<td>If an object has the attribute <B>LOCKED</B>, it cannot be opened or closed by the player.</TD>
</TR>
<TR><td><B>DEAD</B></TD>
<td>An object that has the attribute <B>DEAD</B> must also have the attribute <B>ANIMATE</B>. A <B>DEAD</B> object may not be killed, talked to, shown things or given things.</TD>
</TR>
<TR><td><B>IGNITABLE</B></TD>
<td>An object that has the attribute <B>IGNITABLE</B> may be used to light an object that has the object <B>FLAMMABLE</B>.</TD>
</TR>
<TR><td><B>WORN</B></TD>
<td>An object that has the attribute <B>WORN</B> will not burden the player with its <b>mass</b>. In order to wear an object it must also have the attribute <B>WEARABLE</B>. While an object has the <B>WORN</B> attribute, the player will not be able to drop it or give it away.</TD>
</TR>
<TR><td><B>CONCEALING</B></TD>
<td>An object that has the attribute <B>CONCEALING</B> must also have the attribute <B>ANIMATE</B>. This attribute indicates that when the object is examined, the objects that it is carrying should not be listed.</TD>
</TR>
<TR><td><B>LUMINOUS</B></TD>
<td>When it is present, an object that has the attribute <B>LUMINOUS</B> will allow the player to enter a location that has the attribute <B>DARK</B>.</TD>
</TR>
<TR><td><B>WEARABLE</B></TD>
<td>The player may wear an object that has the attribute <B>WEARABLE</B>.</TD>
</TR>
<TR><td><B>CLOSABLE</B></TD>
<td>An object that has the attribute <B>CLOSABLE</B> may be opened and closed by the player.</TD>
</TR>
<TR><td><B>LOCKABLE</B></TD>
<td>An object that has the attribute <B>LOCKABLE</B> may be locked and unlocked by the player.</TD>
</TR>
<TR><td><B>ANIMATE</B></TD>
<td>An object that has the attribute <B>ANIMATE</B> may be killed, talked to, shown things or given things.</TD>
</TR>
<TR><td><B>LIQUID</B></TD>
<td>An object that has the attribute <B>LIQUID</B> must be carried within an object that has the attribute <B>CONTAINER</B> and may be drunk or poured by the player.</TD>
</TR>
<TR><td><B>CONTAINER</B></TD>
<td>An object that has the attribute <B>CONTAINER</B> may have other objects put inside it. If it also has <B>CLOSABLE</B> it must not have <B>CLOSED</B> for the player to put things in it. A container may hold as many <B>mass</B> units as its <B>capacity</B> element is set to. </TD>
</TR>
<TR><td><B>SURFACE</B></TD>
<td>An object that has the attribute <B>SURFACE</B> may have things placed on top of it. A surface may hold as many <B>mass</B> units as its <B>capacity</B> element is set to. </TD>
</TR>
<TR><td><B>PLURAL</B></TD>
<td>If an object is defined with a plural name, it should be given the attribute <B>PLURAL</B> so the library will avoid printing sentences such as "The boulders is too heavy to go throwing around."</TD>
</TR>
<TR><td><B>FLAMMABLE</B></TD>
<td>An object that has the attribute <B>FLAMMABLE</B> may be lit using an object that has the attribute <B>IGNITABLE</B>.</TD>
</TR>
<TR><td><B>BURNING</B></TD>
<td>When an object that has the attribute <B>FLAMMABLE</B> is lit, it will be given the attributes <B>BURNING</B> and <B>LUMINOUS</B>.</TD>
</TR>
<TR><td><B>ON</B></TD>
<td>Free for use by the author.</TD>
</TR>
<TR><td><B>DAMAGED</B></TD>
<td>Free for use by the author.</TD>
</TR>
<TR><td><B>FEMALE</B></TD>
<td>This attribute should be given to any object that has the attribute <B>ANIMATE</B> and represents a female character. This will enable the library to refer to the character correctly.</TD>
</TR>
<TR><td><B>POSSESSIVE</B></TD>
<td>If an object has the attributes <B>ANIMATE</B> and <B>POSSESSIVE</B> the player will not be able to take objects from them or ask them for objects unless specifically coded for.</TD>
</TR>
<TR><td><B>OUT_OF_REACH</B></TD>
<td>An object that has the attribute <B>OUT_OF_REACH</B> cannot be touched, even when it is in the same location as the player.</TD>
</TR>
<TR><td><B>TOUCHED</B></TD>
<td>An object that has the attribute <B>TOUCHED</B> has been moved from its starting position by the player. If the object's <B>long</B> property is set to <b>function</b>, this attribute can be tested to give an appropriate description.</TD>
</TR>
<TR><td><B>SCORED</B></TD>
<td>Free for use by the author.</TD>
</TR>
<TR><td><B>SITTING</B></TD>
<td>If the player is currently sitting, this attribute should be given, as the function <B>+movement</B> will check if it is set before moving the player.</TD>
</TR><tr>
<td><b>NO_TAB</b></td>
<td>This attribute indicates that the object's names should not be included during tab completion. Tab completion is only used by the console interpreter.</td>
</tr>
<TR><td><B>NOT_IMPORTANT</B></TD>
<td>This attribute is given to an object that is of no consequence game. It is usually used to implement nouns that are referred to in a location description but are not part of the game world the player needs to interact with. Verbs in the library will respond with <b>You don't need to worry about that.</b> when the player attempts to interact with an object that has this attribute.</TD>
</TR>
</TABLE>

<h2><a class="section" name="attributes3">Location Attributes</a></h2>

<P>Below is a list of the attributes that can be given to a location, and some brief notes on each. 

<table width=100%>
<tr><th width=20%>Attribute</th>
<th>Description</th>
</tr><tr>
<TD><b>VISITED<br>MAPPED</b></td>
<td>When the player enters a location, it is automatically given the attributes <B>VISITED</B> and <b>MAPPED</b> after the <b>look</b>function is run. These attributes may be tested for to provide a shorter description on subsequent visits. When the JACL interpreter is set to verbose mode (the <B>DISPLAY_MODE</B> variable is set to 1), locations will have the attribute <B>VISITED</B> taken away from them before the <b>look</b> function is executed.</TD>
</tr><tr>
<td><B>DARK</B></TD>
<td>If a location has the attribute <B>DARK</B>, the player must be carrying an object that has the attribute <B>LUMINOUS</B> in order to enter it.</TD>
</tr><tr>
<td><b>DARKNESS</b></td>
<td>If the player's current location has the attribute <b>DARK</b> and no object with the attribute <b>LUMINOUS</b> is present, the location will be given the attribute <b>DARKNESS</b> and the player will be prevented from performing any actions that require the ability to see. You should never manually give or take the attribute <b>DARKNESS</b> to or from a location, only the attribute <b>DARK</b>.</td>
</tr><tr>
<td><B>ON_WATER</b></td>
<td>If a location has the attribute <B>ON_WATER</B>, any object dropped will sink out of sight and end up in <B>limbo</B>.</TD>
</tr><tr>
<td><B>UNDER_WATER</b></td>
<td>If a location has the attribute <B>UNDER_WATER</B>, nothing may be lit, exposed liquids will dissipate and no talking is possible.</TD>
</tr><tr>
<td><b>WITHOUT_AIR</b></td>
<td>If a location has the attribute <B>WITHOUT_AIR</B>, the <B>OXYGEN_LEFT</B> variable will be decremented each turn until it reaches zero and suffocation occurs.</TD>
</tr><tr>
<td><b>OUTDOORS</b></td>
<td>If a location has the attribute <B>OUTDOORS</B>, any desired effects of weather should be applied.</td>
</tr><tr>
<td><b>MID_AIR</b></td>
<td>If a location has the attribute <B>MID_AIR</B>, any object dropped will fall out of sight and end up in <B>limbo</B>. Actions such as jumping will not be allowed either.</td>
</tr><tr>
<td><b>MID_WATER</b></td>
<td>If a location has the attribute <B>MID_WATER</B> any object dropped will sink out of sight and end up in <b>limbo</b>.</TD>
</tr><tr>
<td><b>TIGHT_ROPE</b></td>
<td>If a location has the attribute <B>TIGHT_ROPE</B>, any object dropped will fall out of sight and end up in <B>limbo</B>. </TD>
</tr><tr>
<td><b>POLLUTED</b></td>
<td>Free for use by the author.</TD>
</tr><tr>
<td><B>SOLVED</B></TD>
<td>Free for use by the author.</TD>
</tr><tr>
<td><B>LOCATION</B></TD>
<td>All locations have the attribute <B>LOCATION</B>. If this is taken away the location will become an object.</TD>
</tr><tr>
<td><B>SCORED</B></TD>
<td>Free for use by the author.</TD>
</tr><tr>
<td><b>NO_TAB</b></td>
<td>This attribute indicates that the location's names should not be included during tab completion. Tab completion is only used by the console interpreter.</td>
</tr>
<TR><td><B>NOT_IMPORTANT</B></TD>
<td>This attribute is given to a location that is of no consequence game. It is usually used to implement nouns that are referred to in a location description but are not part of the game world the player needs to interact with. Verbs in the library will respond with <b>You don't need to worry about that.</b> when the player attempts to interact with an object that has this attribute.</TD>
</TR>
</table>

<h2><a class="section" name="attributes4">User Attributes</a></h2>

<P>A common use of attributes is to check if an action has already been performed. This may be useful if it is not logically possible to perform the action twice, or each subsequent attempt would result in a different outcome. Another possibility is that you would like to give a lengthy response the first time, then a short response on all subsequent times. To help facilitate this, and many other types of game-specific behaviour, JACL allows you to define up to 32 user attributes. User attributes are defined using the <b>attribute</b> directive followed by one or more attribute names. Below is a rather minimal example of using user attributes:

<pre>
attribute DOOR_OPENED

{open_override
ensure door hasnt CLOSED
if door hasnt DOOR_OPENED
   write "You hold your breath as the door slowly "
   write "creaks open.^"
   ensure door has DOOR_OPENED
   return
endif
write "You open the door again.^"
}
</pre>

<p>The above code creates a user attributes called <b>DOOR_OPENED</b> and gives the object <b>door</b> that attribute when it is first opened. It also tests whether the door already has this attribute before deciding which message to display.



<h1><a class="title" name="functions0">Functions</a></h1>

<P>Functions in JACL are similar in principle to functions and procedures in many other programming languages. They act as sub-routines, discrete units of code that can be executed manually from other functions or internally by the interpreter. 

There are two fundamental types of functions: global and associated. A global function is independent of any object and is designated as such by being given a name beginning with a plus sign. Any function whose name does not begin with a plus sign is automatically associated with the nearest object or location above it in the game file.

<table class="infowarn"><tr>
<td><img src="warning.png" alt="Warning"></td>
<td>It is illegal to define a non-global function before the first object or location as it will not have an object or location to be associated with.</td>
</tr></table>

<p>A function begins with a opening curly brace (<b>{</b>) that is followed directly by the name of the function. It is possible for a function to have multiple names by providing additional names on the same line as the opening curly brace, each separated by whitespace. Below is an example of a function associated with an object:

<pre>
object boulder

{take : push : turn
write "The boulder is way too heavy to move.^"
set time = false
}
</pre> 

<p>This function has three names. As none of the names begin with a plus sign, they are all names associated with the object <b>boulder</b>. 

<p>The full internal name of an associated function is constructed by taking the name as it appears in the program, then appending an underscore and the label of the object or location that it is associated with. For example, the above function has the full internal names of: <b>take_boulder</b>, <b>push_boulder</b> and <b>turn_boulder</b>.

<p>If the name of a function begins with a plus sign, it is considered to be a global function and the label of the nearest object is not appended to the supplied name. For example, the function <b>+eachturn</b> has the full internal name of <b>+eachturn</b>.

<h2><a class="section" name="functions1">The EXECUTE and CALL Commands</a></h2>

<p>All <b>execute</b> and <b>call</b> commands are of the following format:

<pre>
<b>execute</b>/<b>call</b> [<i>object</i><b>.</b>]<i>FunctionName</i>[<b>&lt;</b><i>arg1</i><b>&lt;</b><i>arg2</i>...]
</pre>

<P>The <B>execute</B> command allows the manual execution of any function by specifying its full internal name. The <b>call</b> command is almost identical except it will not display an error if the function does not exist. This behaviour is required when calling a function that contains some optional, extra code that may or may not exist. When executing functions manually using the <b>execute</b> or <b>call</b> commands, the full internal name must be specified. With global functions, this is simply the name of the function as it appears in the program. For example, the following function:

<pre>
{+hello
write "Hello world!"
}
</pre>

<p>would be called with the command:

<pre>
execute +hello
</pre>

<p>The full internal name of an associated function is constructed by taking the name as it appears in the program, then appending an underscore and the label of the object or location that it is associated with.  For example, the following function:

<pre>
object wheel : steering wheel

{examine
write "The steering wheel is covered in black leather.^"
}
</pre>

<p>would be called with the command:

<pre>
execute examine_wheel
</pre>

<p>Once a function is executing, the string constant <b>function_name</b> is set to contain the full internal name that was used to call the function. This can be useful if the function has multiple names and you need to modify its behaviour based on which function was used to call it. For example:

<pre>
{+intro
execute "+example"
}

{+test : +example : +multi
write function_name ^
}
</pre>

<p>This code will simply output the string <b>+example</b>

<p>An <b>execute</b> command also allows the name of a function be to prefixed with an item label or pointer, followed by a period. This tells the interpreter to execute the specified function that is associated with the specified item. For example, the above command could also be expressed as:

<pre>
execute wheel.examine
</pre>

<p>The advantage of this syntax is that an item pointer or variable can be used in place of the object label <b>wheel</b>. The following code snippet is equivalent to the command above:

<pre>
set noun4 = wheel
execute noun4.examine
</pre>

<p>When using the syntax of an object pointer or label followed by a period, it is legal to supply a variable, integer constant or object element as the function name. This is useful when you wish to either iterate through a series of functions associated with an object or dynamically map an action to a function at run-time. The name of the function called will be the current integer value of the supplied variable. For example, the code below demonstrates two ways to call the function <b>1</b> that is associated with the dial:

<pre>
constant	setting 2

object dial : dial
 short	   a "dial"
 setting   5

{1
write "You set the dial to one^"
}

set dial(setting) = 1

execute dial.dial(setting)

# OR, MORE DIRECTLY...
execute 1_dial
</pre>

<p>It is possible to associate a function with more than one object by prefixing the function name with an asterisk (<b>*</b>). When you prefix a function with an asterisk the full internal name of the function will be stored exactly as the name supplied. This allows you to construct a name that mirrors the name that would be created for a normal associated function. For example:

<pre>
object redball : red ball

object blueball : blue ball

object yellowball : yellow ball

{kick : *kick_redball : *kick_blueball
write noun1{The} " sails high in the air.^"
}
</pre>

<p>The above function has three names, the first automatically associating it with the yellow ball in the normally fashion with the second two manually associating it with the objects <b>redball</b> and <b>blueball</b>. The order the names are defined in is not important.

<table class="infowarn"><tr>
<td><img src="warning.png" alt="Warning"></td>
<td>When using the above technique to manually associate a function with an object, the label of the object must not contain an underscore. This is because the supplied function name is parsed from the right, with everything after the first underscore encountered being considered the object label. If a function was to be given the name <b>*kick_blue_ball</b>, the interpreter would attempt to associate the function <b>kick_blue</b> with the object <b>ball</b>.</td>
</tr></table>

<p>It is also possible to supply the name of the function to be executed in a string variable or constant. This technique allows strings to be used as function pointers and is used by the <b>menu.library</b> as a way of passing a call-back function to function in the library. See the chapter on the <a href="#menu1">menu.library</a> for an example.

<p>A function will stop executing and return to the function that it was called from when it encounters a <b>return</b> command or arrives at the closing brace. If a function reaches its closing brace, an implicit <b>return true</b> is executed. 

<h3><a class="section" name="functions2">Passing Arguments to a Function</a></h3>

<P>It is possible to pass string and integer arguments to a function when executing it. This is done by following the function name by a less-than symbol (<b>&lt;</b>) followed by the value to pass. Each additional argument is separated by another less-than symbol. When the specified function is executed, the arrays <b>arg</b> and <b>string_arg</b> are populated with the values passed. The array <b>string_arg</b> stores a copy of the string value of every argument passed. If a string variable or constant is supplied as an argument, the value of the string constant is stored, not the name of the constant itself. The array <b>arg</b> stores integer value for every argument that can be resolved to an integer. If an argument can't be resolved to an integer, -1 is stored at that point in the array. The arrays <b>arg</b> and <b>string_arg</b> are always of equal length, being the total number of arguments supplied. Below is an example of a function call that passes seven arguments and a function that displays them:

<pre>
string   test   "This is a string constant."

variable DEPTH  0
variable INDEX  0

{+some_function 
...
set DEPTH = 99
execute "+subfunction&lt;This is a literal string.&lt;42&lt;Fred&lt;test&lt;12&lt;DEPTH&lt;13"
...
}

{+subfunction
set INDEX = 0
while INDEX != @arg
  write "arg[" INDEX "]: " arg[INDEX] "  string_arg[" INDEX "]: " string_arg[INDEX] ^
  set INDEX + 1
endwhile
}
</pre>

<p>The above code produces the following output:

<pre>
arg[0]: -1   string_arg[0]: This is a literal string.
arg[1]: 42   string_arg[1]: 42
arg[2]: -1   string_arg[2]: Fred
arg[3]: -1   string_arg[3]: This is a string constant.
arg[4]: 12   string_arg[4]: 12
arg[5]: 99   string_arg[5]: fuel_left
arg[6]: 13   string_arg[6]: 13
</pre>

<table class="infowarn"><tr>
<td><img src="info.png" alt="Information"></td>
<td>
<p>The first argument passed to a function is also stored in the object pointer <B>noun3</B> for historical reasons.
</td></tr></table>

<h2><a class="section" name="functions3">The function-call count</a></h2>

<p>Every time a function is executed, an internal count of the number of times it has been called is increased by one. The value of this count is obtained by prefixing the full internal name of the function with an at symbol (<b>@</b>). If an at symbol is used on its own, the number of times the current function has executed is returned.

<p>For example, below is the same example used in the section <a href="#attributes4">User Attributes<a>, modified to use the function-call count:

<pre>
{open_override
ensure door hasnt CLOSED
if @ = 1
   write "You hold your breath as the door slowly "
   write "creaks open.^"
   return
endif
write "You open the door again.^"
}
</pre>

<h2><a class="section" name="functions4">The RETURN Command</a></h2>

<p>The <b>return</b> command is used to pass a value back to the function that called it, or the interpreter if called internally. A <b>return</b> command with no parameters will return the value <b>1</b>, which is the same as a function simply reaching its closing bracket. If a value is specified as a parameter to a <b>return</b> command, that value will be returned instead. For example:

<pre>
{+some_function
set RESULT = +adder&lt;16&lt;21&lt;42&lt;75
write "The result is: " RESULT
}

{+adder
set INDEX = 0
set COUNTER = 0
while INDEX != @arg
  set COUNTER + arg[INDEX]
  set INDEX + 1
endwhile
return COUNTER
}
</pre>

<p>The above function <b>+adder</b> will sum all the values passed as arguments and then return the result to the calling function.

<h2><a class="section" name="functions5">Responding to the Player's Moves</a></h2>

<P>In this section you will learn more about the function calls made by the interpreter when the player types a move while playing a game. As the first step in processing the player's move, the interpreter attempts to find a <B>grammar</B> statement that matches the command typed. For more information see the section on <a href="#definitions12">Grammar Statements</a>. 

If a match is found, the function after the greater-than symbol at the end of the <B>grammar</B> statement is used as the core name for a series of function calls. This mapping of the player's moves to functions through the use of <b>grammar</b> statements is one of the fundamental principles of writing a JACL game. 


<p>Before calling any functions, the interpreter will set two object pointers, <B>noun1</B> and <B>noun2</B>. These are set to the objects referred to in the move typed by the player in the order they occur. For example, for a move like "insert card in slot", <b>noun1</b> would be set to the card, and <b>noun2</b> would be set to the slot. We will start, however, by examining a move that refers to a single object, such as "take wooden pole".

<p>The <b>grammar</b> statement that matches the move "take wooden pole" looks like this:

<pre>
grammar take *here &gt;take
</pre>

<p>This <b>grammar</b> statement says that if a move consisting of the word <b>take</b> followed by an object that is in the current location is typed, execute the function <b>take</b>. In reality there are a number of possible functions that can be called, each having <b>take</b> as a part of their name. For the purpose of the following examples, we will assume that the object "wooden pole" has the label <b>pole</b>.

<p>After the player types the move "take wooden pole", the first function the interpreter will attempt to execute is the global function <b>+before</b>. If this function exists, and does not return <b>false</B>, no further processing is performed with regard to this move.  

<p>The next function the interpreter will attempt to execute is the global function <b>+before_take</b>. If this function exists, and does not return <b>false</B>, no further processing is performed with regard to this move. Below is an example of what this function might look like:

<pre>
{+before_take
if guard is *here
   write &quot;You decided to leave &quot; noun1{the} &quot; alone &quot;
   write &quot;while the guard is around.&quot;
   return 
endif
return false ;continue as normal
}
</pre>

<P>As you can see, the <B>+before_take</B> function is independent of the object being taken. This makes it ideal for situations that affect all objects. If this function returns <b>false</b>, or does not exist at all, the interpreter will next attempt to execute the function <b>take_pole</b>. This function will appear in the game file as a function called <b>take</b> that is associated with the object <b>pole</b>. 

<p>If this function exists, it will be executed in place of the default global action for the <b>take</b> verb. If this function does not exist, or returns <b>false</b>, the global function <b>+take</b> will be executed. This function contains the default outcome for the <b>take</b> verb. Below is the <b>+take</b> function from the library:

<pre>
{+take         
if +important&lt;noun1 = true
   return true
endif
if +darkness = true
   return true
endif
if +reach&lt;noun1 = true
   return true
endif
if player has SITTING
  write "You will have to stand up first.^"
  set TIME = false
  return
endif
if noun1(mass) &gt;= heavy : noun1 has LOCATION
  execute +move_scenery
  return
endif  
if noun1(mass) &gt; player(capacity)
  write "You are carrying too much to take " noun1{the} .^
  set TIME = false
  return
endif
if noun1 has LIQUID
  write noun1{The} " run" noun1{s} " through your fingers.^"
  return
endif
override
write "You take " noun1{the} .^
move noun1 to player
ensure noun1 has TOUCHED
}
</pre>
 
<p>This function performs a few simple tests to confirm the move is possible then moves the object being taken to the player. When this function reaches the <b>override</b> command (the fourth line from the end), the interpreter will attempt to execute the function <b>take_override_pole</b>. This will appear in the game file as a function called <b>take_override</b> that is associated with the object <b>pole</b>. If this function exists, it will replace all the code that comes after the <b>override</b> command in the function <b>+take</b>. This allows an object-specific outcome to be coded for, while still taking advantage of all the tests that precede the <b>override</b> command performed. For this reason, an <b>override</b> function is only of use when there is a chance that the player's move may not be possible. This is the case with the <b>take</b> command in situations such as when the player is already carrying too much, the object they are attempting to take is out of reach, or it is a liquid.

<p>If the function <b>take_override_pole</b> does not exist, the interpreter will attempt to execute the function <b>+default_take</b>. This function allows the author to code a default override function that applies to all objects.

<table class="infowarn"><tr>
<td><IMG SRC="info.png" alt="Information"></TD>
<td>The same effect can be achieved by modifying the code after the <b>override</b> command of the <b>+take</b> function in the library. Putting this code in <b>+default_take</b>, however, allows the library to be upgraded to a newer version at any time without losing your game-specific modifications. This is obviously the preferred method.</TD>
</tr></table>

<p>If the <b>override</b> command in the function <b>+take</b> is reached, and neither a <b>take_override_pole</b> or <b>+default_take</b> function exists, execution will continue from the line after the <b>override</b> command.

<p>The final stage in processing the player's move calls a series of <b>after</b> functions, regardless of the outcome of any preceding it. It is not important whether any <b>after</b> function executes a <b>return</b> or <b>return false</b> command, as all three <b>after</b> function will execute in order regardless of outcome of the one before. The first function to be called in this final stage is the local function <b>after_take</b> that is associcated with the object <b>pole</b>. This function provides the opportunity to perform any processing required after the move <b>take pole</b> is issued by the player, regardless of any previous outcome.

<p>The next function called is <b>+after_take</b>. This function provides the opportunity to display any additional text relevant only to the <b>take</b> verb, but independent of any objects referred to. Below is an example of this:

<pre>
{+after_take
if noun1 = cookie
   if cookie(parent) = player
      if fred is *here
          write "Fred looks a bit upset that you have"
          write "taken the last cookie.^"
          return
      endif
   endif
endif
}
</pre>

<p>Finally the global function <b>+after</b> is called. This function provides the opportunity to perform any additional processing before the player's move is complete, regardless of the verb used or any objects referred to. 

<p>The above example details the function calls made for a command referring to a single object. The following three lists detail all the functions called for an in-game command containing no objects, one object and two objects respectively.

<p><B>grammar</B> <I>verb</I> <B>&gt;</B><I>CoreFunction</I>

<OL>

<li>The interpreter attempts to execute the function <b>+before_</b><i>CoreFunction</i>. If this function exists and does not return <b>false</b>, execution will skip directly to <b>+after_</b><i>CoreFunction</i>.</li>

<LI>If it does not exist, or returns <b>false</b>, an attempt will be made to execute <I>CoreFunction</I><B>_</B><I>CurrentLocation</I>. This is a function called <I>CoreFunction</I> that is associated with the current location.</LI>

<LI>If this does not exist, an attempt will be made to execute the global function <B>+</B><I>CoreFunction</I>.</LI>

<LI>If this function contains an <B>override</B> command, an attempt will be made to execute <I>CoreFunction</i><b>_override_</b><I>CurrentLocation</I>. This is a function called <I>CoreFunction</i><b>_override</b> that is associated with the current location.</LI>

<li>If it does not exist, or returns <b>false</b>, an attempt will be made to execute the function <b>+default_</b><i>CoreFunction</i>. 

<LI>If this does not exist, or returns <b>false</b>, execution will continue from the line after the <B>override</B> command.</LI>

<li>The interpreter attempts to execute the function <b>+after_</b><i>CoreFunction</i>.</li> 

</OL>

<P><b>grammar</b> <I>verb</I> <b>*</b><i>Object1</i> <b>&gt;</B><I>CoreFunction</I>

<OL>

<li>The interpreter attempts to execute the function <b>+before_</b><i>CoreFunction</i>. If this function exists and does not return <b>false</b>, execution will skip directly to <b>+after_</b><i>CoreFunction</i>.</li>

<LI>If it does not exist, or returns <b>false</b>, an attempt will be made to execute <I>CoreFunction</I>_<I>Object1</i>. This is a function called <I>CoreFunction</I> that is associated with <i>Object1</i>.</LI>

<LI>If this does not exist, an attempt will be made to execute the global function <B>+</B><I>CoreFunction</I>.</LI>

<LI>If this function contains an <b>override</b> command, an attempt will be made to execute <I>CoreFunction</i><b>_override_</b><I>Object1</I>. This is a function called <I>CoreFunction</i><b>_override</b> that is associated with the specified object.</LI>

<li>If it does not exist, or returns <b>false</b>, an attempt will be made to execute the function <b>+default_</b><i>CoreFunction</i>. 

<LI>If this does not exist, or returns <b>false</b>, execution will continue from the line after the <B>override</B> command.</LI>

<li>The interpreter attempts to execute the function <b>+after_</b><i>CoreFunction</i>.</li> 

</OL>

<P><b>grammar</B> <I>verb</I> <b>*</B><I>Object1</I> <I>preposition</I> <B>*</B><I>Object2</I> <b>&gt;</b><i>CoreFunction</i>

<OL>

<li>The interpreter attempts to execute the function <b>+before_</b><i>CoreFunction</i>. If this function exists and does not return <b>false</b>, execution will skip directly to <b>+after_</b><i>CoreFunction</i>.</li>

<LI>If it does not exist, or returns <b>false</b>, an attempt will be made to execute <I>CoreFunction_Object2_Object1</I>. This is a function called <I>CoreFunction_Object2</I> that is associated with <I>Object1</i>.</LI>

<LI>If this does not exist, or returns <b>false</b>, an attempt will be made to execute the global function <B>+</B><I>CoreFunction</I>.</LI>

<LI>If this function contains an <B>override</B> command, an attempt will be made to execute <I>CoreFunction_ Object2</i><b>_override_</b><I>Object1</I>. This is a function called <I>CoreFunction_Object2</i><b>_override</b> that is associated with <I>Object1</I>.</LI>

<li>If it does not exist, an attempt will be made to execute the function <b>+default_</b><i>CoreFunction</i>. 

<LI>If this does not exist, or returns <b>false</b>, execution will continue from the line after the <B>override</B> command.</LI>

<li>The interpreter attempts to execute the function <b>+after_</b><i>CoreFunction</i>.</li>

</OL>

<h2><a class="section" name="functions6">Special Functions</a></h2>

<p>The following are some special purpose functions that are called internally by the JACL interpreter:</p>

<table width=100%><tr>
<th width=22%>Function</th>
<th>Description</th>
</tr><tr>
<td valign="top"><B>+bootstrap</B></TD>
<td>This function is only executed once when a game first loads. Any initialisation code that must be run before the <b>+header</b> function is executed must go here.</td>
</tr><tr>
<td valign="top"><B>+intro</B></TD>
<td>This function is executed when a game is first run or restarted. It is used to display introductory text and set the starting values for any variables required.</td>
</tr><tr>
<td valign="top"><B>+header</B></td>
<td>This function is the very first to be executed before the player's command is processed when playing with a CGI intepreter.</td>
</tr><tr>
<td valign="top"><B>+footer</B></td>
<td>This function is the very last to be executed after the player's command has been processed when playing with a CGI intepreter.</td>
</tr><tr>
<td valign="top"><B>+top</B></td>
<td>This function is the very first to be executed before the player's command is processed when paying with a GLK interpreter.</td>
</tr><tr>
<td valign="top"><B>+bottom</B></td>
<td>This function is the very last to be executed after the player's command has been processed when playing with a GLK interpreter.</td>
</TR><TR>
<td valign="top"><B>eachturn_</B><I>here</I></TD>
<td>If the current location has an <B>eachturn</B> function associated with it, it will be executed directly before, and under the same conditions as, <B>+eachturn</B>.</TD>
</tr><tr>
<td valign="top"><B>+eachturn</B></TD>
<td>This function is executed each time a successful command is entered by the player. The interpreter decides on whether or not a command was successful by examining the state of the variable <B>TIME</B>. If it is set to <B>true</B>, the <B>+eachturn</B> function will be executed (and the <B>TOTAL_MOVES</B> variable will be incremented by one), just before <b>+footer</b> is executed.</td>
</tr><tr>
<td valign="top"><B>+system_eachturn</B></TD>
<td>This is the final function to be executed after each successful command is entered by the player. This function is used to execute library code that is not game-specific and must be run after each of the player's commands.</td>
</tr><tr>
<td valign="top"><b>+dark_description</b></td>
<td>This function is called by the interpreter if a <b>look</b> command is executed in a location that has the attribute <B>DARKNESS</B>.</TD>
</tr><tr>
<td valign="top"><b>+object_descriptions</b></td>
<td>This function is called by the interpreter as the last step in processing a <b>look</b> command. It must display text that indicates the presence of all objects in the current location that don't have a <b>mass</b> of <b>scenery</b>.</TD>
</tr><tr>
<td valign="top"><b>+no_light</b></td>
<td>This function is called by verbs in the library if they are attempted by the player in a location that has the attribute <B>DARKNESS</B>.</TD>
</tr><tr>
<td><B>+movement</B></TD>
<td>This function is executed each time the player attempts to move to another location. If this function returns false (it does not exist or exited with the command <B>return</B> <B>false</B>), then the player's attempted movement is successful. If it does exist and does not exit with the command <B>return false</B> (reaches the end of the function or executes a <B>return</B> (<B>return true</B>) command), then the player is not moved. In this case, some text explaining why the movement did not occur should be displayed.</TD>
</tr><tr>
<td valign="top"><B>movement_</b><i>here</i></td>
<td>If the current location has a local <B>movement</B> function associated with it, it will be executed directly before, and under the same conditions as, <B>+movement</b>.</td>
</tr><tr>
<td valign="top"><B>+before_look</B></TD>
<td>This is the first function executed whenever a <B>look</B> command is executed. If it returns true no further processing of the <b>look</b> command occurs.</TD>
</tr><tr>
<td valign="top"><B>+title</B></TD>
<td>This function is executed after <b>+before_look</b>, but before the locations associated <b>look</b> function. This function is the place to put any generic code that prints the title of each location, or extra meta information such as whether the player is currently sitting down.</TD>
</tr><tr>
<td valign="top"><B>look_</B><I>here</I></TD>
<td>This function is executed whenever the player types a <B>look</B> command, moves into a new location or restores as saved game.</TD>
</tr><tr>
<td valign="top"><B>+object_descriptions</B></TD>
<td>This function is executed after the above <b>look</b> function to output the descriptions of all the objects present in the current location.</TD>
</tr><tr>
<td valign="top"><B>+after_look</B></TD>
<td>This is the last function executed whenever a <B>look</B> command is executed.</TD>
</tr><tr>
<td valign="top"><B>constructor_</B><I>item</I></TD>
<td>This function is executed for each item defined straight after the game file is loaded and before <b>+intro</b> is executed.</TD>
</tr><tr>
<td valign="top"><B>+save_game<br>+restore_game<br>+restart_game<br>+undo_move<br>+quit_game</b></TD>
<td>These functions may be defined to override the internal implementation of the respective system-level commands. When the player attempts to use one of these commands, the interpreter will first look for the presence of the corresponding global function. If this function exists it will be executed. If it does not exist, the default implementation inside the interpreter will be used.</td>

</tr></table>

<h2><a class="section" name="functions7">Utility Functions</a></h2>

<p>The following are utility functions that are provided by <b>utils.library</b>:

<table width=100%><tr>
<th width=20%>Function</th>
<th>Description</th>
</tr><tr>
<td valign="top"><b>+no_light</b></td>
<td>This function is called by verbs in the <b>verbs.library</b> if the player attempts to use them in a location that has the attribute <B>DARKNESS</B>.</TD>
</tr><tr>
<td valign="top"><B>+details</B> <i>Object</i></TD>
<td>This function displays information about the object that is passed to it as a parameter. This information includes whether the object is open or closed and any other objects that are contained within or being carried by this object.</td>
</tr><tr>
<td valign="top"><B>+contents</B> <i>Object</i></TD>
<td>This function displays a list of any other objects that are contained within or being carried by the object passed to it as a parameter. This function is called by <b>+details</b>.</td>
</tr><tr>
<td valign="top"><B>+spaced_contents</B> <i>Object</i></TD>
<td>This function is similar to <b>+contents</b> except that it starts a new paragraph if there are any objects to list. It is more suited for use after location descriptions.</td>
</tr>
</table>



<h1><a class="title" name="library0">Creating New Verbs</a></h1>

<p>Although the implementation of a large number of standard verbs is available in <b>verbs.library</b>, almost all large games will find the need to define custom verbs. New verbs are defined using <B>grammar</B> statements and their default implementation is provided in a global function. This chapter contains information on making your custom verbs as robust and complete as possible.

<p>When adding a new verb, it is important to be sure that you are doing a good thing. Adding a new verb simply to facilitate a guess-the-word type puzzle is definitely a bad thing. On the other hand, having an obvious verb missing is almost as annoying for the player as being made to guess an obscure one. Also consider that adding a new verb doesn't always mean adding a new function. You may find that a required verb is simply a synonym for an existing verb. In this case, simply add a new <b>grammar</b> statement with the synonym and point it to an existing function. In the library file you will find many functions that are mapped to from more than one <b>grammar</b> statement. For example, here is the start of the global function <b>+insert</b> and its matching <b>grammar</b> statements:

<pre>
grammar insert *held on *present      >insert_on
grammar put *held on *present         >insert_on

{+insert_on 
if +reach&lt;noun2 = true
return true
endif
...
</pre>

<p>Another possibility is to define "put" as an actual <b>synonym</b> of "insert". There are potential dangers with this method that are described in the section on <a href="#definitions6">Synonyms</a>.

<P>Now for a few general rules. Each verb that involves touching an object should check that the object does not have the attribute <B>OUT_OF_REACH</B> before allowing the player to manipulate it. This, of course, does not apply to verbs that can only be performed on objects that are being held. The following line of code is an example from the top of the <B>+take</B> function:

<pre>
{+take
...
if +reach&lt;noun1 = true
   return true
endif
...
}
</pre>

<P>These above lines tell the JACL interpreter to return <b>true</B> if the function <B>+reach</B> returns <b>true</b>. In practice, this means that if the object is unreachable by the player, nothing beyond this line will be executed. Below is the content of the <B>+reach</B> function from <B>verbs.library</B>:

<pre>
{+reach
if arg[0] has OUT_OF_REACH
   write  arg[0]{The} " " arg[0]{is} " out of reach.^"
   set time = false
   return true
endif
return false
}
</pre>

<p>This function simply tests if the specified object has the attribute <b>OUT_OF_REACH</b>. If so, an appropriate message is displayed, the variable <b>time</b> is set to <b>false</b> and the function returns <b>true</b>. If the object does not have the attribute <b>OUT_OF_REACH</b>, the function will return <b>false</b>.

<p>Most verbs will also make a similar call to the function <b>+darkness</b>. This function tests whether the player is currently in darkness or not. Actions that require the player to see should have the lines:

<pre>
if +darkness = true
   return true
endif
</pre>

<p>Finally, all verbs should contain a code block that calls the function <b>+important</b>. This function tests whether the passed object has the attribute <b>NOT_IMPORTANT</b> and displays a suitable <b>You don't have to worry about that.</b> type message. If the verb you are adding refers to two objects, you may need to call this function twice, one for each object. If one of the objects in the command needs to be an object that is <b>*held</b>, you will only need to call <b>+important</b> for the other object, as objects with the attribute <b>NOT_IMPORTANT</b> can't be taken due to the <b>take</b> verb stopping when it reaches this same test. Below is an example of a call to <b>+important</b>:

<pre>
if +important&lt;noun1 = true
   return true
endif
</pre>

<P>If your verb causes the object to be moved, such as the <B>take</B> verb, you must also ensure that the object is given the attribute <B>TOUCHED</B> if the move was successful. This will ensure that any tests as to whether the object has been moved from its initial position or not will be accurate. This time an example from the end of the <b>+take</b> function:

<pre>
...
override
write "You take " noun1{the} .^
move noun1 to player
ensure noun1 has TOUCHED
}
</pre>

<P>If the verb performs any tests to check whether the move should be successfully completed under the current circumstances or not, an <B>override</B> command should be added directly before any effects are coded, such as in the example above. This allows <B>override</B> functions to be associated with objects in order to change the default outcome while still taking advantage of the tests you have coded. Below is an example of the types of tests that the default action for a verb should perform. Of course, the exacts tests you will require are specific to the nature of the verb you are coding.

<pre>
grammar ask *present for *carried             >ask_for

{+ask_for
if here has UNDER_WATER
   write "Talking under water isn't very easy.^"
   set TIME = false
   return     
endif 
if noun1 hasnt ANIMATE
   write noun1{The} " seem" noun1{s} " to be ignoring "
   write "your request.^"
   return     
endif 
if noun1 has DEAD
   write noun1{The} " " noun1{is} " a bit too dead to "
   write "respond.^"
   set TIME = false
   return     
endif 
if noun1 = player
   write "I think it might be time to take a break and "
   write "get a cup of tea.^"
   set TIME = false
   return     
endif
</pre>

<P>As you will have seen above, it is also important that the variable <B>TIME</B> is set to <B>false</B> if the move typed by the player could not be performed. Setting <b>TIME</b> to <b>false</b> tells the interpreter that the <B>eachturn</B> functions should not be executed. In other words, if the player's move is not possible, time should not pass.

<P>One last thing to keep in mind when adding <B>grammar</B> statements is whether its scope indicators are going to clash with any other existing <B>grammar</B> statements. For example, consider the following two lines:


<pre>
grammar give *present grief &gt;hassle

grammar give *held to *present &gt;give_to
</pre>

<P>The vocabulary for each game is stored as a tree. The following tree is a representation of the two <B>grammar</B> statements above. 

<p>
<center>
    <img align="center" src="grammar.png" alt="A tree representing the two grammar statements above">
</center>

<p>Given the two <b>grammar</b> statements above, the command

<pre>
give sword to troll
</pre>

<P>would produce the message 

<pre>
You can't use the word &quot;to&quot; in that context.
</pre>

<P>This is because <B>sword</B> is a match for <B>*present</B>, therefore causing the parser to branch down a path that only allows to word <B>grief</B> to be used next. This is obviously not the desired effect. Using <b>$text</b> in a <b>grammar</b> statement is equally dangerous. As an extreme example, using <b>$text</b> as the first word of the first <b>grammar</b> statement will prevent any others from ever matching. It is therefore important to bare in mind that <b>grammar</b> statements are tested in the order they appear in the game file, starting from the top. To have a <b>grammar</b> statement checked last, add it to your game file after the line including <b>verbs.library</b>.



<h1><a class="title" name="pointers0">Pointers</a></h1>

<P>Wherever an object or a location label can be used, so too can a number of special purpose pointers. When a command referring to a pointer is processed, the pointer will be substituted with the label of the item that it currently points to. This avoids the repetition of code and the associated problems of code-bloat and inconsistency. Below is a function demonstrating the use of pointers:

<pre>
{+where_is
loop noun3
   if noun3 hasnt LOCATION
      noun4 = noun3(parent)
      write noun3{The} 
      write " is in " noun4{the} ^
   endif
endloop
}
</pre>

<p>The above function loops through all the objects defined in the game and displays their current whereabouts. The <b>loop</b> command sets the object pointer <b>noun3</b> to each of the objects in turn, while the pointer <b>noun4</b> is manually set to each object's parent. 

<table class="infowarn"><TR>
<td><img src="info.png" alt="Information"></td>
<td>Internally, an object pointer is nothing more than an integer variable, and any integer variable, constant or element can be set to an object's label and then used anywhere an object is expected.</td>
</tr></table>

<p>The two tables below detail each of the internal object and location pointers:

<h2><a class="section" name="pointers1">Object Pointers</a></h2>

<table cellpadding=3 width=100%><tr>
<th width=20%>Pointer</th>
<th>Description</th>
</tr><tr>
<td><B>player</TD>
<td>This pointer is set to the object that currently represents the player in the game.</td>
</tr><tr>
<td><b>noun1</b></td>
<td>This pointer is set to the first object referred to in the player's last move.</td>
</tr><tr>
<td><b>noun2</b></td>
<td>This pointer is set to the second object referred to in the player's last move.</td>
</tr><tr>
<td><b>self</b> or <b>this</b></td>
<td>This pointer is set to the object that the currently executing function is associated with.</td>
</tr></table>

<h2><a class="section" name="pointers2">Location Pointers</a></h2>

<table cellpadding=3 width=100%><tr>
<th width=20%>Pointer</th>
<th>Description</th>
</tr><tr>
<td><b>here</b></td>
<td>This pointer represents the location that the player is currently in. It is synonymous to the element <B>player(parent)</b>.</td>
</tr><tr>
<td><b>destination</b></td>
<td>This represents the location that the player is attempting to move into. The value of <B>destination</B> can be tested in the <B>+movement</B> function before the move is completed. Once the move is complete, <B>destination</B> will equal <B>here</B> until the next move is attempted. This is a read-only pointer and therefore cannot be used as the <I>container</I> parameter of a <B>set</B> command.</td>
</tr><tr>
<td><b>self</b> or <b>this</b></td>
<td>This pointer is set to the location that the currently executing function is associated with.</td>
</tr></table>

<table class="infowarn"><TR>
<td><img src="warning.png" alt="Warning"></td>
<td>Be sure your code never makes use of a pointer in place of an object or location while it does not point to a valid object or location. A pointer is not pointing to a valid object or location if it is set to a number less than one or greater than the number of objects and locations in the game.</td>
</tr></table>



<h1><a class="title" name="resolution0">Object Resolution</a></h1>

<p>A large part of playing interactive fiction involves referring to the objects and locations that make up the game's world. The information in this chapter will assist you in coding your game in such a way that the JACL parser will select the object the player intended as often as possible. All references to objects made by the player are parsed for the following possible structure:

<pre>
objects [from other objects] [except objects [from other objects]]
</pre>

<p>The JACL parser will build two lists of objects for any reference made by the player. The first will contain all the objects for inclusion while the second will contain all the objects referred to after the word <b>except</b> for exclusion. Once the two lists have been built, the second list will be subtracted from the first list. Both lists can make multiple use of the word <b>from</b> to refer to objects, however, the word <b>except</b> can not appear more than once.

<h2><a class="section" name="resolution1">Object Naming</a></h2>

<p>When the player refers to an object during the course of the game they may use as many or as few of the object's names as are required to uniquely identify it. For example, consider the following three objects:

<pre>
object ball_1: ball
object ball_2: small red ball
object ball_3: big red ball
</pre>

<P>Presuming all these objects were in the current location, if the player referred to <B>ball</B>, then <B>ball_1</B> would be selected. This is because the JACL interpreter divides the number of names an object has by the number of names supplied to come up with a best match. Although all three objects have the name <b>ball</b>, <B>ball_1 </B>matches 100% while <B>ball_2 </B>and <B>ball_3 </B>only match 33%. If the player referred to <B>red ball</B>, then <B>ball_1</B> would automatically be excluded, as it does not have the name red. On the other hand, both <B>ball_2 </B>and <B>ball_3 </B>have the names red ball, and both would match 66%. In this case, a message would be displayed stating that the reference was ambiguous. If the player referred to <B>big</B>, then <B>ball_3 </B>would automatically be selected as neither of the other two objects have the name <b>big</b> at all.

<P>It is important to be aware of the number of names that you give each object, and how they relate to each other. It is generally best to have two similar objects have the same number of names, although in some cases you may wish to nominate one to be the default by giving it less names.

<P>For example, in <B>The Unholy Grail</B> there are two objects: <B>beige agar </B>and <B>brown agar</B>. To avoid problems when looking up agar in the encyclopedia, a third object named simply agar was added. This object stays permanently in <B>limbo</B> and therefore does not affect any physical manipulation of the two real agar objects. It does, however, get selected when using commands such as <B>ask_about</B> that accept objects that are <B>*anywhere</B>.

<p>It also possible to define plural names for an object. When the player uses a plural name all the objects that have that plural name will be selected. For example, the above objects could all be given the plural name <b>balls</b> using the following code:

<pre>
object ball_1: ball
   plural		balls
object ball_2: small red ball
   plural		balls
object ball_3: big red ball
   plural		balls
</pre>

<p>If during the game the player was to type the command <b>take balls</b>, all of the above objects would be selected and three separate take commands would be issued. It is the use of the plural name that tells the parser that a reference to multiple objects was intended and that the reference is not ambiguous. It is also possible to further qualify a reference to a plural name by using one or more regular name. For example, the command <b>take red balls</b> would result in only the small red ball and the large red ball being taken.

<h2><a class="section" name="resolution1">Disambiguation</a></h2>

<p>It is also possible for each object to have the associated function <b>disambiguate</b> to assist in the process of disambiguation. The parser will attempt to call this function on every object that is a possible result for an ambiguous reference that needs to be resolved to a single object. 

<p>When called, this function will be passed a single argument being the context in which the ambiguous reference was made. The possible values for this argument are:

<table width=100%>
<tr><th width=20%>Value</th><th width=80%>Description</th></tr>
<tr><td>0</td><td>The list of objects for <b>noun1</b>.</td></tr>
<tr><td>1</td><td>The list of objects for <b>noun2</b>.</td></tr>
<tr><td>2</td><td>Exceptions to the list of objects for <b>noun1</b>.</td></tr>
<tr><td>3</td><td>Exceptions to the list of objects for <b>noun2</b>.</td></tr>
<tr><td>4</td><td>The list of objects <b>noun1</b> should be from.</td></tr>
<tr><td>5</td><td>The list of objects <b>noun2</b> should be from.</td></tr>
<tr><td>6</td><td>The list of objects <b>noun1</b>'s exceptions should be from.</td></tr>
<tr><td>7</td><td>The list of objects <b>noun2</b>'s exceptions should be from.</td></tr>
</table>

<p>To demonstrate, consider a game that had two objects, a red ball and a red book. The following <b>disambiguate</b> function could be added to the book in order to allow the commands <b>read red</b> and <b>look in red</b> to prefer the book to the ball instead of displaying the usual &quot;ambiguous reference&quot; message:

<pre>
object red_book : red book

{disambiguate
if arg = 0
   ifstring command = "read"
      return true
   endif
   ifstringall command[0] = "look" : command[1] = "in"
      return true
   endif
endif
return false
}
</pre>

<p>This function makes use of the <b>command</b> array to look at the words used so far in the player's command. Unfortunately as the command has not been fully processed the single resultant action is not yet known. This function communicates its decision to the parser via its return code. If this function returns <b>false</b> (or doesn't exist), the object will be included in the list of possible objects and processing will continue as normal. If this function returns <b>true</b> this object will be instantly selected as the object the player was referring to. If this function returns <b>-1</b> this object will be excluded from contention and processing will continue as normal. If all objects exclude themselves from contention the first will be selected.

<p>It is important to keep in mind that this function is only called when an ambiguous reference is made. The command <b>read ball</b> will still attempt to read the ball, it is only a command like <b>read red</b> that results in an ambiguous reference that will cause these functions to be called. It is also advisable to use this facility sparingly as it departs from the regular disambiguation rules and may lead to confusion for the player. Used appropriately, however, it can help to solve a frustrating disambiguation problem that has been identified during play testing.



<h1><a class="title" name="definitions0">Definitions in Detail</a></h1>

<P>A JACL game file consists of two fundamental components: code and data. This chapter focuses on the data and provides a detailed break down of all the possible elements that may be defined. In the case of objects and locations, all their associated properties are also listed.

<h2><a class="section" name="definitions1">Objects</a></h2>

<pre>
<b>object</B> <I>Label </I> <B>:</B> [<I>Name1 Name2 Name3</I>...]
  <b>plural</b>     <i>Name1</i> [<I>Name2 Name3 Name4</I>...]
  <B>has</B>        <I>Attribute1</I> [<I>Attribute2 Attribute3</I>...]
  <B>short</B>      <I>IndefiniteArticle ShortDescription</I>
  <B>definite</B>   <I>DefiniteArticle</I>
  <B>long</B>       <I>LongDescription</I> / <b>function</b>
  <B>parent</B>     <I>ItemLabel</I>
  <B>mass</B>       <I>Integer </I>/ <B>heavy </B>/ <B>scenery</b>
  <b>capacity</B>   <I>Integer</I>
  <b>player</b>
  <b>static</b>
</pre>

<P>Each object definition begins with the keyword <B>object</B> followed by the object's label. This label is a unique name by which the object will be referred to by any code within the program. The object's label is then followed by a space-delimited list of names. You may specify as many names as you can fit into a single line of JACL code, and if you do not specify any names, the object's label will be set as its one and only name. These are the names the player will use to refer to this object during the course of the game. For more information on object names, see the chapter on <a href="resolution.html">Object Resolution</a>.

<P>Following this header are any properties you wish to specify that pertain to the object that you are currently defining. Below is a description of all the possible object properties: 

<p>A <b>plural</b> keyword must be followed by a space-delimited list of one or more names that the player can use to refer to this object and others like it as a group. 

<table class="infowarn"><tr>
<td><img src="warning.png" alt="Warning"></td>
<td>Be sure not to confuse this keyword with the attribute <b>PLURAL</b>. The attribute <b>PLURAL</b> is given to any object that, by itself, is considered to be plural. An example of this would be an object that represents a bunch of flowers. Objects that have <b>plural</b> names, on the other hand, may be singular objects, like a coin. If a coin is also given the name <b>coins</b> using the <b>plural</b> keyword, it can then be referred to as a group along with other objects that also have the plural name <b>coins</b>.</td>
</tr></table>

<p>If, for example, a game has two coins defined, a silver coin and a gold coin, and the player types <b>take coin</b>, the parser will ask the player which coin they are referring to. If each of the coins was given the plural name <b>coins</b>, and the player typed <b>take coins</b>, the parser would issue the take command for both coins. In a situation where there is more than one gold coin and more than one silver coin, this plural name can also be qualified by one of the object's other names. This is done with a command like <b>take gold coins</b>. This will cause the parser to issue the take command for all the objects present that have the plural name <b>coins</b> and also have the regular name <b>gold</b>. If the player had typed <b>take gold</b>, the parser would have asked the player which gold coin they were referring to, as without a plural name being used it assumes the intent was to refer to a single object.

<P>A <B>has</B> keyword must be followed by a space-delimited list of attributes that the object is to have when the game begins. For more information, see the chapter on <a href="attributes.html">Attributes</a>. If this property is omitted the object will start with no attributes.

<P>A <B>short</B> property must be followed by two parameters: the object's indefinite article and short description. The <I>ShortDescription</I> text, prefixed by the specified <I>IndefiniteArticle</I>, is displayed using the object's <B>{list}</B> macro in conjunction with a <B>write</B> command. When using the object's <B>{the}</B> macro, the <I>ShortDescription</I> text will normally be displayed prefixed with the word <B>the</B> or the specified definite article. If the word <B>name</B> is specified as the <I>IndefiniteArticle</I>, the <I>ShortDescription</I> text is not prefixed with anything, such as in the case of a proper noun. This applies to both the <B>{list}</B> and <B>{the}</B> macros. If the <I>ShortDescription</I> text is plural, the object should be given the attribute <B>PLURAL</B> to ensure that it is referred to appropriately by code in the library. If the <b>short</b> property is omitted, the <i>IndefiniteArticle</i> will be set to <B>the</B> and the <i>ShortDescription</i> will be set to the object's label. 
<p>A <b>definite</b> property is used to override the default of <b>the</b> that is output when using the object's <b>{the}</b> macro. This is only of use when writing games in languages other than English that have gender for inanimate objects.

<P>A <B>long</B> property is followed by the text to be displayed when the object is in the current location and the player types a <B>look</B> command. If this property is omitted, the object's label is used.

<table class="infowarn">
<TR><td><img src="info.png" alt="Information"></TD>
<td>If the text following a <B>long</B> property is the word <b>function</b>, the function <b>long</b> that is associated with this object will be executed whenever the long description text should be displayed. This provides the ability to have lengthy or dynamic descriptions.</td>
</tr></table>

<P>A <B>parent</B> property must be followed by either a location label (indicating that the object begins the game in that location), or an object label (indicating that the object begins the game within, on top of or being carried by that object). If the object's parent is set to <B>here,</B> or the <B>parent</B> keyword is omitted altogether, then the object will start in the nearest location defined above it in the game file.

<P>A <B>mass</B> property indicates the physical bulk of the object. It must be followed by an integer, the word <B>heavy</B> or the word <B>scenery</B>. An integer indicates exactly how much the object encumbers the player or fills a container (see the <B>capacity</B> property below for further information). The word <B>scenery</B> indicates that the object is immovable and that the interpreter should not display its long description after the location description. For this reason, no <B>long</B> property is required for object with a mass of <B>scenery</B>. The word <B>heavy</B> indicates that the object is immovable, but should have the text following its <B>long</B> description printed after the <B>look</B> function that is associated with its parent location is executed. If this property is omitted, the <B>mass</B> for the object is set to <B>scenery</B>.

<table class="infowarn"><tr>
<td><img src="info.png" alt="Information"></td>
<td>Behind the scenes, a <B>mass</B> of <B>heavy</B> translates to 99 and a <B>mass</B> of <B>scenery</B> translates to 100. It is important to keep this in mind if you change the <B>capacity</B> property for the player or create any containers.</td>
</tr></table>

<P>A <B>capacity</B> keyword must be followed by an integer, indicating the number of <B>mass</B> units an object with the attribute <B>CONTAINER</B>, <B>SURFACE</B> or <B>ANIMATE</B> can hold. If this property is omitted, the object will have a <b>capacity</b> of zero.

<table class="infowarn"><tr>
<td><img src="warning.png" alt="Warning"></td>
<td>Due to this property's default, any object that has the attribute <B>CONTAINER</B>, <B>SURFACE</B> or <B>ANIMATE</B> must also have a <B>capacity</B> property that is set to a suitably large value in order to allow an object to accept other objects. The exception to this rule is if the object being given or inserted has a <B>mass</B> of 0, but this value should only be used for insignificantly small objects.</td>
</tr></table>

<table class="infowarn"><tr>
<td><img src="info.png" alt="Information"></td>
<td>In the file <B>frame.jacl</B> there is an object with the label <B>kryten</B> that is set up to represent the player. This item has a <B>capacity</B> of 42. If left unchanged, the player can not simultaneously carry objects whose <B>mass</B> properties total more than 42. This figure of 42 should be used as a guide when setting the <b>capacity</b> property of other characters, containers or surfaces and the <b>mass</b> of takeable objects.</td>
</tr></table>

<P>A <B>player</B> property has no parameters and indicates that this object is to represent the player in the game. Behind the scenes this sets the object pointer <b>player</b> to point to this object. The value of this pointer can be changed during the course of the game if required.

<p>The properties <b>bearing</b>, <b>velocity</b>, <b>x</b> and <b>y</b> are used by the special-purpose commands <b>position</b>, <b>bearing</b> and <b>distance</b>. See the chapter on <a href="#special">Special-Purpose Commands</a> for more information.

<P>The properties <B>next</B>, <B>previous</B>, <b>child</b>, <B>index</B>, <B>status</B>, <B>state</B>, <B>counter</B>, <B>points</B> and <b>class</b> have no pre-determined meaning for objects. You are free to set and test these values as required.

<P>When a command requires a numerical value as a parameter, the following object elements can be referred to:

<CENTER>
<table cellpadding=8><tr>
<td colspan=4><hr></td>
</tr><tr>
<td><I>object_label</I><B>(parent)</B></TD><td>0</td>
<td><I>object_label</I><B>(index)</B></TD><td>8</td>
</TR><TR>
<td><I>object_label</I><B>(capacity)</B></TD><td>1</td>
<td><I>object_label</I><B>(status)</B></TD><td>9</td>
</TR><TR>
<td><I>object_label</I><B>(mass)</B></TD><td>2</td>
<td><I>object_label</I><B>(state)</B></TD><td>10</td>
</TR><TR>
<td><I>object_label</I><B>(bearing)</B></TD><td>3</td>
<td><I>object_label</I><B>(counter)</B></TD><td>11</td>
</TR><TR>
<td><I>object_label</I><B>(velocity)</B></TD><td>4</td>
<td><I>object_label</I><B>(points)</B></TD><td>12</td>
</TR><TR>
<td><I>object_label</I><B>(next)</B></TD><td>5</td>
<td><I>object_label</I><B>(class)</B></TD><td>13</td>
</tr><TR>
<td><I>object_label</I><B>(previous)</B></TD><td>6</td>
<td><I>object_label</I><B>(x)</B></TD><td>14</td>
</tr><tr>
<td><I>object_label</I><B>(child)</B></TD><td>7</td>
<td><I>object_label</I><B>(y)</B></TD><td>15</td>
</tr><tr>
<td colspan=4><hr></td>
</tr>
</table>
</center>

<p> These elements can be referred to by name or index number. For example, the following two commands are equivalent:

<pre>
     set noun4(parent) = chest
     set noun4(10) = chest

     # ...and to iterate through all properties
     set INDEX = 0
     repeat
       write "PROPERTY " INDEX ": " noun4(INDEX)
       set INDEX + 1
     until INDEX = 16
</pre>

<p>If an object element is to be given a game-specific use, it is often wise to define a constant that describes its use. For example:

<pre>
     constant fuel_left	11     # 11 is the index of 'counter'

     {+accelerate
        set space_ship(fuel_left) - 1
        ...
     }
</pre>

<p>These constants can also be used to set the initial state of an object's properties. For example:

<pre>
     constant fuel_left	11     # 11 is the index of 'counter'

     object space_ship : space ship
       fuel_left    20
</pre>

<p>This code will set the element <b>space_ship(11)</b> to equal 20.

<h2><a class="section" name="definitions2">Locations</a></h2>

<pre>
<B>location</B> <I>Label </I><B>:</B> [<I>Name1 Name2 Name3...</I>]
  <B>has</B>           <I>Attribute1</i> [<i>Attribute2 Attribute3</I>...]
  <B>short</B>         <I>IndefiniteArticle ShortDescription</I>
  <B>definite</B>      <I>DefiniteArticle</I>
  <B>north</B>         <I>LocationLabel </I>/ <B>nowhere</b>
  <b>northeast</B>     <I>LocationLabel </I>/ <B>nowhere</b>
  <b>east</B>          <I>LocationLabel </I>/ <B>nowhere</b>
  <b>southeast</B>     <I>LocationLabel </I>/ <B>nowhere</b>
  <b>south</B>         <I>LocationLabel </I>/ <B>nowhere</b>
  <b>southwest</B>     <I>LocationLabel </I>/ <B>nowhere</b>
  <b>west</B>          <I>LocationLabel </I>/ <B>nowhere</b>
  <b>northwest</B>     <I>LocationLabel </I>/ <B>nowhere</b>
  <b>up</B>            <I>LocationLabel </I>/ <B>nowhere</b>
  <b>down</B>          <I>LocationLabel </I>/ <B>nowhere</b>
  <b>in</B>            <I>LocationLabel </I>/ <B>nowhere</b>
  <b>out</B>           <I>LocationLabel </I>/ <B>nowhere</B>
  <b>static</b> 
</pre>

<P>Each location definition begins with the keyword <B>location</B>  followed by the location's label. This label is a unique name by which the location will be referred to by any code within the game file. The location's label is then followed by the location's space-delimited list of names. You may specify as many names as you can fit into a single line of JACL code, and if you do not specify any, the location's label will be set as its one and only name. These are the names the player will use to refer to this location during the course of the game. For more information, see the chapter on <a href="resolution.html">Object Resolution</a>.

<P>Following this header are any properties you wish to specify that pertain to the location you are currently defining. Below is a description of all the possible location properties: 

<P>A<B> has</B> keyword must be followed by a space-delimited list of attributes that the location is to have when the game begins. For more information, see the chapter on <a href="attributes.html">Attributes</a>. If this property is omitted, the only attribute the location will have when the game is started is <B>LOCATION</B>.

<table class="infowarn"><tr>
<td><img src="info.png" alt="Information"></td>
<td>Internally, objects and locations are both stored using the same data-structure. In fact, once the game is running, the only difference between the two is that a location has the attribute <B>LOCATION</B>.</td>
</tr></table>

<P>A <B>short</B> property must be followed by two parameters: the location's indefinite article and short description. The <I>ShortDescription</I> text, prefixed by the specified <I>IndefiniteArticle</I>, is displayed using the location's <B>{list}</B> macro in conjunction with a <B>write</B> command. When using the location's <B>{the}</B> macro, the <I>ShortDescription</I> text will normally be displayed prefixed with the word <B>the</B> or the specified definite article. If the word <B>name</B> is specified as the <I>IndefiniteArticle</I>, the <I>ShortDescription</I> text is not prefixed with anything, such as in the case of a proper noun. This applies to both the <B>{list}</B> and <B>{the}</B> macros. If the <I>ShortDescription</I> text is plural, the location should be given the attribute <B>PLURAL</B> to ensure the it is referred to appropriately by code in the library. If the <b>short</b> property is omitted, the <i>IndefiniteArticle</i> will be set to <B>the</B> and the <i>ShortDescription</i> will be set to the location's label. 

<P>The directions the player can travel in from this location are defined by the properties <B>north</B>, <B>northeast</B>, <B>northwest</B>, <B>south</B>, <B>southeast</B>, <B>southwest</B>, <B>east</B>, <B>west</B>, <B>up</B>, <B>down</B>, <B>in</B> and <B>out</B>. 

A direction property must be followed by the label of the location that the direction leads to when the game is started. The links between locations may be modified during the course of the game to reflect doors opening etc. The constant <B>nowhere</B> (0), may be used in place of a location label to indicate that the player may not move in that direction. If a direction is not listed, <B>nowhere</B> is the default.

<P>Following each completed location definition should be an associated function called <B>look</B>. This function will be executed every time the description for the location is due to be displayed.

<P>The properties <B>points</B> and <b>class</b> have no pre-determined meaning for locations. You are free to set and test these values as required.

<!-- NEW PAGE -->
<P>When a command requires a numerical value as a parameter, the following location elements can be referred to:

<P><CENTER><table cellpadding=8><tr>
<td colspan=4><hr></td>
</tr><tr>
<td><I>location_label</I><B>(north)</B></TD><td>0</td>
<td><I>location_label</I><B>(up)</B></TD><td>8</td>
</tr><tr>
<td><I>location_label</I><B>(south)</B></TD><td>1</td>
<td><I>location_label</I><B>(down)</B></TD><td>9</td>
</tr><tr>
<td><I>location_label</I><B>(east)</B></TD><td>2</td>
<td><I>location_label</I><B>(in)</B></TD><td>10</td>
</tr><tr>
<td><I>location_label</I><B>(west)</B></TD><td>3</td>
<td><I>location_label</I><B>(out)</B></TD><td>11</td>
</tr><tr>
<td><I>location_label</I><B>(northeast)</B></TD><td>4</td>
<td><I>location_label</I><B>(points)</B></TD><td>12</td>
</tr><tr>
<td><I>location_label</I><B>(northwest)</B></TD><td>5</td>
<td><I>location_label</I><B>(class)</B></TD><td>13</td>
</tr><tr>
<td><I>location_label</I><B>(southeast)</B></TD><td>6</td>
<td><I>location_label</I><B>(x)</B></TD><td>14</td>
</tr><tr>
<td><I>location_label</I><B>(southwest)</B></TD><td>7</td>
<td><I>location_label</I><B>(y)</B></TD><td>15</td>
</tr><tr>
<td colspan=4><hr></td>
</tr></table>
</center>

<p> These elements can be referred to by name or number. For example, the following two commands are equivalent:

<pre>
set noun4(west) = beach
set noun4(3) = beach

# ...or iterating across all directions to trap 
# the player in the current location
set INDEX = 0
repeat
  set here(INDEX) = nowhere
  set INDEX + 1
until INDEX = 12
</pre>

<h2><a class="section" name="definitions3">Integer Variables</a></h2>

<P>Integer variables are defined using the keyword <B>integer</B> followed by the name of the variable. The starting value for the variable can be set by following the name of the variable with an integer or a previously defined constant. If no value is specified on definition, the variable is initialised with a value of zero.

<P>The following are some examples of variable definitions:

<pre>
constant DEFAULT_POWER     42

integer AIR_LEFT          100
integer LAGERS_DRUNK      ; Set to zero by default 
integer AIRLOCK_SEALED    true
integer MOTOR_POWER       DEFAULT_POWER 
</pre>

<table class="infowarn"><tr>
<td><img src="warning.png" alt="Warning"></td>
<td>Like all other data definitions, variables can not be defined within the body of a function.</td>
</tr></table>

<h2><a class="section" name="definitions4">Internal Integer Variables</a></h2>

<P>The following is a list of integer variables defined internally by the JACL interpreter.

<P>
<center>
<table cellpadding=3 width=90%><tr>
<th>Variable</th>
<th>Description</th>
</tr><tr>
<td><B>compass</B></TD>
<td>This variable is used to store the direction the player moved in when they travel between locations. This variable may be tested in either of the <B>movement</B> functions allowing you to prevent the move from occurring or displaying some special text as required. The direction travelled is encoded as an integer that can be compared to a set of constants. See the section on <a href="#movement3">Moving Non-player Characters</a> for details.</TD>
</TR>
<TR><td>
<B>total_moves</B></TD>
<td>This variable records the number of successful moves entered by the player so far. This variable starts at 0 and is incremented each time a valid command is entered by the player. This is indicated by the value of the variable <B>TIME</B> (see below).</TD>
</TR>
<TR><td>
<B>score</B></TD>
<td>This variable indicates how many points the player has scored during the course of the game.
</TR>
<TR><td>
<B>display_mode</B></TD>
<td>
<P>This variable indicates whether the interpreter is in <B>verbose</B> or <B>brief</B> mode, with a value of 1 being <B>verbose</B> and 0 being <B>brief</B>. The starting value is 0. In brief mode, each location is given the attribute <b>VISITED</b> when the player enters it, this is not the case when in verbose mode.</TD>
</TR>
<TR><td>
<B>internal_version</B></TD>
<td>This variable is set to the major version number of the JACL interpreter that you are using. This can be tested for in the <B>+intro</B> function to ensure compatibility between your game and the version of the interpreter being used to play it.</TD>
</TR>
<TR><td>
<B>time</B></TD>
<td>This variable is set to <B>true</B> when the player makes a move. If at no time during the processing of that move it is set to <B>false</B>, two things will happen. Firstly, the variable <B>TOTAL_MOVES</B> will be incremented by one. Secondly, the <B>eachturn</B> functions will be executed if they exist.</TD>
</TR>
<TR><td>
<B>max_rand</B></TD>
<td>When the word <B>random</B> is supplied as a parameter to a command expecting an integer value, a random number between one and the current value of <B>max_rand</B> will be generated. The default value is 100.</TD>
</TR>
<tr><td><b>notify</b></td>
<td>When set to <b>true</b> the player will be notified of any increase in their score when the <b>points</b> command is used.</td>
</tr>
</TABLE>
</center>

<!-- NEW PAGE -->

<h2><a class="section" name="definitions5">String Variables</a></h2>

<P>String variables are defined using the keyword <b>string</b> in the same format as an <b>integer</b>. For example:

<pre>
string menu_title	"Options:"
</pre>

<p>Once defined, the value of a string can be output by passing the name of the variable as a parameter to a <b>write</b> statement. Strings have a maximum length of 256 bytes.

<h2><a class="section" name="definitions6">Arrays</a></h2>

<p>It is possible to define more than one <b>integer</b> or <b>string</b> with the same name, thereby creating an array of values. Arrays can also be created by supplying more than one value during a single declaration. For example:

<pre>
integer FIBONACCI 0 1 1 2 3 5 8 13 21 34 55 89 144
integer FIBONACCI 233 377 610 987 1597 2584 4181
</pre>

<p>The above code will create a single array of variables called <b>FIBONACCI</b> that contains 20 values. The number of values held by an array is fixed when the game is first executed and is referenced by using an at symbol (<b>@</b>) followed by the name of the array. Individual elements of an array are accessed by directly following the name of the array with a set of square brackets (<b>[ ]</b>) containing the index of the element. The first element of an array is at index 0. The following code displays the contents of the <b>FIBONACCI</b> array:

<pre>
integer INDEX

{+display_fibonacci
set INDEX = 0

repeat
   write FIBONACCI[INDEX] ^
   set INDEX + 1
until INDEX = @FIBONACCI
}
</pre>

<table class="infowarn"><tr>
<td><img src="warning.png" alt="Warning"></td>
<td>In the above code, <b>@FIBONACCI</b> returns the number of elements in the array, which is one greater than the index of the last element. Take care when using this value to iterate over an array not to access the element <b>ARRAY[@ARRAY]</b>.</td>
</tr></table>

<p>This same technique can be applied to other data types such as strings. For example, consider the following code from <b>verbs.library</b>:

<pre>
string LCNumber zero one two three four five six seven eight nine ten
string UCNumber Zero One Two Three Four Five Six Seven Eight Nine Ten

{+number_upper
if arg[0] &lt; 0 : arg[0] &gt; 10
   write arg[0]
else
   write UCNumber[arg[0]]
endif
}

{+number_lower
if arg[0] &lt; 0 : arg[0] &gt; 10
   write arg[0]
else
   write LCNumber[arg[0]]
endif
}
</pre>

<p>As it is possible to change the value of an <b>integer</b> and a <b>string</b> after they have been created, there is also a shortcut for creating arrays of variables with all elements being loaded with a default value. This is done by using the keywords <b>integer_array</b> or <b>string_array</b> followed by the name of the variable and the number of elements to create. For example, the following line of code will create an array of 10 integer variables called <b>OPTIONS</b>, all with the value <b>0</b>:

<pre>
integer_array OPTIONS 10
</pre>

<p>It is also possible to specify a custom default value after the size of the array like this:

<pre>
integer_array OPTIONS 10 42
</pre>

<p>This will create ten variable with the name <b>OPTIONS</b> and the value of <b>42</b>.

<h2><a class="section" name="definitions7">Constants</a></h2>

<P>The basic syntax for a <B>constant</B> statement is:

<pre>
<b>constant</b> <i>ConstantName Value</i>
</pre>

<p>It is possible to define integer and string constants, the type being inferred from the value. If you would like to create a string constant that contains only a number, enclose the number in double quotes: Below is an example of creating constants. This example is taken from the beginning of The Unholy Grail and defines one integer and three string constants that contain the bibliographical information required by the Treaty of Babel:

<pre>
constant game_title     "The Unholy Grail"
constant game_author    "Stuart Allen"
constant game_version   2
constant ifid           "JACL-002"
</pre>

<p>Unlike a variable, the initial value of a constant is not an optional parameter. A value must be specified and this value will remain unchanged for the duration of the game.

<table class="infowarn"><tr>
<td><img src="info.png" alt="Information"></td>
<td>Although a variable can be used wherever a constant can be used, if a value is not to change during the game, there are two advantages to using a constant. The first is that the value cannot be changed by accident using a <b>set</b> command. The second is that constants are not saved each time the player makes a move so for this reason they also provide a performance increase over the use of variables.</td>
</tr></table>

<h2><a class="section" name="definitions8">Synonyms</a></h2>

<P>Synonyms are a way of substituting a word in the player's move for another word. They are defined using the keyword <B>synonym</B> followed by the word to be substituted and then the word to be put in its place. Care should be taken when defining synonyms, as duplicate <B>grammar</B> statements are often the better approach. Consider the following examples:

<pre>
synonym get          take
synonym grab         take
</pre>

<P>With the above synonyms defined, the command 'get note' would be translated to 'take note' before being parsed. With the below <B>grammar</B> statements defined, but no synonyms in place, the command "get note" would be parsed as is, but will still be mapped to the <B>take</B> function.

<pre>
grammar take **here   &gt;take
grammar get **here    &gt;take
grammar grab **here   &gt;take
</pre>

<p>The problem with the synonym approach is that if we were then to define the following <B>grammar</B> statement, we would run into trouble:<br>

<pre>
grammar get out &gt;exit
</pre>

<P>With the above <b>synonym</b> defined, the command 'get out' would be translated to 'take out' before being parsed, a sentence that the game would not understand.

<P>There are right and wrong times to use both approaches to broadening your game's vocabulary. Just be sure to take care and consider the potential effects of any synonyms you define.

<h2><a class="section" name="definitions9">Filters</a></h2>

<P>There are a few filters defined in <B>verbs.library</B>, and chances are you will never need to define any of your own. They are defined using the keyword <B>filter</B> followed by the word to be filtered from the player's input before it is parsed.

<P>The following are some examples of filter definitions (taken from <B>verbs.library</B>):

<pre>
filter the
filter quickly
</pre>

<P>With the above filters defined, if the player typed the command:

<pre>
quickly take the coin from the bag
</pre>

<P>the parser would process:

<pre>
take coin from bag
</pre>

<table class="infowarn"><tr>
<td><img src="warning.png" alt="Warning"></td>
<td>Filters should be defined very sparingly. They are a designed to give the illusion of the parser understanding more than it really does. Although at times this can be good, at other times it can be very, very bad.</td>
</tr></table>

<h2><a class="section" name="definitions10">Grammar Statements</a></h2>

<P>The basic syntax for a <B>grammar</B> statement is:

<pre>
<B>grammar</B> <I>MoveSyntax</I> <B>&gt;</B><I>FunctionName</I>
</pre>

<P>The keyword <B>grammar</B> defines a move that may be typed by the player and the function that will be executed when this move is made. The <I>MoveSyntax</I> section defines the syntax of the move and consists of one or more parameters that may either be a word to be typed verbatim or one of several special tokens. The last parameter of a <B>grammar</B> statement is a greater-than symbol directly followed by the core name of the function to be executed if a move of this format is typed by the player.

<p>The table below details the tokens that can be used as part of the <i>MoveSyntax</i>:

<p>
<center>
<table width=90%><tr>
<th>Token</th>
<th>Description</th>
</tr><tr>
<td><B>*here</b></td>
<td>Indicates that an object in the current location must be supplied at this point in the move.</TD>
</tr><tr>
<td><B>**here</b></td>
<td>Indicates that one or more objects in the current location may be supplied at this point in the move.</TD>
</tr><tr>
<td><B>*held</b></td>
<td>Indicates that an object held by the player must be supplied at this point in the move.</TD>
</TR><TR>
<td><B>**held</b></td>
<td>Indicates that one or more objects held by the player must be supplied at this point in the move.</TD>
</TR><TR>
<td><b>*present</b></td>
<td>Indicates that an object either in the current location or held by the player must be specified at this point in the move.</td>
</tr><tr>
<td><b>**present</b></td>
<td>Indicates that one or more objects either in the current location or held by the player must be specified at this point in the move.</td>
</tr><tr>
<td><B>*anywhere</b></td>
<td>Indicates that an object anywhere in the game world must be specified at this point in the move.</td>
</tr><tr>
<td><B>**anywhere</b></td>
<td>Indicates that one or more objects anywhere in the game world must be specified at this point in the move.</td>
</tr><tr>
<td><B>*inside</b></td>
<td>This scope indicator can only be used as the second noun of verbs that have two nouns. It indicates that an object that is a child of the first noun must be specified at this point in the move.</td>
</tr><tr>
<td><B>**inside</b></td>
<td>This scope indicator can only be used as the second noun of verbs that have two nouns. It indicates that multiple objects that are children of the first noun must be specified at this point in the move.</td>
</tr><tr>
<td><B>*location</b></td>
<td>Indicates that a location in the game world must be specified at this point in the move.</td>
</tr><tr>
</tr><tr>
<td><B>$string</b></td>
<td>Indicates that an arbitrary text string must occur at this point in the move. If this text string is to contain spaces, the player must enclose the string in double quotes when typing their command.</td>
</tr><tr>
<td><B>$integer</b></td>
<td>Indicates that an integer must be supplied at this point in the move.</td>
</tr></table>
</center>

<P>For example, the following are some valid <B>grammar</B> statements:

<pre>
grammar take **here                  &gt;take
grammar insert **held in *present    &gt;insert_in
grammar set *held to $integer        &gt;set_to
grammar type $string on *present     &gt;type_on
</pre>

<P>The first statement says that if the player types the word <b>take</b>, followed by one or more objects that are in the current location, then the function <B>take</B> should be executed. The second states that if the player types the word <b>insert</b>, followed by one or more objects that are being held, followed by the word <b>in</b>, followed by an object that is either being held or is in the current location, then the function <B>insert_in</B> should be executed. The third states that if the word <b>set</b> followed by a single object that is being held, followed by the word <b>to</b>, followed by an integer then execute the function <b>set_to</b>. Feel free to add extra <b>grammar</b> statements that map to library functions into your program. Keeping these extra <b>grammar</b> statements within the game-specific part of your code means that you can upgrade the library at a later date without needing to re-enter your additions. The exact way in which these functions are executed is detailed in the section on <a href="#functions3">Responding to Player's Moves</a>.

<p>When using the tokens <b>$integer</b> and <b>$string</b> the values entered by the player will be placed into constants of the same name. If a command contains two or more of the same token an array of constants will be created. For example:

<pre>
grammar send $string to $string    &gt;send_message

{+send_message
write "Sending " $string[0] " to " $string[1] "^."
}
</pre>

<table class="infowarn"><tr>
<td><img src="warning.png" alt="Warning"></td>
<td>When entering a new grammar definition, be sure not to leave a space between the greater-than symbol (<B>&gt;</B>) and the name of the function to be executed.</td>
</tr></table>

<h2><a class="section" name="definitions11">User Attributes</a></h2>

<P>The basic syntax for an <B>attribute</B> statement is:

<pre>
<b>attribute</B> <I>AttributeName</I> [<i>AttributeName AttributeName...</i>]
</pre>

<P>The keyword <B>attribute</B> defines a user attribute that can be used throughout your game for any custom purpose you require. Once a user attribute is defined, it is used in the exact same manner as a system attribute. You can define up to 32 user attributes.

<h2><a class="section" name="definitions12">Parameters</a></h2>

<P>Parameters are a web-based feature and therefore only be used with the <b>cgijacl</b> interpreters. The basic syntax for a <B>parameter</B> statement is:

<pre>
<B>parameter</B> <I>ParameterName</I> [<I>Container</I>] [<I>LowestValue HighestValue</I>]
</pre>

<p>A <b>parameter</b> is a connection between an HTML form parameter and a JACL container or string. When a defined parameter is passed, its value is copied into the specified container or string before the player's move is processed. A group of two integers may also be specified after the container in the parameter definition. These numbers indicate the parameter's range bounds if it the container is for storing integers. The first integer is the lowest possible value for the parameter, the second is its highest. When a parameter is updated, it will automatically be adjusted to fall within the supplied bounds if required. If no low and high range bounds are specified, they are set to -65535 and 65535 respectively.

<p>Below is a complete JACL program demonstrating the use of <b>parameter</b> statement in combination with an HTML form.

<pre>
#!../bin/cgijacl

parameter TEST  kryten(status)          1       4
parameter PASSWORD password

location thehere : here

integer INDEX
string password

{form
write "STATUS: " kryten(status) ^
write "PASSWORD: " password ^
write "&lt;hr&gt;"
write "&lt;form&gt;"
hidden

set INDEX = 1
repeat
   write "&lt;input type=radio name=TEST value=~" INDEX ~
   if INDEX = kryten(status)
      write " checked" endif
   write "&gt;" INDEX
   set INDEX + 1
   write "^"
until INDEX = 5

write "&lt;p&gt;&lt;input type=~password~ name=~PASSWORD~&gt;^"
write "&lt;input type=submit&gt;"

write "&lt;/form&gt;^"
}

object kryten : myself
  player

{+intro
execute here.form
}

grammar blankjacl &gt;form
</pre>

<p>When accessed, this program will look as follows in a web browser:

<center>
<p><img src="forms.png">
</center>

<p>Selecting one of the radio buttons and entering text in the password input field then clicking the submit button will cause the value of <b>kryten(status)</b> and <b>password</b> to be updated before the player's command is processed. As there is no move to process, a <b>blankjacl</b> command is proxied on the players behalf. This command has been mapped to the <b>form</b> function, which re-displays the form.



<h1><a class="title" name="internals0">Internals</h1>

<h2><a class="section" name="internals1">Constants and Random</a></h2>

<P>When using a command that requires you to provide a numerical value, such as <B>if</B> and <B>set</B>, the following values may be used.

<table width=100%><tr>
<th width=20%>Constant</th>
<th>Value</th>
</tr>
<TR><td>
<B>scenery</B></TD>
<td>100</TD>
</TR>
<TR><td>
<B>heavy</B></TD>
<td>99</TD>
</TR>
<TR><td>
<B>true</B></TD>
<td>1</TD>
</TR>
<TR><td><B>false</b>, <b>nowhere</B> or <b>null</b></TD>
<td>0</TD>
</tr><tr>
<td><b>status_width</b></td>
<td>Set to the number of columns the status window is currently displaying.</td>
</tr><tr>
<td><b>status_depth</b></td>
<td>Set to the number of rows the status window is currently displaying.</td>
</tr><tr>
<td><b>objects</b></td>
<td>Set to the number of objects defined in the game.</td>
</tr><tr>
<td><b>interpreter</b></td>
<td>Set to the interpreter type that is currently running the game, either <b>GLK</b> or <b>CGI</b>.</td>
</tr><tr>
<td><b>random</b></td>
<td>Set to a random number between 1 and the current value of the variable <B>max_rand</B>. By default, <B>max_rand</B> is set to 100.</td>
</tr><tr>
<td><b>unixtime</b></td>
<td>Set to the current time, expressed as an integer representing the number of seconds since midnight on the 1st of January 1970.</td>
</tr></table>

<h2><a class="section" name="internals2">Internal Commands</a></h2>

<P>Listed here are the only in-game commands that are internal to the interpreter. All other commands to be interpreted during the course of the game must be defined as a <B>grammar</B> statement in the game code.

<table width=100%>
<TR>
<th width=20%>Command</th>
<th>Description</th>
</TR><TR>
<td valign="top"><B>restart</B></TD>
<td>Will cause the JACL interpreter to ask the user if they are sure, restarting the game from the beginning if they answer <B>yes</B>, returning to the game if they answer <B>no</B>.</TD>
</tr>
<tr><td valign="top"><B>info</B></TD>
<td>Will display the version information of the JACL interpreter that you are running and the maximum number of items it was compiled to handle. This limit may be increased by changing the <B>MAX_OBJECTS</B> define statement in the file <B>jacl.h</B> then re-compiling the interpreter.</TD>
</tr>
<tr><td valign="top"><B>oops</B>&nbsp;[<i>ReplacementWord</i>]</TD>
<td>Replaces the most likely incorrect word in the player's last command with the supplied replacement word.</td>
</tr>
<tr><td valign="top"><B>script</b></TD>
<td>Will cause the current game session to be recorded to the file specified at the ensuing prompt.</TD>
</TR>
<TR><td valign="top"><B>unscript</b></TD>
<td>Stop a previously started transcript.</TD>
</tr>
<tr><td valign="top"><B>again</B></TD>
<td>This command repeats the player's last move.</td>
</tr>
<tr><td valign="top"><B>undo</b></TD>
<td>Will cause the game to revert to the state it was in before the previous command.</TD>
</tr><tr>
<td valign="top"><B>quit</B></TD>
<td>This will cause the JACL interpreter to ask the user if they are sure, closing the interpreter if they answer <B>yes</B>, returning to the game if they answer <B>no</B>.</TD>
</tr></table>



<h1><a class="title" name="menu0">The Menu Library</a></h1>

<p>There are many situations where it is desirable to present the player with a menu of options from which they can select. The <b>menu.library</b> contains a set of functions that assist in the display of menus and this chapter details their use.

<p>There are two fundamental types of menu that can be created using <b>menu.library</b>. The first displays the menu options then returns the player to the normal game prompt. From there, if they type a command that contains only a single integer it is treated as the selection of one of the menu options. The second type of menu directly prompts the player to select an option using the <b>asknumber</b> command and then re-displays the menu options for a further selection. This type of menu can be further customised by setting the variable <b>MENU_MODAL</b> to either <b>true</b> or <b>false</b>. If <b>MENU_MODAL</b> is set to <b>true</b> the menu can only be exited by selecting an explicit option that breaks out of the menu loop. If <b>MENU_MODAL</b> is set to <b>false</b> the menu will exit if the player simply presses enter or types <b>0</b>.

<p>Both types of menus can be configured to work in one of two modes: proxy or execute. In proxy mode, the string attached to a menu option is treated as a command and is issued as if typed by the player when that option is selected. In execute mode, the string attached to a menu option is treated as the name of a function to execute when that option is selected. The mode of the menu is determined by setting the variable <b>MENU_MODE</b> to either <b>MENU_PROXY</b> or <b>MENU_EXECUTE</b> before displaying the menu.

<p>We will start by demonstrating the creation of a menu that uses the normal game prompt for selecting options. Below is an example function that creates a simple three-option menu:

<pre>
{+display_menu
set MENU_MODE = MENU_PROXY
execute &quot;+menu_clear_options&quot;
execute &quot;+menu_add_option&lt;Quietly open the door&lt;open door&quot;
execute &quot;+menu_add_option&lt;Sneak out the front door&lt;out&quot;
execute &quot;+menu_add_option&lt;Pick up the book&lt;take book&quot;
}
</pre>

<p>The first thing this function does is set the variable <b>MENU_MODE</b> to <b>MENU_PROXY</b>. This indicates that the final argument passed to the function <b>+menu_add_option</b> is a command to be proxied on the player's behalf.

<p>The second line calls the function <b>+menu_clear_options</b>. This function simply erases any previous menu options so a new menu can be build from scratch.

<p>The final three lines add options to the menu by calling the function <b>+menu_add_option</b>. This function takes two arguments: the text to be displayed for the menu option and either the in-game command to issue or the function to execute if this option is selected.

<p>When this function is executed it will display:

<pre>
1. Quietly open the door
2. Sneak out the front door
3. Pick up the book

&gt; 
</pre>

<p>Typing <b>1</b>, <b>2</b> or <b>3</b> from the command prompt will cause the appropriate command to be issued. This menu is considered active until it is erased by calling the function <b>+menu_clear_options</b>.

<p>A looping menu is created by calling the function <b>+menu_prompt</b> and passing the name of the function that displays the menu options as an argument. For example, the following command will display the same menu as above, only using the <b>asknumber</b> command to prompt for a selection until the menu is exited:

<pre>
set MENU_MODAL = false
execute "+menu_prompt&lt;+display_menu"
</pre>

<p>Using this approach, the player will not be able to perform any action other than select an option from the menu. The function <b>+menu_prompt</b> calls the function <b>+menu_clear_options</b> before calling the supplied function to build the menu. For this reason the function <b>+menu_clear_options</b> does not need to be called manually before adding options.

<p>With the variable <b>MENU_MODAL</b> set to <b>false</b>, the menu can be exited at any time by simply pressing enter or selecting 0. If the variable <b>MENU_MODAL</b> was to be set to <b>true</b>, only a valid menu option can be selected. If you need to provide a mechanism for the player to exit the menu when <b>MENU_MODAL</b> is set to <b>true</b>, this is done by adding a menu option that sets the variable <b>MENU_IN_LOOP</b> to <b>false</b> when it is selected.

<p>Below is an example of a menu displayed by calling <b>+menu_prompt</b>:

<pre>
&gt; menu

MAIN MENU:

1. About
2. Instructions
3. Restore saved game
4. Save game in progress
5. Exit menu

Type a number between 1 and 5: 
</pre>



<h1><a class="title" name="csv0">CSV Files</a></h1>

<p>A comma-separated values (CSV) file stores tabular data (numbers and text) in plain-text form. Each column in the file is, as the name suggests, separated by commas. JACL supports both the reading and writing of CSV files. By default stores CSV files in a directory named <b>data</b> that in the same location as the program that is accessing them. For example, the demonstration program <b>contacts.jacl</b> lives in the <b>projects</b> directory and stores its data in <b>projects/data</b>.

When referring to a CSV file using any of the commands detailed in this section only a portion of the filename is specified. This supplied name is used to build the full name of the file using the following formula:

<pre>
<i>&lt;DataDirectory&gt;</i><b>/</b><i>&lt;ProgramName&gt;</i><b>-</b><i>&lt;Name&gt;</i><b>.csv</b>
</pre>

<p>For example, the program <b>contacts.jacl</b> stores its contacts in a CSV file called <b>data</b> which translates to the full file:</p>

<pre>
<b>projects/data/contacts-data.csv</b>
</pre>

<p>This system ensures that no two JACL programs can overwrite each others data or access arbitrary files from the filesystem of the webserver.</p>

<h2><a class="section" name="csv1">The ITERATE and ENDITERATE Commands</a></h2>

<P>Any <B>ITERATE</B> command must be of the following format:

<pre>
<B>iterate</B> <I>&lt;FileName&gt;</I> [<b>skip_header</b>]
...
<b>enditerate</b>
</pre>

<P>The <B>iterate</B> and <b>enditerate</b> commands mark a looping block of code. The block of code is run once for each row in the file specified directly after the <b>iterate</b> command. For example, the <b>+intro</b> function of the program <b>contacts.jacl</b> loops through the file <b>data</b> and looks for the last (highest) ID already assigned to a contact. This number is stored so that the next contact created can be given an ID that one higher, and therefore unqiue:

<pre>
# GET THE LAST ID
iterate data
   if field[0] &lt; last_id
      set last_id = field[0]
   endif
enditerate
</pre>

<p>Each column of the currect row being read is loaded into a string array called <b>field</b>. In the case of <b>contacts.jacl</b>, the ID is stored in the first column, or field.</p>

<p>Below is another example of the <b>iterate</b> command, this time it is used to display the entire contents of the file <b>data</b>:

<pre>
iterate data skip_header
  set INDEX = 0
  while INDEX &lt; field_count
    write field[INDEX]
    write ", "
    set INDEX + 1
  endwhile
  write "^"
enditerate
</pre>

<p>There are two points of note with this second example. The first is that the optional flag <b>skip_header</b> has been specified after the file name. This flag tells the <b>iterate</b> command to ignore the first line of the file as it contains column headers, not data. For example, a CSV such as this:</p>

<pre>
ID    First name        Last name
0     Stuart            Allen
1     Fred              Fargnargle
2     Zaphod            Beeblebrox
</pre>

<p>The second is the constant <b>field_count</b>. This constant contains the number of columns read for the current row. JACL supports a maximum of twenty columns for any given row.

<h2><a class="section" name="csv2">The UPDATE, ENDUPDATE and INSERT Commands</a></h2>

<P>Any <B>update</B> command must be of the following format:

<pre>
<B>update</B> <I>&lt;FileName&gt;</I>
...
<b>endupdate</b>
</pre>

<p>Any <b>insert</b> command must be of the following format:

<pre>
<B>insert</B> <I>&lt;Field0&gt;</I> [<I>&lt;Field1&gt;</I>...]
</pre>

<p>The <b>update</b> is used to re-write a CSV and therefore provide the opportunity to edit the contents. 
Below is an example of its use from the <b>+update</b> function of <b>contacts.jacl</b>

<pre>
update data
   if field[0] = $integer
      insert field[0] firstname_data surname_data email_data home_phone_data mobile_phone_data address_data
   else
      insert field[0] field[1] field[2] field[3] field[4] field[5] field[6]
   endif
endupdate
write "Record " $integer " updated.^^"
</pre>

<p>This function uses the <b>update</b> command to modify the details for the contact with the ID (<b>field[0]</b>) that is equal to <b>$integer</b>. This is achieved by looping through each line of the file (using the <b>update</b> command) and then checking if the current line is the line that is to be edited. If so, the new values are written out (using the <b>insert</b> command). If not, the existing values are written back to the file (also using the <b>insert</b> command.)</p>

<p>The <b>update</b> and <b>insert</b> commands are also used to delete a record in <b>contacts.jacl</b>. This is achieved by inserting all the existing rows from within an <b>update</b> loop except the record to be deleted:

<pre>
update data
   if field[0] != $integer
      insert field[0] field[1] field[2] field[3] field[4] field[5] field[6]
   endif
endupdate
write "Record " $integer " deleted.^^"
</pre>

<h2><a class="section" name="csv3">The APPEND Command</a></h2>

<p>Any <b>append</b> command must be of the following format:

<pre>
<B>append</B> <I>&lt;FileName&gt;</I> <I>&lt;Field0&gt;</I> [<I>&lt;Field1&gt;</I>...]
</pre>

<p>The <b>append</b> command is used to write a single extra row to the end of a CSV file. If the CSV file doesn't already exist it will be created and the appended row written to the new file. Below is an example of its use from the <b>+add_record</b> function of <b>contacts.jacl</b>:

<pre>
set last_id + 1
append data last_id firstname_data surname_data email_data home_phone_data mobile_phone_data address_data
write firstname_data " " surname_data " added to database.^^"
</pre>



<h1><a class="title" name="attributessummary0">Appendix A: JACL Attributes</a></h1>

<table width=100%>
<TR><td>
<B><P>BIT</B></TD>
<td>
<B><P>DECIMAL VALUE</B></TD>
<td>
<B><P>OBJECT</B></TD>
<td>
<B><P>LOCATION</B></TD>
</TR>
<TR><td>
<P>1</TD>
<td>
<P>1</TD>
<td>
<P>CLOSED</TD>
<td>
<P>VISITED</TD>
</TR>
<TR><td>
<P>2</TD>
<td>
<P>2</TD>
<td>
<P>LOCKED</TD>
<td>
<P>DARK</TD>
</TR>
<TR><td>
<P>3</TD>
<td>
<P>4</TD>
<td>
<P>DEAD</TD>
<td>
<P>ON_WATER</TD>
</TR>
<TR><td>
<P>4</TD>
<td>
<P>8</TD>
<td>
<P>IGNITABLE</TD>
<td>
<P>UNDER_ WATER</TD>
</TR>
<TR><td>
<P>5</TD>
<td>
<P>16</TD>
<td>
<P>WORN</TD>
<td>
<P>WITHOUT_AIR</TD>
</TR>
<TR><td>
<P>6</TD>
<td>
<P>32</TD>
<td>
<P>CONCEALING</TD>
<td>
<P>OUTDOORS</TD>
</TR>
<TR><td>
<P>7</TD>
<td>
<P>64</TD>
<td>
<P>LUMINOUS</TD>
<td>
<P>MID_AIR</TD>
</TR>
<TR><td>
<P>8</TD>
<td>
<P>128</TD>
<td>
<P>WEARABLE</TD>
<td>
<P>TIGHT_ROPE</TD>
</TR>
<TR><td>
<P>9</TD>
<td>
<P>256</TD>
<td>
<P>CLOSABLE</TD>
<td>
<P>POLLUTED</TD>
</TR>
<TR><td>
<P>10</TD>
<td>
<P>512</TD>
<td>
<P>LOCKABLE</TD>
<td>
<P>SOLVED</TD>
</TR>
<TR><td>
<P>11</TD>
<td>
<P>1024</TD>
<td>
<P>ANIMATE</TD>
<td>
<P>MID_WATER</TD>
</TR>
<TR><td>
<P>12</TD>
<td>
<P>2048</TD>
<td>
<P>LIQUID</TD>
<td><p>DARKNESS</TD>
</TR>
<TR><td>
<P>13</TD>
<td>
<P>4096</TD>
<td>
<P>CONTAINER</TD>
<td><p>MAPPED</TD>
</TR>
<TR><td>
<P>14</TD>
<td>
<P>8192</TD>
<td>
<P>SURFACE</TD>
<td><p>KNOWN</TD>
</TR>
<TR><td>
<P>15</TD>
<td>
<P>16384</TD>
<td>
<P>PLURAL</TD>
<td>&nbsp;</TD>
</TR>
<TR><td>
<P>16</TD>
<td>
<P>32768</TD>
<td>
<P>FLAMMABLE</TD>
<td>&nbsp;</TD>
</TR>
<TR><td>
<P>17</TD>
<td>
<P>65536</TD>
<td>
<P>BURNING</TD>
<td>&nbsp;</TD>
</TR>
<TR><td>
<P>18</TD>
<td>
<P>131072</TD>
<td>
<P>LOCATION</TD>
<td><p>LOCATION</TD>
</TR>
<TR><td>
<P>19</TD>
<td>
<P>262144</TD>
<td>
<P>ON</TD>
<td>&nbsp;</TD>
</TR>
<TR><td>
<P>20</TD>
<td>
<P>524288</TD>
<td>
<P>DAMAGED</TD>
<td>&nbsp;</TD>
</TR>
<TR><td>
<P>21</TD>
<td>
<P>1048576</TD>
<td>
<P>FEMALE</TD>
<td>&nbsp;</TD>
</TR>
<TR><td>
<P>22</TD>
<td>
<P>2097152</TD>
<td>
<P>POSSESSIVE</TD>
<td>&nbsp;</TD>
</TR>
<TR><td>
<P>23</TD>
<td>
<P>4194304</TD>
<td>
<P>OUT_OF_REACH</TD>
<td>&nbsp;</TD>
</TR>
<TR><td>
<P>24</TD>
<td>
<P>8388608</TD>
<td>
<P>TOUCHED</TD>
<td>&nbsp;</TD>
</TR>
<TR><td>
<P>25</TD>
<td>
<P>16777216</TD>
<td>
<P>SCORED</TD>
<td>
<P>SCORED</TD>
</TR>
<TR><td>
<P>26</TD>
<td>
<P>33554432</TD>
<td>
<P>SITTING</TD>
<td>&nbsp;</TD>
</TR>
<TR><td>
<P>27</TD>
<td>
<P>67108864</TD>
<td>
<P>FIRST</TD>
<td>
<P>FIRST</TD>
</TR>
<TR><td>
<P>28</TD>
<td>
<P>134217728</TD>
<td>
<P>DONE</TD>
<td>
<P>DONE</TD>
</TR>
<TR><td>
<P>29</TD>
<td>
<P>268435456</TD>
<td>
<P>GAS</TD>
<td>
&nbsp;</TD>
</TR>
<TR><td>
<P>30</TD>
<td>
<P>536870912</TD>
<td>
<P>NO_TAB</TD>
<td>
<P>NO_TAB</TD>
</TR>
<TR><td>
<P>31</TD>
<td>
<P>1073741824</TD>
<td>
<P>NOT_IMPORTANT</TD>
<td>
<P>NOT_IMPORTANT</TD>
</TR>
<TR><td>
<P>32</TD>
<td>
<P>2147483648</TD>
<td>
<P>(Sign BIT)</TD>
<td>
<P>(SignBIT)</TD>
</TR>
</TABLE>


<h1><a class="title" name="verbfunctions0">Appendix B: Library Verb Functions</a></h1>

<P>Below is a list of all the functions that are associated with <B>grammar</B> statements in <b>verbs.library</b>. It is not, however, a complete list of all the possible command constructs the player can use. Although each function is only listed here once, in most cases there are many <B>grammar</B> statements mapping to that function. For example, consider the function <B>+cut</B>: 

<pre>
grammar cut *present  &gt;cut
grammar chop *present &gt;cut
grammar stab *present &gt;cut
</pre>

<P>As you can see, the function <B>cut</B> has three <B>grammar</B> statements that map to it. The list below, however, will only show the first <B>grammar</B> statement that maps to the function. To see all the commands that will cause any one of the below functions to be called, search for the function name in the <B>verbs.library</B> file.

<pre>
shake *held                             &gt;shake
xyzzy                                   &gt;xyzzy
verbose                                 &gt;verbose
brief                                   &gt;brief
help *present                           &gt;help_other
hint one                                &gt;first_hint
hint two                                &gt;second_hint
hint three                              &gt;third_hint
hint four                               &gt;fourth_hint
help                                    &gt;help
help games                              &gt;help_games
hug *present                            &gt;hug
kiss *present                           &gt;kiss
pick *present with *held                &gt;pick_with
rub *present                            &gt;rub
rub *held on *present                   &gt;rub_on
rub *present with *held                 &gt;rub_with
lick *present                           &gt;lick
pull *present                           &gt;pull
cut *present                            &gt;cut
cut *present with *held                 &gt;cut_with
break *present                          &gt;break
clean *present                          &gt;clean
clean *present with *held               &gt;clean_with
yell at *present                        &gt;yell_at
pay *present                            &gt;pay
order *carried                          &gt;order
knock on *present                       &gt;knock_on
play *present                           &gt;play
take *here with *held                   &gt;take_with
fill *held from *present                &gt;fill_from
fill *held with *present                &gt;fill_with
fill *present                           &gt;fill
stand                                   &gt;stand
lie on *present                         &gt;lie_on
sit                                     &gt;sit
sit on *here                            &gt;sit_on
drop *held                              &gt;drop
take *here                              &gt;take
insert *held on *present                &gt;insert_on
insert *held in *present                &gt;insert_in
ask *present for *carried               &gt;ask_for
tell *present about *carried            &gt;tell_about
ask *present about *carried             &gt;ask_about
give *held to *present                  &gt;give_to
move *present                           &gt;move
read *present                           &gt;read
look down                               &gt;look_down
look up *anywhere in *present           &gt;look_up_in
consult *present about *anywhere        &gt;consult
feel *present                           &gt;feel
smell                                   &gt;smell
smell *present                          &gt;sniff
taste *present                          &gt;taste
look in *present                        &gt;look_in
examine *present                        &gt;examine
i                                       &gt;inventory
inv                                     &gt;list_inventory
sorry                                   &gt;sorry
thanks                                  &gt;thankyou
score                                   &gt;score
open *present                           &gt;open
close *present                          &gt;close
lock *present                           &gt;lock
lock *present with *held                &gt;lock_with
unlock *present                         &gt;unlock
unlock *present with *held              &gt;unlock_with
show *held to *present                  &gt;show_to
untie *present                          &gt;untie
tie *held                               &gt;tie
tie *held to *present                   &gt;tie_to
attack *present                         &gt;attack
attack *present with *held              &gt;attack_with
wave                                    &gt;wave
wave to *present                        &gt;wave_to
jump on *here                           &gt;jump_on
jump over *here                         &gt;jump_over
jump                                    &gt;jump
yes                                     &gt;yes
no                                      &gt;no
why                                     &gt;why?
blow *held at *here                     &gt;blow_at
throw *held at *here                    &gt;throw_at
remove *present from *present           &gt;remove_from
remove *present                         &gt;remove
wear *held                              &gt;wear
talk to *present                        &gt;talk_to
eat *present                            &gt;eat
drink from *present                     &gt;drink_from
drink *present                          &gt;drink
flick *present                          &gt;flick
press *present                          &gt;press
light *present with *held               &gt;light_with
light *present                          &gt;light
extinguish *present                     &gt;extinguish
swim west                               &gt;swim_west
west                                    &gt;west
swim east                               &gt;swim_east
east                                    &gt;east
swim south                              &gt;swim_south
south                                   &gt;south
swim southeast                          &gt;swim_southeast
southeast                               &gt;southeast
swim southwest                          &gt;swim_southwest
southwest                               &gt;southwest
swim north                              &gt;swim_north
north                                   &gt;north
swim northeast                          &gt;swim_northeast
northeast                               &gt;northeast
swim northwest                          &gt;swim_northwest
northwest                               &gt;northwest
climb up *here                          &gt;climb_up
climb down *here                        &gt;climb_down
enter *here                             &gt;enter
climb *here                             &gt;climb
swim in                                 &gt;swim_in
in                                      &gt;in
swim out                                &gt;swim_out
out                                     &gt;out
swim up                                 &gt;swim_up
up                                      &gt;up
swim down                               &gt;swim_down
down                                    &gt;down
look                                    &gt;look_around
look under *present                     &gt;look_under
look behind *present                    &gt;look_behind
look through *present                   &gt;look_through
look through *held at *present          &gt;look_through_at
look at *present through *held          &gt;look_at_through
wait                                    &gt;wait
listen                                  &gt;listen
listen to *present                      &gt;listen_to
use *present                            &gt;use
turn *present                           &gt;turn
turn on *present                        &gt;turn_on
turn off *present                       &gt;turn_off
pour *present                           &gt;pour
tip *present on *present                &gt;pour_on
</pre>



<h1><a class="title" name="tutorialsource0">Appendix C: Tutorial Game Source Code</a></h1>

<pre>
#!../bin/jacl

constant game_version		1
constant game_title			"Tutorial Game"
constant game_author		"Stuart Allen"
constant ifid				"JACL-512"

string 	 command_prompt		"^What do you want to do now? "

constant turns_since_last_sip		5

attribute EXAMINED

location bedroom : master bedroom
 west		bathroom
 south		nowhere

{look
print:
   You are in your bedroom. There is a large, soft bed
   in the centre of the room while a doorway to the
   west leads into the bathroom.
.
write "To the south there is " 
if door has CLOSED
   write "closed"
else
   write "open"
endif
write " door.^"
}

{movement
if compass = south
   if destination = nowhere
      write "The bedroom door is closed.^"
      return true
   endif
endif
return false
}

object bed: bed
  short		a "bed"
  mass		scenery

{look_under
if guide(parent) = limbo
   write "Hidden under the bed you find this week's "
   write "television guide.^"
   set guide(parent) = here
   points 50
   return
endif
write "You don't find anything else.^"
}

object guide: television tv tele guide
  short		a "television guide"
  long		"The television guide is here."
  parent	limbo
  mass		5

{examine : read
write "It contains a listing of this week's programmes.^"
}

{give_to_rick : show_to_rick
print:
   ~Cool!~ Rick exclaims as he snatches it from your
   hands.^^
   Satisfied that you have achieved at least one thing
   today, you decide to go back to bed.^
.
points 50
execute "+game_over"
}

object door : bedroom door
 short		the "bedroom door"
 has		CLOSABLE CLOSED

{open_override
set bedroom(south) = living_room
set living_room(north) = bedroom
return false
}

{close_override
set bedroom(south) = nowhere
set living_room(north) = nowhere
return false
}

location bathroom : bathroom
 east		bedroom

{look
print:
   You are in the bathroom. The only exit
   from here is back east into the bedroom.^
.
}

{movement
if compass = east : compass = out
   write "You bang your head as you walk through the "
   write "doorway.^^"
   return false
endif
write "The only exit from here is to the east.^"
}

object box: small wooden box
  has		CONTAINER CLOSABLE CLOSED
  short		a "small wooden box"
  long		"There is a small wooden box here."
  mass		25
  quantity	20

{close_override
write "The lid creaks as you push it closed.^"
ensure box has CLOSED
}

object note: orange note
  short		an "orange note"
  long		"An orange note rests on the ground."
  parent 	box
  mass		5

{read : examine
write "The note reads, ~Welcome to Jamaica and have a nice day.~^"
}

location living_room: living room
  short		the "living room"
  north		nowhere

{look
if here has VISITED
   write "You have returned to the living room.^"
else
   print:
      You are in the living room. There is a small
      television perched on a low-lying table in front
      of a sofa.
   .
   write "To the north there is " 
   if door has CLOSED
      write "closed"
   else
      write "open"
   endif
   write " door.^"
endif
}

{movement
if compass = north
   if destination = nowhere
      write "The bedroom door is closed.^"
      return true
   endif
endif
return false
}

{eachturn : *eachturn_bedroom
move door to here
}

object television: television tv tele
  short		a "television"
  mass		scenery

{examine
if self has EXAMINED
   write "It's Rick who is the TV addict, not you.^"
   return
endif
write "There is currently a cartoon showing on the "
write "television.^"
ensure self has EXAMINED
}

{turn_off
print:
   As you reach over and switch off the television,
   you get quite a shock to see Rick rapidly growing
   a coat of hair and foaming at the mouth. The shock
   of this is only surpassed by that of him sinking
   his newly-acquired fangs into your throat.^
.
execute "+game_over"
}

{turn_on
write "The television is already on."
}

object rick: son boy teenager rick
  has		ANIMATE
  short		name "Rick"
  long		"Rick is here, watching television."
  mass		heavy

{examine
write "Rick is staring blankly at the television screen.^"
}

{tell_about_guide
print:
   ~Oh, you found it, great. Give it to me!~ Rick exclaims.^
.
}

{tell_about_kryten
print:
   Rick starts to nod off as you tell him all about your early childhood.^
.
}

{ask_about_rick
print:
   ~My life is all but ruined until you find the TV guide.^
.
}

{ask_about_television
print:
   ~It could be bigger,~ Rick says with a sigh.^
.
}

{talk_to
print:
   ~Uh, yeah, I'll do it in a minute,~ Rick mumbles
   with out looking up. You have quite a strong
   suspicion that he didn't really hear a word
   you said.^
.
}

#-----------------------------------------------------------------------------
# GLOBAL FUNCTIONS 
#-----------------------------------------------------------------------------

{+eachturn
set rick(turns_since_last_sip) + 1
if rick(turns_since_last_sip) = 5
   if here = living_room
      write "Rick takes a sip from his drink.^"
  endif
  set rick(turns_since_last_sip) = 0
endif
}

{+default_ask_about
if noun1 = rick
   print:
      Rick pokes out his bottom lip then blinks several
      times. This, you have figured out over the
      years, translates to, ~Not a clue.~^
   .
   return
endif
return false
}

{+intro
style bold
write "^^" game_title
style normal
write " by " game_author "^^"

print:
   Your alarm rings and you climb out of bed.
   Monday morning again so soon. Oh well, at least
   your house doesn't have a front door so you have
   a good excuse for not going to work.^^
.

if here hasnt OUTDOORS
  set north_wall(parent) = here
  set south_wall(parent) = here
  set east_wall(parent) = here
  set west_wall(parent) = here
endif
set ground(parent) = here
look
}

object kryten: myself self me
 has		ANIMATE
 short		name "yourself"
 quantity	42
 parent		bedroom
 player

{examine
write "As beautiful as ever.^"
execute "+inventory"
}

grammar about &gt;about

{+about
write "This is the game from the tutorial section of the JACL Author's Guide."
write "See the appendix for the full source to this program.^"
}

integer OFFSET
integer INDEX
string status_text "temp"
constant status_window 3

{+update_status_window
style reverse
padstring status_text " " status_width
write status_text
cursor 0 1
write status_text
cursor 0 2
write status_text
cursor 1 1
write here{The}
setstring status_text "Score: " score " Moves: " total_moves
set OFFSET = status_width
length INDEX status_text
set OFFSET - INDEX
set OFFSET - 1
cursor OFFSET 1
write status_text
style normal
}

object north_wall: north north wall
 has			NO_TAB
 short          the "north wall"

object south_wall: south southern wall
 has			NO_TAB
 short          the "south wall"

object east_wall: east eastern wall
 has			NO_TAB
 short          the "east wall"

object west_wall: west western wall
 has			NO_TAB
 short          the "west wall"

object ground: ground floor
 has            SURFACE NO_TAB
 short          the "ground"

#debug "debug.library"
#include "webinterface.library"
#include "webinterface.css"
#include "npc.library"
#include "utils.library"
#include "verbs.library"
</pre>



<h1><a class="title" name="glossary0">Glossary</a></h1>

<table cellpadding=10 width=100%>
<TR><td valign=top><B>association</B></TD>
<td valign=top>A function is said to be associated with the nearest object or location that is defined above it in the game file. An underscore and the label of the item it is associated with is appended to the function name specified in the code to form the function's full internal name.</TD>
</TR>
<TR><td valign=top><B>attribute</B></TD>
<td valign=top>An attribute is a boolean value, or flag, that can be set on or off (using the <B>ensure</B> command) for any given item.</TD>
</TR>
<TR><td valign=top><B>child</B></TD>
<td valign=top>An object is said to be a child of whichever other item its <B>parent</B> element is currently set to. This indicates that the child object is somehow contained within or possessed by the parent item.</TD>
</TR>
<TR><td valign=top><B>command</B></TD>
<td valign=top>A command is one of the basic actions that can be performed within a function.</TD>
</TR>
<TR><td valign=top><B>container</B></TD>
<td valign=top>A container is any expression that can have its value <B>set</B> to an integer. These are item elements, item pointers and integer variables.</TD>
</TR>
<TR><td valign=top><B>current location</B></TD>
<td valign=top>The current location is whichever location the <B>parent</B> element of the object representing the player is set to. The object that represents the current player is specified by the current value of the object pointer <B>player</B>.</TD>
</TR>
<TR><td valign=top><B>directive</B></TD>
<td valign=top>A directive is a setting that may be placed in the interpreter's configuration file.</TD>
</TR>
<TR><td valign=top><B>element
</B></TD>
<td valign=top>An element is any of the properties of an item that can be set to hold an integer value.</TD>
</TR>
<TR><td valign=top><B>expression</B></TD>
<td valign=top>An expression is a group of three parameters that may be used with an <B>if</B> command. All expressions evaluate to either <B>true</B> or <B>false</B>.</TD>
</TR>
<TR><td valign=top><B>filter</B></TD>
<td valign=top>A <B>filter</B> is any word that has been specified to be removed from the player's move before it is processed by the interpreter.</TD>
</TR>
<TR><td valign=top><B>full internal name</B></TD>
<td valign=top>If a function's name begins with a plus sign, it is global and the name specified in the code will also be its full internal name. If not, the name that appears after a function's opening curly brace, followed by an underscore then the label of the item that the function is associated with will be its full internal name.</TD>
</TR>
<TR><td valign=top><B>grammar</B></TD>
<td valign=top>A <B>grammar</B> statement is the definition of a command construct that may be used by the player during the game and the function that should be called when that move is made.</TD>
</TR>
<TR><td valign=top><B>grand parent</B></TD>
<td valign=top>The grand parent of an object is the last object in the chain of possession. For example, if a coin is inside a purse that is in turn inside a bag, the bag is said to be the grand parent of the coin, while the purse is its parent.</TD>
</TR>
<TR><td valign=top><B>integer</B></TD>
<td valign=top>An integer is a 32 bit signed whole number. It can range between -2147483648 and 2147483647.</TD>
</TR>
<TR><td valign=top><B>item</B></TD>
<td valign=top>Item is the group term for objects and locations.</TD>
</TR>
<TR><td valign=top><B>keyword</B></TD>
<td valign=top>Keywords are any of the terms that define the nine basic data elements in a game. They are <B>object</B>, <B>location</B>, <B>filter</B>, <B>synonym</B>, <B>variable</B>, <B>grammar</B>, <b>constant</b>, <b>string</b> and <b>parameter</b>.</TD>
</TR>
<TR><td valign=top><B>label</B></TD>
<td valign=top>A label is the internal name given to an object, location or variable. No two labels can be the same.</TD>
</TR>
<TR><td valign=top><B>location</B></TD>
<td valign=top>A location is an item that the player may be inside. All locations have the attribute <B>LOCATION </B>and are defined using the keyword <B>location</B>.</TD>
</TR>
<TR><td valign=top><B>name</B></TD>
<td valign=top>All items must have one or more names. These are the names that the player may use to refer to that item during the course of the game.</TD>
</TR>
<TR><td valign=top><B>object</B></TD>
<td valign=top>An object is an item that represents any aspect of the game that the player must be able to refer to, but not be inside.</TD>
</TR>
<TR><td valign=top><B>parameter</B></TD>
<td valign=top>The term parameter refers to one of two things. Firstly a parameter is any information that follows a JACL command, keyword or property. If multiple parameters are specified, they must be separated by white space.</TD>
</TR>
<TR><td valign=top><B>parent</B></TD>
<td valign=top>An object's parent is the item that it is currently inside or possessed by. The parent of the object that represents the player is the location they are currently in.</TD>
</TR>
<TR><td valign=top><B>pointer</B></TD>
<td valign=top>A pointer is a special type of variable that may be used anywhere an item label can be. When used, it will be substituted for the label of the item that it is currently set to.</TD>
</TR>
<TR><td valign=top><B>indefinite article</B></TD>
<td valign=top>An indefinite article is used before singular nouns that refer to any member of a group. In English these are <b>a</b> or <b>an</b>. An item's indefinite article is defined using the first parameter of a <b>short</b> property. This article will be displayed when using a <B>{list}</B> macro.</TD>
</TR>
<TR><td valign=top><B>definite article</B></TD>
<td valign=top>A definite article is used before singular nouns that refer to a particular member of a group. In English this is <b>the</b>. An item's indefinite article defaults to <b>the</b> unless otherwise specified by supplying a <b>definite</b> property. This article will be displayed when using a <B>{the}</B> macro.</TD>
</TR>
<TR><td valign=top><B>property</B></TD>
<td valign=top>A property is one of the elements of an object or location that can be defined at start-up.</TD>
</TR>
<TR><td valign=top><B>scope</B></TD>
<td valign=top>Scope describes the position of an object relative to the player. The scope indicators are <B>*present</B>, <B>*here</B>, <B>*held</B> and <B>*anywhere</B>.</TD>
</TR>
<TR><td valign=top><B>statement</B></TD>
<td valign=top>A statement is a command, keyword or property along with all of its parameters.</TD>
</TR>
<TR><td valign=top><B>synonym</B></TD>
<td valign=top>A <B>synonym</B> is any word that has been specified to be swapped for another word in all moves typed by the player.</TD>
</TR>
<TR><td valign=top><a name="value"><B>value</B></a></TD>
<td valign=top>A value is an integer, or anything that resolves to an integer such as: an object label, an object element, an object pointer, a variable, <B>true</B> (1), <B>false</B> (0), <B>scenery</B> (100), <B>heavy</B>(99), <B>nowhere</B> (0), <B>lines</B> (the number of lines the screen can display) or <B>random</B>. For more information on constants and <B>random</B> see the chapter on <a href="internals.html">Internals</a>.</TD>
</TR>
<TR><td valign=top><B>white space</B></TD>
<td valign=top>White space is any tab, space, comma or colon that occurs outside double quotes</TD>
</tr></table>

</body>
</html>
